window.CVDOTOK=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,s=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,s),r(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}y(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,i,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,r){var i,s,o,a;if(l(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){r.once&&e.removeEventListener(t,i),n(s)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var l=c.length,u=g(c,l);for(n=0;n<l;++n)s(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,s,o;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);const i=new class{constructor(){}OnAuthError(e,t){t.emit("error",{type:"Authorization",message:"Your credentials for vidtok are invalid."+e})}OnAuthInitialError(e,t){t.emit("error",{type:"Authorization",message:"You are not connected with vidtok server."+e})}OnConnection(e,t){t.emit("connected",{type:"Success",message:"Vidtok server is connected successfully"})}OnDisconnection(e,t){t.emit("disconnected",{type:"Error",message:"Vidtok server is disconnected."+e})}OnRegister(e,t){let n=e.response;if("accepted"==n.trim())t.emit("register",{type:"REGISTER_ACCEPTED",message:"User is registered successfully"});else{let e=n.split(":")[1];e=e.trim(),t.emit("error",{type:"REGISTER_REJECTED",message:e})}}OnCallResponse(e,t){let n=e.response,r=e.from;if("accepted"==n){if(e.hasOwnProperty("associatedSessionUuid")){let n={type:"RECONNECT_PREVIOUS_SESSION",message:"Reconnect previous session ",from:r,reconnect_session_uuid:e.associatedSessionUuid,callType:"one_to_many",primary_session:e.sessionUuid};e.callType&&(n.callType=e.callType),t.emit("call",n)}let n={type:"CALL_ACCEPTED",message:"Call is accepted by receiver",from:r,callType:"one_to_one",uuid:e.sessionUuid,data:e.data};e.callType&&(n.callType=e.callType),t.emit("call",n)}else{let n={type:"CALL_REJECTED",message:"Call is rejected by receiver",from:r,callType:"one_to_one",uuid:e.sessionUuid,data:e.data};e.callType&&(n.callType=e.callType),t.emit("call",n),t.DisposeWebrtc(!0)}}OnIncomingCall(e,t){let n=e.from,r=null!=e.callType?e.callType:"one_to_one";"many_to_many"==r?t.emit("groupCall",{type:"CALL_RECEIVED",message:"Received a call",from:n,callType:e.mediaType,session:r,data:e.data,uuid:e.sessionUuid}):t.emit("call",{type:"CALL_RECEIVED",message:"Received a call",from:n,callType:e.mediaType,session:r,uuid:e.sessionUuid,data:e.data})}OnIncomingGroupCall(e,t){let n=e.from,r=e.callType;t.emit("groupCall",{type:"CALL_RECEIVED",message:"Received a call",from:n,callType:e.mediaType,session:r,uuid:e.sessionUuid,data:e.data,to:e.participants})}SessionStart(e,t){t.emit("call",{type:"CALL_STARTED",message:"Call is being started"})}CustomScreenshareSessionStart(e,t){t.emit("call",{type:"CALL_STARTED",message:"Call is being started",screen_type:"Custom_Screen_share"})}sendScrollRpcToApp(e,t){t.emit("call",{type:"S_S_I_E",message:"scroll event ",data:e})}GroupSessionStart(e,t){t.emit("groupCall",{type:"CALL_STARTED",message:"Call is being started"})}SessionSDP(e,t){t.emit("error",{type:"PROCESS_ANSWER",message:"Unable to process remote SDP."})}SessionBreak(e,t){t.emit("call",{type:"SESSION_BREAK",message:"Current Call Session break with other user.",data:e.data,uuid:e.sessionUuid})}OnAddCandidate(e,t){t.emit("error",{type:"CALL_ADDCANDIDATE",message:"Unable to add ice candidate."})}OnOfferIncomingCall(e,t){t.emit("error",{type:"CALL_OFFERGENERATING",message:"Unable to add generate incoming call offer."})}OnCustomRPC(e,t){"CUSTOM_SCREEN_SHARE_REQUEST"===e.data.type?t.emit("call",{type:"CUSTOM_SCREEN_SHARE_REQUEST",message:"Mobile screenshare request received.",data:e.data,uuid:e.data.uuid}):t.emit("call",{type:"Custom_RPC",message:"A Custom Data Packet received.",data:e.data,uuid:e.sessionUuid})}OnRTCPeer(e,t){t.emit("error",{type:"CALL_RTCPEER",message:"Unable to add to create webrtc peer."+e})}SessionEnd(e,t){let n=(0,r.GetKeyByValue)(t.UUIDSessions,e.sessionUuid),i=null!=e.callType?e.callType:"one_to_one";null!=e.responseCode&&487==e.responseCode?t.emit("call",{type:"MISSED_CALL",message:"Session canceled/Missed Call",from:n,callType:e.mediaType,session:i,data:e.data}):t.emit("call",{type:"CALL_ENDED",message:"Call is being ended",from:n,callType:i,uuid:e.sessionUuid,data:e.data})}SessionInvite(e,t){(0,r.GetKeyByValue)(t.UUIDSessions,e.sessionUuid);let n=t.UUIDSessionTypes[e.sessionUuid];if(null!=e.responseCode)switch(e.responseCode){case 100:t.emit("call",{type:"TRYING",message:"Trying to find the receiver",to:t.to,callType:n}),this.updateCallState(t,e.sessionUuid,"TRYING");break;case 180:t.emit("call",{type:"CONNECTING",message:"Trying to connect the receiver",to:t.to,callType:n}),this.updateCallState(t,e.sessionUuid,"CONNECTING");break;case 183:t.emit("call",{type:"ALERTING",message:"Alerting the receiver",to:t.to,callType:n}),this.updateCallState(t,e.sessionUuid,"ALERTING");break;case 200:"no session exist against this URL"==e.responseMessage?(t.emit("call",{type:"SESSION_END",message:"No Session exist or Call ended.",to:t.to,callType:n,uuid:e.sessionUuid}),this.updateCallState(t,e.sessionUuid,"ENDED")):(t.emit("call",{type:"CALL_ACCEPTED",message:"Call is accepted by receiver",to:t.to,callType:n,data:e.data}),this.updateCallState(t,e.sessionUuid,"ACCEPTED"));break;case 402:"one_to_one"!=n&&"one_to_one_with_ai"!=n||t.DisposeWebrtc(!0),t.emit("call",{type:"INSUFFICIENT_FUNDS",message:e.responseMessage,uuid:e.sessionUuid}),this.updateCallState(t,e.sessionUuid,"ENDED");break;case 404:"invalid target"==e.responseMessage?t.emit("call",{type:"INVALID_TARGET",message:"Receiver is not found",to:t.to,callType:n}):t.emit("call",{type:"SESSION_END",message:"No Session exist or Call ended.",to:t.to,callType:n,uuid:e.sessionUuid}),this.updateCallState(t,e.sessionUuid,"ENDED"),"one_to_one"!=n&&"one_to_one_with_ai"!=n||t.DisposeWebrtc(!0);break;default:if(400===e.responseCode&&"bad request"==e.responseMessage)return void t.emit("call",{type:"BAD_REQUEST",message:"Please check your last RPC it is not correct!",to:t.to,callType:n,uuid:e.sessionUuid,data:e.data});"one_to_one"!=n&&"one_to_one_with_ai"!=n||t.DisposeWebrtc(!0),t.emit("call",{type:"CALL_REJECTED",message:"Receiver has rejected the call",to:t.to,callType:n,uuid:e.sessionUuid,data:e.data}),this.updateCallState(t,e.sessionUuid,"ENDED")}}updateCallState(e,t,n){var r;(null===(r=null==e?void 0:e.sessionInfo)||void 0===r?void 0:r[t])&&(e.sessionInfo[t].call_state=n)}SessionBusy(e,t){if(486===e.responseCode){let n=(0,r.GetKeyByValue)(t.UUIDSessions,e.sessionUuid);t.emit("call",{type:"CALL_REJECTED",message:"User is Busy",from:n,callType:e.callType,uuid:e.sessionUuid}),this.updateCallState(t,e.sessionUuid,"ENDED")}else console.log(e.responseMessage)}SessionCancel(e,t){let n=(0,r.GetKeyByValue)(t.UUIDSessions,e.sessionUuid),i=t.UUIDSessionTypes[e.sessionUuid],s=e.sessionUuid.includes("-xy");if(null!=e.responseCode)switch(e.responseCode){case 487:t.emit("call",{type:"MISSED_CALL",message:"Session canceled/Missed Call",from:n,callType:i});break;case 480:t.emit("call",{type:"PARTICIPANT_UNAVAILABLE",message:"User is Unavailable",from:n,callType:i});break;case 410:t.emit("call",{type:"PARTICIPANT_LEFT",message:"Participant has left the call",from:e.referenceId,callType:i});break;case 401:console.log("SessionCancel i'm here",{res:e}),t.emit("call",{type:"SESSION_BLOCKED",message:"Show has blocked by provider",uuid:e.sessionUuid});break;case 402:console.log("SessionCancel i'm here",{res:e}),t.emit("call",{type:"INSUFFICIENT_FUNDS",message:e.responseMessage,uuid:e.sessionUuid});break;case 403:console.log("SessionCancel i'm here",{res:e}),t.emit("call",{type:"SESSION_SUSPENSION",message:"Show has suspended by provider",uuid:e.sessionUuid});break;default:if(s)return void t.emit("call",{type:"CALL_ENDED",message:"Call is being ended",uuid:e.sessionUuid});t.DisposeWebrtc(!1),t.emit("call",{type:"CALL_ENDED",message:"Call is being ended",to:t.to,callType:i,uuid:e.sessionUuid,data:e.data})}this.updateCallState(t,e.sessionUuid,"ENDED")}SetCallerStatus(e,t){t.emit("call",{type:"CALL_STATUS",message:"Call Status",video_status:e.videoInformation,audio_status:e.audioInformation,uuid:e.sessionUuid,from:e.referenceId,data:e.data})}PublicURL(e,t){t.emit("call",{type:"PUBLIC_URL",message:"Public URL Available for Broadcast!",url:e.url,uuid:e.sessionUuid})}OnNewParticipant(e,t){t.emit("call",{type:"NEW_PARTICIPANT",message:"New participant arrived.",participant:e.referenceId,uuid:e.sessionUuid})}screenOffByUser(e,t){t.emit("call",{type:"SCREEN_OFF",message:"User turned off screen",uuid:e.sessionUuid})}sdkError(e,t){t.emit("call",{type:"SDK_ERROR",message:e.message,uuid:e.sessionUuid})}SetExistingParticipants(e,t){t.emit("groupCall",{type:"PARTICIPANT_LIST",message:"Participant List is available",participant_list:e.referenceIds})}SetParticipantStatus(e,t){t.emit("groupCall",{type:"PARTICIPANT_STATUS",message:"Participant Status",participant:e.referenceId,video_status:e.videoInformation,audio_status:e.audioInformation})}OnTrack(e,t,n){t.emit("call",{type:"REMOTE_STREAM",message:"Remote Peer Stream Received",stream:e,participant:n})}};t.default=i},function(e,t,n){"use strict";function r(e){return e instanceof Element}Object.defineProperty(t,"__esModule",{value:!0}),t.UuidGenerator=t.SetPlaysInline=t.IsDOM=t.GetKeyByValue=void 0,t.GetKeyByValue=function(e,t){return Object.keys(e).find(n=>e[n]===t)},t.IsDOM=r,t.SetPlaysInline=function(e){r(e)&&e.setAttribute("playsinline",!0)},t.UuidGenerator=function(){let e=String.fromCharCode(Math.floor(25*Math.random()+65));do{const t=Math.floor(42*Math.random()+48);(t<58||t>64)&&(e+=String.fromCharCode(t))}while(e.length<32);return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRtcPeerHelper=void 0;const r=n(19),i=n(0),s=n(21),o=console,a=new r("undefined"!=typeof window&&window.navigator?window.navigator.userAgent:"").getBrowser();let c=!1;"Chrome"!==a.name&&"Chromium"!==a.name||(o.debug(a.name+": using SDP PlanB"),c=!0);class l extends i.EventEmitter{constructor(e,t,n){super(),this.candidatesQueueOut=[],this.candidategatheringdone=!1,t=t||{},n=(n||this.noop).bind(this),this.mode=e,this.options=t,this.callback=n,this.id=t.id||btoa((new Date).toLocaleTimeString()),this.init()}noop(e){e&&o.error(e)}getCurrentFrame(){if(!this.remoteVideo)return;if(this.remoteVideo.readyState<this.remoteVideo.HAVE_CURRENT_DATA)throw new Error("No video stream data available");const e=document.createElement("canvas");return e.width=this.remoteVideo.videoWidth,e.height=this.remoteVideo.videoHeight,e.getContext("2d").drawImage(this.remoteVideo,0,0),e}init(){this.localVideo=this.options.localVideo,this.remoteVideo=this.options.remoteVideo,this.videoStream=this.options.videoStream,this.audioStream=this.options.audioStream,this.mediaConstraints=this.options.mediaConstraints,this.peerConnection=this.options.peerConnection;const e=this.options.sendSource||"webcam",t=this.options.dataChannelConfig||null,n=this.options.dataChannels||!1,r=this.options.configuration,i=this.options.onicecandidate;i&&this.on("icecandidate",i);const o=e=>{};if(o&&this.on("candidategatheringdone",o),this.simulcast=this.options.simulcast,this.multistream=this.options.multistream,this.interop=new s.Interop,this.candidatesQueueOut=[],this.candidategatheringdone=!1,!this.peerConnection&&(this.peerConnection=new RTCPeerConnection(r),n&&!this.dataChannel)){let e="WebRtcPeer-"+this.id,n=void 0;t&&(e=t.id||e,n=t.options),this.dataChannel=this.peerConnection.createDataChannel(e,n),t&&(this.dataChannel.onopen=t.onopen,this.dataChannel.onclose=t.onclose,this.dataChannel.onmessage=t.onmessage,this.dataChannel.onbufferedamountlow=t.onbufferedamountlow,this.dataChannel.onerror=t.onerror||this.noop.bind(this))}if(!this.peerConnection.getLocalStreams&&this.peerConnection.getSenders&&(this.peerConnection.getLocalStreams=()=>{const e=new MediaStream;return this.peerConnection.getSenders().forEach(t=>{e.addTrack(t.track)}),[e]}),this.peerConnection.getRemoteStreams=()=>{const e=new MediaStream;return this.peerConnection.getReceivers().forEach(t=>{e.addTrack(t.track)}),[e]},this.peerConnection.addEventListener("icecandidate",this.iceCandidateFunction.bind(this)),this.peerConnection.onaddstream=this.options.onaddstream,this.peerConnection.ontrack=this.options.ontrack,this.peerConnection.onnegotiationneeded=this.options.onnegotiationneeded,this.peerConnection.addEventListener("iceconnectionstatechange",e=>{}),this.on("newListener",(e,t)=>{if("icecandidate"===e||"candidategatheringdone"===e)for(;this.candidatesQueueOut&&this.candidatesQueueOut.length;){const n=this.candidatesQueueOut.shift();!n==("candidategatheringdone"===e)&&t(n)}}),this.addIceCandidateInternal=this.bufferizeCandidates(this.peerConnection),"recvonly"===this.mode||this.videoStream||this.audioStream)setTimeout(()=>this.start(),0);else{if("webcam"!==e)return"Screen implementation not done in this class";this.getMedia(this.mediaConstraints)}this.on("_dispose",()=>{this.localVideo&&(this.localVideo.pause(),this.localVideo.srcObject=null,this.localVideo.load(),this.localVideo.muted=!1),this.remoteVideo&&(this.remoteVideo.pause(),this.remoteVideo.srcObject=null,this.remoteVideo.load()),this.removeAllListeners()})}getMedia(e){void 0===e&&(e={audio:!0,video:{width:640,framerate:15}}),navigator.mediaDevices.getUserMedia(e).then(e=>{this.videoStream=e,this.start()}).catch(this.callback)}iceCandidateFunction(e){const t=e.candidate;if(i.EventEmitter.listenerCount(this,"icecandidate")||i.EventEmitter.listenerCount(this,"candidategatheringdone"))if(t){let e;e=this.multistream&&c?this.interop.candidateToUnifiedPlan(t):t,this.emit("icecandidate",e),this.candidategatheringdone=!1}else this.candidategatheringdone||(this.emit("candidategatheringdone"),this.candidategatheringdone=!0);else this.candidategatheringdone||(this.candidatesQueueOut.push(t),t||(this.candidategatheringdone=!0))}addIceCandidate(e,t){let n;n=this.multistream&&c?this.interop.candidateToPlanB(e):new RTCIceCandidate(e),o.debug("Remote ICE candidate received",e),t=(t||this.noop).bind(this),this.addIceCandidateInternal(n,t)}generateOffer(e,t={}){if(e=e.bind(this),"recvonly"===this.mode){const e=!this.mediaConstraints||"boolean"!=typeof this.mediaConstraints.audio||this.mediaConstraints.audio,t=!this.mediaConstraints||"boolean"!=typeof this.mediaConstraints.video||this.mediaConstraints.video;e&&this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),t&&this.peerConnection.addTransceiver("video",{direction:"recvonly"})}else"sendonly"===this.mode&&this.peerConnection.getTransceivers().forEach(e=>{e.direction="sendonly"});this.peerConnection.createOffer(t).then(e=>(o.debug("Created SDP offer"),e=this.mangleSdpToAddSimulcast(e),this.peerConnection.setLocalDescription(e))).then(()=>{let t=this.peerConnection.localDescription;o.debug("Local description set\n",t.sdp),this.multistream&&c&&(t=this.interop.toUnifiedPlan(t),o.debug("offer::origPlanB->UnifiedPlan",this.dumpSDP(t))),e(null,t.sdp,this.processAnswer.bind(this))}).catch(e)}getLocalSessionDescriptor(){return this.peerConnection.localDescription}getRemoteSessionDescriptor(){return this.peerConnection.remoteDescription}setRemoteVideo(){if(this.remoteVideo){this.remoteVideo.pause();const e=this.peerConnection.getRemoteStreams()[0];this.remoteVideo.srcObject=e,o.debug("Remote stream:",e),this.remoteVideo.load()}}showLocalVideo(){this.localVideo.srcObject=this.videoStream?this.videoStream:this.audioStream,this.localVideo.muted=!0}send(e){this.dataChannel&&"open"===this.dataChannel.readyState?this.dataChannel.send(e):o.warn("Trying to send data over a non-existing or closed data channel")}processAnswer(e,t){t=(t||this.noop).bind(this);let n=new RTCSessionDescription({type:"answer",sdp:e});if(this.multistream&&c){const e=this.interop.toPlanB(n);o.debug("asnwer::planB",this.dumpSDP(e)),n=e}if(o.debug("SDP answer received, setting remote description"),"closed"===this.peerConnection.signalingState)return t("PeerConnection is closed");this.peerConnection.setRemoteDescription(n).then(()=>{this.setRemoteVideo(),t()},t)}processOffer(e,t){t=t.bind(this);let n=new RTCSessionDescription({type:"offer",sdp:e});if(this.multistream&&c){const e=this.interop.toPlanB(n);o.debug("offer::planB",this.dumpSDP(e)),n=e}if(o.debug("SDP offer received, setting remote description"),"closed"===this.peerConnection.signalingState)return t("PeerConnection is closed");this.peerConnection.setRemoteDescription(n).then(()=>this.setRemoteVideo()).then(()=>this.peerConnection.createAnswer()).then(e=>(e=this.mangleSdpToAddSimulcast(e),o.debug("Created SDP answer"),this.peerConnection.setLocalDescription(e))).then(()=>{let e=this.peerConnection.localDescription;this.multistream&&c&&(e=this.interop.toUnifiedPlan(e),o.debug("answer::origPlanB->UnifiedPlan",this.dumpSDP(e))),o.debug("Local description set\n",e.sdp),t(null,e.sdp)}).catch(t)}mangleSdpToAddSimulcast(e){return this.simulcast&&("Chrome"===a.name||"Chromium"===a.name?(o.debug("Adding multicast info"),e=new RTCSessionDescription({type:e.type,sdp:this.removeFIDFromOffer(e.sdp)+this.getSimulcastInfo(this.videoStream)})):o.warn("Simulcast is only available in Chrome browser.")),e}start(){"closed"===this.peerConnection.signalingState&&this.callback('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'),(this.audioStream||this.videoStream)&&this.localVideo&&this.showLocalVideo(),this.videoStream&&this.videoStream.getTracks().forEach(e=>{this.peerConnection.addTrack(e,this.videoStream)}),this.audioStream&&this.audioStream.getTracks().forEach(e=>{this.peerConnection.addTrack(e,this.audioStream)}),this.callback()}trackStop(e){e.stop&&e.stop()}streamStop(e){e.getTracks().forEach(this.trackStop.bind(this))}dumpSDP(e){return null==e?"":"type: "+e.type+"\r\n"+e.sdp}bufferizeCandidates(e,t=null){const n=[];return this.peerConnection.addEventListener("signalingstatechange",()=>{if("stable"===e.signalingState)for(;n.length;){const t=n.shift();e.addIceCandidate(t.candidate,t.callback,t.callback)}}),(r,i)=>{switch(i=i||t,e.signalingState){case"closed":i(new Error("PeerConnection object is closed"));break;case"stable":if(e.remoteDescription){e.addIceCandidate(r,i,i);break}default:n.push({candidate:r,callback:i})}}}removeFIDFromOffer(e){const t=e.indexOf("a=ssrc-group:FID");return t>0?e.slice(0,t):e}getSimulcastInfo(e){const t=e.getVideoTracks();if(!t.length)return o.warn("No video tracks available in the video stream"),"";const n=["a=x-google-flag:conference","a=ssrc-group:SIM 1 2 3","a=ssrc:1 cname:localVideo","a=ssrc:1 msid:"+e.id+" "+t[0].id,"a=ssrc:1 mslabel:"+e.id,"a=ssrc:1 label:"+t[0].id,"a=ssrc:2 cname:localVideo","a=ssrc:2 msid:"+e.id+" "+t[0].id,"a=ssrc:2 mslabel:"+e.id,"a=ssrc:2 label:"+t[0].id,"a=ssrc:3 cname:localVideo","a=ssrc:3 msid:"+e.id+" "+t[0].id,"a=ssrc:3 mslabel:"+e.id,"a=ssrc:3 label:"+t[0].id];return n.push(""),n.join("\n")}getLocalStream(e){if(this.peerConnection)return this.peerConnection.getLocalStreams()[e||0]}getRemoteStream(e){if(this.peerConnection)return this.peerConnection.getRemoteStreams()[e||0]}dispose(){o.debug("Disposing WebRtcPeer");const e=this.peerConnection,t=this.dataChannel;try{if(t){if("closed"===t.readyState)return;t.close()}if(e){if("closed"===e.signalingState)return;e.getLocalStreams().forEach(this.streamStop.bind(this)),e.close()}}catch(e){o.warn("Exception disposing webrtc peer "+e)}this.emit("_dispose")}}t.WebRtcPeerHelper=class{static WebRtcPeerRecvonly(e,t){return new l("recvonly",e,t)}static WebRtcPeerSendonly(e,t){return new l("sendonly",e,t)}static WebRtcPeerSendrecv(e,t){return new l("sendrecv",e,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(15);t.default=class{constructor(){this.RegPacket=r.default}set id(e){this.RegPacket.id=e}get id(){return this.RegPacket.id}set type(e){this.RegPacket.type=e}get type(){return this.RegPacket.type}set requestType(e){this.RegPacket.requestType=e}get requestType(){return this.RegPacket.requestType}set requestId(e){this.RegPacket.requestId=e}get requestId(){return this.RegPacket.requestId}set tenantId(e){this.RegPacket.tenantId=e}get tenantId(){return this.RegPacket.tenantId}set projectId(e){this.RegPacket.projectId=e}get projectId(){return this.RegPacket.projectId}set referenceId(e){this.RegPacket.referenceId=e}get referenceId(){return this.RegPacket.referenceId}set authorizationToken(e){this.RegPacket.authorizationToken=e}get authorizationToken(){return this.RegPacket.authorizationToken}set socketType(e){this.RegPacket.socketType=e}get socketType(){return this.RegPacket.socketType}set natType(e){this.RegPacket.natType=e}get natType(){return this.RegPacket.natType}set publicIps(e){this.RegPacket.publicIps=e}get publicIps(){return this.RegPacket.publicIps}set reConnect(e){this.RegPacket.reConnect=e}get reConnect(){return this.RegPacket.reConnect}set deviceId(e){this.RegPacket.deviceId=e}get deviceId(){return this.RegPacket.deviceId}SendRegisterRequest(e){const t=JSON.stringify(this.RegPacket);console.log("Send===RegisterRequest",t),e.send(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=new class{constructor(){}SetRegisterResponse(e,t){switch(e.responseCode){case 200:t.McToken=e.mcToken,t.emit("register",{type:"Success",message:"You are registered successfully with vidtok server."});break;default:t.emit("error",{type:"Register",message:"You are not registered with vidtok server."+e.responseMessage})}}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(16);t.default=class{constructor(){this.ReqPacket=r.default}set from(e){this.ReqPacket.from=e}get from(){return this.ReqPacket.from}set timestamp(e){this.ReqPacket.timestamp=e}get timestamp(){return this.ReqPacket.timestamp}set to(e){this.ReqPacket.to=e}get to(){return this.ReqPacket.to}set type(e){this.ReqPacket.type=e}get type(){return this.ReqPacket.type}set requestType(e){this.ReqPacket.requestType=e}get requestType(){return this.ReqPacket.requestType}set sessionType(e){this.ReqPacket.sessionType=e}get sessionType(){return this.ReqPacket.sessionType}set requestId(e){this.ReqPacket.requestId=e}get requestId(){return this.ReqPacket.requestId}set sessionUuid(e){this.ReqPacket.sessionUuid=e}get sessionUuid(){return this.ReqPacket.sessionUuid}set mcToken(e){this.ReqPacket.mcToken=e}get mcToken(){return this.ReqPacket.mcToken}set sdpOffer(e){this.ReqPacket.sdpOffer=e}get sdpOffer(){return this.ReqPacket.sdpOffer}set sdp(e){this.ReqPacket.sdp=e}get sdp(){return this.ReqPacket.sdp}set sdpType(e){this.ReqPacket.sdpType=e}get sdpType(){return this.ReqPacket.sdpType}set callType(e){this.ReqPacket.callType=e}get callType(){return this.ReqPacket.callType}set data(e){this.ReqPacket.data=e}get data(){return this.ReqPacket.data}set mediaType(e){this.ReqPacket.mediaType=e}get mediaType(){return this.ReqPacket.mediaType}get referenceId(){return this.ReqPacket.referenceId}set referenceId(e){this.ReqPacket.referenceId=e}set isRecord(e){this.ReqPacket.isRecord=e}get isRecord(){return this.ReqPacket.isRecord}set isPeer(e){this.ReqPacket.isPeer=e}get isPeer(){return this.ReqPacket.isPeer}set participants(e){this.ReqPacket.participants=e}get participants(){return this.ReqPacket.participants}custom_field(e,t){this.ReqPacket[e]=t}deleteKey(e){this.ReqPacket[e]&&delete this.ReqPacket[e]}SendCallRequest(e){let t=JSON.stringify(this.ReqPacket);console.log("Send===CallRequest",t),e.send(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9),i=n(18);class s{constructor(e=null,t=null,n=null,i=null,o=null){this.nativeScreenShare=!1,this.pauseScreenCapture=!1,this.useServerSideRendering=!1,this.MclientInstance=null,this.messageCredentials=null,this.authToken=null,this.RefID=null,this.oldBlob=null,this.socketInstance=null,this.showId=null,this.toGeeScreenDebounce=s.toGeeDebounce(this.startToGeeCaptureScreen.bind(this),1e3,0),this.toGeeScreenDebounceShort=s.toGeeDebounce(this.startToGeeCaptureScreen.bind(this),300,0),this.socketInstance=e,this.showId=t,this.phantomHelper=new r.default,this.socketInstance&&(this.phantomHelper.refId=this.socketInstance.currentUser,this.phantomHelper.token=this.socketInstance.authorizationToken,this.phantomHelper.htmlNormalizationCode=this.socketInstance.htmlNormalizationCode),this.useServerSideRendering=this.detectMob()?2:0,this.authToken=i,this.RefID=o,this.initializeMessaging(n)}initializeMessaging(e){if(!e||e&&!e.customScreenShare)return;this.MclientInstance&&this.MclientInstance.Disconnect(),this.MclientInstance=null,this.messageCredentials=e,console.log("message credentials in screenshare class--\x3e",this.messageCredentials);const t={projectId:this.messageCredentials.customScreenShare.projectId,secret:"5ff420e1fd72bca845c889bdfe01d19d",host:this.messageCredentials.customScreenShare.completeAddress};this.MclientInstance=new i.Client(t),console.log("** Mclient in sdk after initializing==>",this.MclientInstance),console.log("** before registering Mclient in sdk==>",this.authToken,this.RefID),this.MclientInstance.Register(this.RefID,this.authToken),this.MclientInstance.on("connect",e=>{console.log("**res on connect sdk in vdotok sdk",e),this.subscribeChannel({key:this.messageCredentials.customScreenShare.topicKey,channel:this.messageCredentials.customScreenShare.topicName})}),this.MclientInstance.on("subscribed",e=>{console.log("** res on subscribing channel in sdk--\x3e",e)}),this.MclientInstance.on("message",e=>{console.log("**res on message ",e)})}subscribeChannel(e){this.MclientInstance.Subscribe(e)}detectMob(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))}async getScreenShareStream(e=!0,t=null){let n=null;t&&(this.useServerSideRendering=2);try{navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&!t?(n=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:18},aspectRatio:{ideal:1.7777777778}},audio:e}),this.nativeScreenShare=!0):n=await this.getCustomScreen()}catch(e){if(console.log(e),"Permission denied"===e.message)return null;n=await this.getCustomScreen()}return n}imageSrcToBase64(e){if(!/^data:image\/(png|jpeg);base64,/.test(e.src))return fetch(e.src,{headers:{"X-User-Agent":"agent"}}).then(e=>e.blob()).then(e=>new Promise((t,n)=>{const r=new FileReader;r.onerror=n,r.onload=()=>{t(r.result)},r.readAsDataURL(e)})).then(t=>{e.src=t})}toDataURL(e){if(!/^data:image\/(png|jpeg);base64,/.test(e.src))return new Promise((function(t,n){const r=new XMLHttpRequest;r.onload=function(){const i=new FileReader;i.onerror=n,i.onloadend=function(){e.src=i.result,t(i.result)},i.readAsDataURL(r.response)},r.open("GET",e.src,!0),r.responseType="blob",r.send()}))}async getCustomScreen(){if(this.pauseScreenCapture=!1,2===this.useServerSideRendering){const e=await this.startToGeeCaptureScreen();return this.toGeeListenToScreenChanges(),e}{let e=null;this.nativeScreenShare=!1;const t=s.getTogeeScreenCanvas();if(t){await this.startToGeeCaptureScreen();e=t.captureStream(30),this.toGeeListenToScreenChanges()}return e}}toGeeListenToScreenChanges(){const e=["keydown","touchend","orientationchange"];for(const t of e)window.addEventListener(t,this.toGeeScreenDebounce.bind(this));document.addEventListener("touchmove",this.toGeeScreenDebounceShort.bind(this)),window.onscroll=e=>{this.startToGeeCaptureScreen(e)},this.toGeeListenToDomChanges()}toGeeListenToDomChanges(){const e=document.body;window.toGeeScreenObserver=new MutationObserver((e,t)=>{let n=0;for(const t of e)if("childList"===t.type){for(const e of t.addedNodes)if(e.className&&!e.className.includes("html2canvas")){n=1;break}for(const e of t.removedNodes)if(e.className&&!e.className.includes("html2canvas")){n=1;break}}n&&this.toGeeScreenDebounce()}),window.toGeeScreenObserver.observe(e,{attributes:!0,childList:!0,subtree:!0})}static getTogeeScreenCanvas(){let e=document.getElementById("toGee_screen_share_canvas");return e||(e=document.createElement("canvas"),document.body.appendChild(e),e.id="toGee_screen_share_canvas",e.setAttribute("data-html2canvas-ignore",""),e.width=window.innerWidth,e.height=window.innerHeight,e.style.opacity=0,e.style.position="absolute",e.style.zIndex=-1,e.style.top="-1000em",e.style.left="-1000em"),e}async startToGeeCaptureScreen(e=null){if(this.pauseScreenCapture)return void console.log("Screen sharing is pause!");let t;this.phantomHelper||(this.phantomHelper=new r.default,this.socketInstance&&(this.phantomHelper.refId=this.socketInstance.currentUser,this.phantomHelper.token=this.socketInstance.authorizationToken,this.phantomHelper.htmlNormalizationCode=this.socketInstance.htmlNormalizationCode));let n=!1,i=0;if(!e||"scroll"!=e.type&&"touchmove"!=e.type||(console.log(window.scrollY,window.scrollX,window.innerWidth),i=1),i&&window.toGeeScreenInnerCanvas)t=window.toGeeScreenInnerCanvas;else if(this.useServerSideRendering){if(1===this.useServerSideRendering){const e=await this.phantomHelper.getScreenShotServer();e&&(window.toGeeScreenInnerCanvas=t=e,n=!0)}else if(2===this.useServerSideRendering){const e=await this.phantomHelper.getScreenShotServer(null,null,null,null,this.showId,!0);e&&(window.toGeeScreenInnerCanvas=t=e,n=!0)}}else s.toGeePrepareVideos(),window.toGeeScreenInnerCanvas=t=await html2canvas(document.body,{onclone:e=>{},backgroundColor:"#ffffff",scale:1,imageTimeout:8200,logging:!0,removeContainer:!1,proxy:"https://host.togee.io/html2canvasproxy.php"});if(1===this.useServerSideRendering){const e=new Image;e.onload=()=>{this.drawOnCanvas(e)},n&&(this.oldBlob&&URL.revokeObjectURL(this.oldBlob),this.oldBlob=URL.createObjectURL(t)),e.src=this.oldBlob}else this.useServerSideRendering?2===this.useServerSideRendering&&this.drawOnCanvas(t,!0,n):this.drawOnCanvas(t);return s.onceAutoScrollDone||2===this.useServerSideRendering||(s.onceAutoScrollDone=setInterval(()=>{this.startToGeeCaptureScreen({type:"scroll"})},300)),!0}disconnectMessaging(){this.MclientInstance&&this.MclientInstance.Disconnect()}sendScrollMessage(e){let t=(new Date).getTime().toString(),n={type:"S_S_I_E",from:this.RefID,content:e,id:t,date:(new Date).getTime(),key:this.messageCredentials.customScreenShare.topicKey,to:this.messageCredentials.customScreenShare.topicName};console.log("before sending message in msg sdk scroll--\x3e",n),this.MclientInstance&&this.MclientInstance.SendMessage(n)}drawOnCanvas(e,t=!1,n=!1){const r=window.scrollY<0?0:window.scrollY>document.documentElement.scrollHeight-document.documentElement.clientHeight?document.documentElement.scrollHeight-document.documentElement.clientHeight:window.scrollY;if(t)return void(this.socketInstance&&(n?(this.socketInstance.sendStateRPC({type:"N_S_I",image:e,x:window.scrollX<0?0:window.scrollX,y:r,w:window.innerWidth,h:window.innerHeight,page_url:window.location.href,t:Date.now()},this.showId),this.socketInstance.emit("call",{type:"New_Image_Sent",message:"new image sent to viewers",showId:this.showId})):this.sendScrollMessage({type:"S_S_I",x:window.scrollX<0?0:window.scrollX,y:r,w:window.innerWidth,h:window.innerHeight,t:Date.now()})));const i=s.getTogeeScreenCanvas(),o=i.getContext("2d");o.clearRect(0,0,i.width,i.height),o.drawImage(e,window.scrollX<0?0:window.scrollX,r,window.innerWidth,window.innerHeight,0,0,i.width,i.height)}static toGeePrepareVideos(){let e,t;window.tooGeeVideosHackCanvas?(e=window.tooGeeVideosHackCanvas,t=window.tooGeeVideosHackCanvasCTX):(e=document.createElement("canvas"),e.setAttribute("id","tooGeeVideosHackCanvas"),t=e.getContext("2d"),window.tooGeeVideosHackCanvasCTX=t,window.tooGeeVideosHackCanvas=e);const n=document.querySelectorAll("video");let r,i;for(let s=0,o=n.length;s<o;s++){const o=n[s];if(!o.src)try{r=o.videoWidth,i=o.videoHeight,e.width=r,e.height=i,t.fillRect(0,0,r,i),t.drawImage(o,0,0,r,i),o.style.backgroundImage=`url(${e.toDataURL()})`,o.style.backgroundSize="contain",t.clearRect(0,0,r,i)}catch(e){continue}}}static toGeeDebounce(e,t,n){let r;return function(){const i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)},a=n&&!r;clearTimeout(r),r=setTimeout(o,t),a&&e.apply(i,s)}}static getScreenShot(e,t=null,n=null,i=null,s=null,o=null){const a=new r.default;return i&&s&&(a.refId=i,a.token=s),o&&(a.htmlNormalizationCode=o),a.getScreenShotServer(e,t,".jpg",null,null,!1,n)}}t.default=s,s.onceAutoScrollDone=!1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(14);const i=new class{constructor(){}async Authorization(e,t){let n={projectId:e,auth_token:t};return fetch(r.SERVER+"/AuthenticateSDK",{method:"POST",body:JSON.stringify(n),mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(e=>e.json()).then(e=>e).catch(e=>(console.log(e),e))}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pendingCalls=0,this.latestParams=null,this.refId=null,this.token=null,this.htmlNormalizationCode=null}async getZip(e){}getHtml(e){document.querySelectorAll("canvas").forEach(e=>{e.hasAttribute("id")&&e.getAttribute("id")||e.setAttribute("id","dynamic_canvas_"+Math.round(100*Math.random()))});let t=document.getElementsByTagName(e)[0];if(!t)return"";t=t.innerHTML.trim();const n=document.createElement("template");n.innerHTML=t,document.querySelectorAll("canvas").forEach(e=>{const t=new Image;for(let n=e.attributes.length-1;n>-1;--n){const r=e.attributes[n];t.setAttribute(r.name,r.value)}t.src=e.toDataURL();const r=n.content.querySelector("#"+e.id);r.classList.contains("togee_doddle_canvas")&&(t.style.top=window.scrollY+"px"),r.parentNode.replaceChild(t,r)});const r=document.querySelector("html"),i=document.createElement("html");if(r)for(let e=r.attributes.length-1;e>-1;--e){const t=r.attributes[e];i.setAttribute(t.name,t.value)}const s=document.querySelector("body"),o=document.createElement("body");if(s)for(let e=s.attributes.length-1;e>-1;--e){const t=s.attributes[e];o.setAttribute(t.name,t.value)}if(i.appendChild(document.querySelector("head").cloneNode(!0)),o.innerHTML=n.innerHTML,i.appendChild(o),Array.prototype.forEach.call(i.querySelectorAll("*[data-html2canvas-ignore],*[data-togee-ignore], script"),(function(e){e.parentNode.removeChild(e)})),this.htmlNormalizationCode){const e=document.createElement("span");e.innerHTML=this.htmlNormalizationCode,i.appendChild(e)}return i.outerHTML.trim()}makeFixedElementsVisible(e){const t=[...e.querySelectorAll("*")].filter(e=>"fixed"===getComputedStyle(e,null).getPropertyValue("position")&&!e.classList.contains("togee_chat_bot_container")&&!e.classList.contains("togee_snakbar")&&!e.classList.contains("togee_video_container")&&e.getBoundingClientRect().width);console.log(t)}async waitUntil(){return await new Promise(e=>{const t=setInterval(()=>{r.screenShotInProgress||(e("foo"),clearInterval(t))},1e3)})}async getScreenShotServer(e=null,t=null,n=null,i=null,s=null,o=!1,a=null){try{e=e||document.body.scrollHeight,t=t||window.outerWidth,n=n||".webp",i=i||window.location.hostname,s=s||+new Date;const c={html:a||this.getHtml("body"),host:window.location.href,width:t,height:e,viewportHeight:window.innerHeight,extension:n,type:a?"url":"html",env:"p",showId:s,client:i,onlySave:o};r.screenShotInProgress?(this.pendingCalls++,this.latestParams=c,console.log("SDK API Latest PArams",this.latestParams),await this.waitUntil()):this.pendingCalls=1;let l=null;return 1==this.pendingCalls?(this.pendingCalls=0,l=await this.hitAPI(c)):this.pendingCalls--,l}catch(e){return console.log(e),r.screenShotInProgress=0,null}}async hitAPI(e){var t,n;e.html="url"==e.type?e.html:this.getHtml("body"),e.ref_id=null!==(t=this.refId)&&void 0!==t?t:"123123",e.token=null!==(n=this.token)&&void 0!==n?n:"123456",r.screenShotInProgress=1;return await fetch("https://screen-share-service.vdotok.com:443/CreateScreenShot/",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(t=>(r.screenShotInProgress=0,e.onlySave?t.json():t.blob())).catch((function(e){return console.log(e),r.screenShotInProgress=0,null}))}}t.default=r,r.screenShotInProgress=0},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return null!=e.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManyToMany=t.PhantomHelper=t.ScreenSharingMobile=t.Broadcast=t.Confrence=t.Client=t.version=t.name=void 0;const r=n(12).LIBRARY_VERSION;t.version=r;t.name="vdotok-call";const i=n(13);t.Client=i.default;const s=n(29);t.ManyToMany=s.default;const o=n(30);t.Confrence=o.default;const a=n(31);t.Broadcast=a.default;const c=n(7);t.ScreenSharingMobile=c.default;const l=n(9);t.PhantomHelper=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIBRARY_VERSION=void 0,t.LIBRARY_VERSION="0.0.1"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),s=n(8),o=n(4),a=n(5),c=n(6),l=n(2),u=n(17),h=n(7),d=n(3),p=n(28);class f extends r.EventEmitter{constructor(e){super(),this.localVideos=[],this.webRtcPeers=[],this.currentCustomScreenUuid=null,this.isEmptyVideoStarted=[],this.isEmptyAudioStarted=[],this.reInviteTimeout=[],this.UUIDSessions={},this.UUIDSessionTypes={},this.UUIDSessionMediaTypes={},this.videoStatus=[],this.audioStatus=[],this.messageCredentials={},this.sessionInfo=[],this.isManyToMany=!1,this.manyToMany={},this.participantsInCall=[],this.streamHelper=null,this.nativeScreenShare=[],this.htmlNormalizationCode=null,this.socketCloseCheck=null,this.broadcastingParams=[],this.reconnectCheckInterval=[],this.pingSessionStopped=[],this.screenSharingMobile=null,this.turnConfigs=null,this.stunServer=null,this.socketState="disconnected",this.reconnectCount=[],this.selfClose=!1,this.projectId=e.projectId,this.stunServer=e.stunServer,this.stunServer||(console.warn("No STUN server address provided using google's stun!"),this.stunServer="stun.l.google.com:19302"),this.projectId?e.host?(this.Authentication(e),window.addEventListener("online",this.onOnline.bind(this)),window.addEventListener("offline",this.onOffline.bind(this))):i.default.OnAuthError("Please provide host address!",this):i.default.OnAuthError("Please provide your Project ID!",this)}set McToken(e){this.mcToken=e}get McToken(){return this.mcToken}Authentication(e){console.log("====DER===",e,this.projectId,this.projectSecret,this.clientToken),e.host?this.Connect(e.host):s.default.Authorization(e.projectId,e.secret).then(e=>{if(console.log("===Authorization-outer===",e),e&&200==e.status){let t=`${e.media_server_map.protocol}://${e.media_server_map.host}:${e.media_server_map.port}/${e.media_server_map.end_point}`;this.Connect(t),console.log("===Authorization===",e)}else i.default.OnAuthError(e.message,this)})}async onOnline(){this.reconnectCount=[],this.afterOnlineProcess()}async onOffline(){this.ws.close(),this.socketState="disconnected",this.emit("call",{type:"SOCKET_DROPPED",message:"socket is dropped"}),console.info("You are offline!")}afterOnlineProcess(){let e=setInterval(async()=>{if("registered"===this.socketState){if(clearInterval(e),console.log("Current call session count",this.sessionInfo.length),this.sessionInfo&&Object.keys(this.sessionInfo).length>=1)for(let e in this.sessionInfo)for(let t in this.sessionInfo[e].participants){console.log("Currently trying auto reconnect for  call session",e,t);let n=await this.autoReconnectCall(e,null,t);console.log("Reconnect result -> ",n)}}else console.log("Socket is not registered yet! Current socket state -> ",this.socketState)},1500)}cleanIntervals(){this.socketCloseCheck&&clearInterval(this.socketCloseCheck),this.pingWorker&&this.pingWorker.postMessage({method:"clearPingInterval"}),this.reconnectCheckInterval&&clearTimeout(this.reconnectCheckInterval)}Connect(e,t=!1){this.socketState="connecting",this.ws=new WebSocket(e),this.mediaServer=e,this.cleanIntervals(),this.ws.onmessage=e=>{var n,r=JSON.parse(e.data);switch(console.log("Received message: ",r),r.requestType){case"register":200==r.responseCode?(this.McToken=r.mcToken,this.socketState="registered",this.selfClose=!1):this.socketState="fail_registration",a.default.SetRegisterResponse(r,this),t&&this.afterOnlineProcess(),this.registerPingWorker();break;case"call_response":if(console.log(" CallResponse: ",r),r.hasOwnProperty("customScreenShare"))return void("accepted"==r.response&&this.OnScreensharePublicURL(r));this.CallResponse(r),console.log("Wait for Ice received and try to reconnect!"),this.reconnectCheckInterval[r.sessionUuid]=setTimeout(()=>{var e;console.log("Ice not received, reconnecting...!");let t=this.autoReconnectCall(r.sessionUuid,null,null!==(e=r.from)&&void 0!==e?e:r.referenceId);console.log(t)},1600);break;case"incoming_call":this.callSession=r.sessionUuid,this.currentFromUser=r.from,this.UUIDSessions[r.from]=r.sessionUuid,this.UUIDSessionTypes[r.sessionUuid]=r.callType,this.UUIDSessionMediaTypes[r.from]=r.mediaType,this.mediaType=r.mediaType,this.isManyToMany="many_to_many"==r.callType,console.log("incoming_call case: ",e);let s="video"===r.callType||"video"===r.mediaType;this.sessionInfo[r.sessionUuid]={incomingCallData:r,callType:r.callType,mediaType:s?"video":"audio",isPeer:r.isPeer,isInitiator:0,call_state:"PENDING_ACCEPT"},r.data&&r.data.stateInfo||(r.data||(r.data={}),r.data.stateInfo={audio:1,video:s}),r.turnCredentials&&(this.turnConfigs=r.turnCredentials,this.turnConfigs.status=!0),i.default.OnIncomingCall(r,this);break;case"start_communication":this.SessionStart(r);break;case"stopCommunication":console.info("Communication ended by remote peer"),this.StopSession(r);break;case"session_timeout":console.info("Session Timeout"),this.StopSession(r);break;case"ice_candidate":this.reconnectCheckInterval[r.sessionUuid]&&(console.log("Ice received no need to reconnect!"),clearTimeout(this.reconnectCheckInterval[r.sessionUuid]));let o=!1,c=this.sessionInfo[r.sessionUuid];if(!c)return void console.warn("Current Call Session Info not found! reseived Message = ",r);if(o=this.getPeerById(r.sessionUuid,r.from),this.isManyToMany&&Object.keys(this.manyToMany).length&&!this.manyToMany.isPeerCall)return void this.manyToMany.AddCandidate(r);o&&c.isInitiator&&"one_to_one"==c.callType||(null===(n=null==o?void 0:o.peerConnection)||void 0===n?void 0:n.currentRemoteDescription)?this.AddCandidate(r):(o&&!o.receivedRemoteCandidates&&(o.receivedRemoteCandidates=[]),o.receivedRemoteCandidates.push(r),o.isRemoteSDPAvailable||(o.isRemoteSDPAvailable=setInterval(()=>{var e;if(null===(e=null==o?void 0:o.peerConnection)||void 0===e?void 0:e.currentRemoteDescription){clearInterval(o.isRemoteSDPAvailable),o.isRemoteSDPAvailable=null,console.log("Processing stored ice candidates!");for(let e=0;e<o.receivedRemoteCandidates.length;e++)this.AddCandidate(o.receivedRemoteCandidates[e])}},500)));break;case"session_init":if(200==r.responseCode&&r.turnCredentials){this.turnConfigs=r.turnCredentials,this.turnConfigs.status=!0;let e=[];r.receiverStatus&&r.receiverStatus.forEach(t=>{t.status&&e.push(t.referenceId)}),this.turnConfigs.receivers=e}else this.turnConfigs={status:!1};break;case"session_invite":case"re_invite":this.SessionInvite(r);break;case"p2p_reInvite":this.PeerToPeerReInvite(r);break;case"session_cancel":this.SessionCancel(r);break;case"session_break":i.default.SessionBreak(r,this);break;case"session_busy":i.default.SessionBusy(r,this);break;case"state_information":console.log("===onParticipantOffer== exiting left",r,(new Date).toLocaleTimeString()),this.SetCallerStatus(r);break;case"existing_participants":console.log("===onParticipantOffer== exiting",r,(new Date).toLocaleTimeString()),this.OnExistingParticipants(r);break;case"new_participant_arrived":console.log("===onParticipantOffer== exiting new",r,(new Date).toLocaleTimeString()),this.OnNewParticipant(r);break;case"participantLeft":console.log("===onParticipantOffer== exiting left",r,(new Date).toLocaleTimeString()),this.OnParticipantLeft(r);break;case"public_url":console.log("===public_url",r,(new Date).toLocaleTimeString()),t||(r.hasOwnProperty("customScreenShare")?this.OnScreensharePublicURL(r,!0):this.OnPublicURL(r));break;case"ping":this.SendPacket({requestType:"pong",mcToken:this.McToken});break;case"custom_rpc":case"vh_info":console.log("===custom_rpc",r,(new Date).toLocaleTimeString()),r.data&&this.OnCustomRPC(r);break;case"on_ice_candidate":400==r.responseCode?i.default.OnAddCandidate(r.message,this):console.error("Unhandled Ice event",r);break;case"session_pong":case"session_ping":200==r.responseCode?console.log("sdk session pong",r):400==r.responseCode?(console.log("SDK session ended in pong",r),this.pingSessionStopped[r.sessionUuid]=!0,this.emit("call",{type:"SESSION_SUSPENSION",message:"Show has suspended by VDOTOK",uuid:r.sessionUuid})):407==r.responseCode&&(console.log("SDK invalid authentication or invalid mcToken in pong",r),i.default.OnAuthError(r.message,this));break;case"to_receive_stream":if(console.log("to_receive_stream"),"sdp_offer"==r.sdpType){console.log("i have to prepare answer");let e={},t=r.sessionUuid;e.isPeer=1,e.sdp=r.sdp,e.sessionUuid=e.uUID=t,e.audio=this.audioStatus[t]?this.audioStatus[t]:1,e.video=this.videoStatus[t]?this.videoStatus[t]:1,e.localVideo=this.localVideo,e.requestType="to_receive_stream",e.callType="many_to_many",e.from=this.currentUser,e.to=r.referenceId,this.AcceptCall(e).then(e=>{console.log("Reinvite Accept Response: ",e)})}else console.log("i have to set remote description"),this.manyToMany.CallResponse(r)}},this.ws.onclose=t=>{this.socketState="disconnected",console.log("OnClose socket==",t),this.emit("call",{type:"SOCKET_DROPPED",message:"socket is dropped"}),this.socketCloseCheck&&clearInterval(this.socketCloseCheck),this.selfClose||(this.socketCloseCheck=setInterval(()=>{if(console.log("Auto reconnecting..... count -> ",this.reconnectCount.length),this.reconnectCount.length>5)return console.log("Unable to reconnect socket automatically!"),void this.pingWorker.postMessage({method:"clearPingInterval"});if("disconnected"==this.socketState||"fail_registration"==this.socketState){let t=(new Date).getTime(),n=this.reconnectCount&&this.reconnectCount.length?Math.abs(t-this.reconnectCount[this.reconnectCount.length-1])/1e3:0;0===n||n>=3?(this.Connect(e,!0),this.reconnectCount.push((new Date).getTime())):console.log("Not reconnecting socket as time is less then 3 seconds!")}},2e3))},this.ws.onopen=e=>{this.socketCloseCheck&&clearInterval(this.socketCloseCheck),t?this.Register(this.currentUser,this.authorizationToken,1):i.default.OnConnection(e,this),console.log("OnOpen socket==",e)},this.ws.onerror=e=>{this.socketState="disconnected",i.default.OnDisconnection(e,this),console.log("OnError socket==",e),this.emit("call",{type:"SOCKET_DROPPED",message:"socket is dropped"})}}OnCustomRPC(e){i.default.OnCustomRPC(e,this)}CheckSocketConnection(){let e=this.ws;return e.readyState!==WebSocket.CLOSED&&e.readyState!==WebSocket.CLOSING}autoReconnectCall(e,t=null,n=null){var r,i;let s=this.getPeerById(e,n);return(null==s?void 0:s.peerConnection)&&"connected"===s.peerConnection.connectionState?{message:"RTC Peer got auto connected no need for manual reconnect!",status:!0}:(t=t||(this.sessionInfo[e]&&this.sessionInfo[e].currentCallParams?this.sessionInfo[e].currentCallParams:null))?("screen"===t.videoType&&this.localVideos[e]&&this.localVideos[e].srcObject.getAudioTracks()[0].stop(),t.video=this.videoStatus[e]||t.video?1:0,t.audio=this.audioStatus[e]||t.audio?1:0,t.reInvite=1,t.refId=this.currentUser||t.refId,t.sessionUuid=e,t.isPeer=this.sessionInfo[e]?this.sessionInfo[e].isPeer:t.isPeer?1:0,t.callType=this.sessionInfo[e]?this.sessionInfo[e].callType:null!==(r=t.callType)&&void 0!==r?r:"one_to_one",t.data=null!==(i=t.data)&&void 0!==i?i:{},"one_to_many"===t.callType?this.PulicBroadCast(t):["audio","video","one_to_one"].includes(t.callType)?t.isPeer?(console.log("Peer to Peer call"),s?void s.generateOffer((n,r)=>{this.onOfferCall(n,r,this.mediaType,e,t),console.log("Call autoConnected successfully",e)},{iceRestart:!0}):(console.log("creating peer connection to generate offer"),this.Call(t))):(console.log("Non peer call, this.Call is called with params",t),this.Call(t)):{message:"Auto reconnect logic not available for call type -> "+t.callType,status:!1}):{message:"Unable to auto reconnect call, Session Info not available for this session -> "+e,status:!1}}PeerToPeerReInvite(e){var t,n;let r=this.getPeerById(e.sessionUuid,null!==(t=e.from)&&void 0!==t?t:e.referenceId);if("sdp_answer"===e.sdpType){try{r&&e.sdp&&r.processAnswer(e.sdp,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)})}catch(e){console.log(e)}return void console.log("Peer to Peer call is connected successfully!")}let s=e.sessionUuid,o=null!==(n=e.sdp)&&void 0!==n?n:e.sdpOffer;if(this.sessionInfo&&this.sessionInfo[s]&&this.sessionInfo[s].lastReinviteTime&&e.timestamp<this.sessionInfo[s].lastReinviteTime)console.log("Conflict! No need to process Answer, As this peer just send a latest reInvite and answer will be processed on other peer side");else if("one_to_one"===e.callType)if(r&&this.sessionInfo[s]&&!this.sessionInfo[s].isInitiator)r.processOffer(o,(t,n)=>t?(i.default.SessionSDP(t,this),console.error(t)):(this.onOfferIncomingCall(t,n,null,s,e.isPeer,1),s));else if(this.sessionInfo[s]&&this.sessionInfo[s].currentCallParams){let e=this.sessionInfo[s].currentCallParams;e.isPeer=1,e.sdp=o,e.sessionUuid=e.uUID=s,e.audio=this.audioStatus[s]?this.audioStatus[s]:e.audio,e.video=this.videoStatus[s]?this.videoStatus[s]:e.video,e.isReInvite=1,this.AcceptCall(e).then(e=>{console.log("Reinvite Accept Response: ",e)})}else console.error("Cannot AutoAccept Call!")}async Call(e,t=!1){return new Promise(async(n,r)=>{var i;e.callType=null!==(i=e.callType)&&void 0!==i?i:"one_to_one",e.isInitiator=e.hasOwnProperty("isInitiator")?e.isInitiator:1,e.isPeer=e.hasOwnProperty("isPeer")?e.isPeer:1,this.currentFromUser=this.currentUser;let s={};try{if(s=await this.createOptions(e),s&&!s.status)throw s.message}catch(e){return this.onErrorHandler(),r({status:!1,message:e})}s.localVideo&&(this.localVideos[e.uUID]=s.localVideo);let o=d.WebRtcPeerHelper.WebRtcPeerSendrecv(s,i=>{var s;if(i)return r(i),this.onErrorHandler(),console.error(i);(null===(s=this.sessionInfo[e.uUID])||void 0===s?void 0:s.participants)||(this.sessionInfo[e.uUID].participants={}),"many_to_many"===e.callType&&e.isPeer?this.sessionInfo[e.uUID].participants[this.getFirstValue(e.to)]={peerConnection:o}:this.sessionInfo[e.uUID].participants[this.currentUser]={peerConnection:o},o.generateOffer((r,i)=>{"one_to_many"==e.callType?this.onOfferOneToManyCall(r,i,e.uUID,e):this.onOfferCall(r,i,this.mediaType,e.uUID,e),n(t?[this.streamHelper,e.uUID]:e.uUID)})})})}AudioCall(e){return e.video=0,this.Call(e)}OnPublicURL(e){i.default.PublicURL(e,this)}OnScreensharePublicURL(e,t=!1){if(console.log("this is custom screen share call response--\x3e",e),t)return console.log("this is custom screen share call response and sending rpc only--\x3e",e),void this.sendStateRPC({screenStreamUUID:this.associatedCamUUID,message:"Screen Share started",nativeScreenShare:0,is_screen_on:1,height:window.innerHeight,width:window.innerWidth,page_url:window.location.href,uuid:e.sessionUuid,type:"CUSTOM_SCREEN_SHARE_REQUEST"},this.associatedCamUUID);this.messageCredentials=e.customScreenShare,e.sessionUuid&&(this.currentCustomScreenUuid=e.sessionUuid),this.setupMessagingSdk(e,this.screenshareExtraData)}async setupMessagingSdk(e,t){let n=this.associatedCamUUID;console.log("this is messages credentials--\x3e",e),this.screenSharingMobile?this.screenSharingMobile.initializeMessaging(e):this.screenSharingMobile=new h.default(this,n,e,this.authorizationToken,this.currentUser);await this.screenSharingMobile.getScreenShareStream(!1,!0);t&&(t.image_screen=!0),this.sendStateRPC({status:1},n,0,"custom_billing"),this.sendStateInformation(1,0,n,t)}OnExistingParticipants(e){this.sendViewersCountRPC(e),this.isManyToMany&&Object.keys(this.manyToMany).length&&this.manyToMany.OnExistingParticipants(e)}sendViewersCountRPC(e){this.sessionInfo[e.sessionUuid]&&"one_to_many"===this.sessionInfo[e.sessionUuid].callType&&(this.participantsInCall[e.sessionUuid]=e.totalParticipants?e.totalParticipants:this.participantsInCall[e.sessionUuid]+1,this.sendCustomRPC({type:"Viewer_Count",message:"Viewers count updated.",uuid:e.sessionUuid,count:this.participantsInCall[e.sessionUuid]-1},e.sessionUuid))}OnNewParticipant(e){this.isManyToMany&&Object.keys(this.manyToMany).length?this.manyToMany.OnNewParticipant(e):(i.default.OnNewParticipant(e,this),this.sendViewersCountRPC(e))}OnParticipantLeft(e){this.sendViewersCountRPC(e),this.isManyToMany&&Object.keys(this.manyToMany).length&&this.manyToMany.OnParticipantLeft(e)}getParticipantsCount(e){return this.participantsInCall[e]<0&&(this.participantsInCall[e]=0),this.participantsInCall[e]-1}StopSession(e){this.isManyToMany||(i.default.SessionEnd(e,this),this.DisposeWebrtc(!0))}SessionInvite(e){this.isManyToMany||i.default.SessionInvite(e,this)}SessionCancel(e,t="cancel"){console.log("SessionCancel messageData",{messageData:e}),"break"!=t&&this.sendViewersCountRPC(e),this.isManyToMany&&Object.keys(this.manyToMany).length?this.manyToMany.OnSessionCancel(e):i.default.SessionCancel(e,this)}SetCallerStatus(e){this.isManyToMany&&Object.keys(this.manyToMany).length?this.manyToMany.SetParticipantStatus(e):i.default.SetCallerStatus(e,this)}async AddCandidate(e){if(console.log("## AddCandidate"),this.rtcPears)return void await this.rtcPears.addIceCandidate(e.candidate);if(this.isManyToMany&&Object.keys(this.manyToMany).length)return void this.manyToMany.AddCandidate(e);let t=this.getPeerById(e.sessionUuid);if(t)t.addIceCandidate(e.candidate,e=>{if(e)return i.default.OnAddCandidate(e,this),console.error("Error adding candidate: "+e)});else{if(!this.webRtcPeer)return i.default.OnAddCandidate("No Peer connection found!",this),console.error("Error adding candidate: No Peer connection found!");this.webRtcPeer.addIceCandidate(e.candidate,e=>{if(e)return i.default.OnAddCandidate(e,this),console.error("Error adding candidate: "+e)})}}CallResponse(e){var t,n;if(this.rtcPears){let t=new RTCSessionDescription({type:"answer",sdp:e.sdpAnswer});return void this.rtcPears.setRemoteDescription(t)}if(this.isManyToMany&&Object.keys(this.manyToMany).length)return void this.manyToMany.CallResponse(e);i.default.OnCallResponse(e,this);let r=this.getPeerById(e.sessionUuid,null!==(t=e.from)&&void 0!==t?t:e.referenceId);console.info("CallResponse",r,e),"accepted"==e.response&&r.processAnswer(null!==(n=e.sdpAnswer)&&void 0!==n?n:e.sdp,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)})}SessionStart(e){var t;if(this.rtcPears){let t=new RTCSessionDescription({type:"answer",sdp:e.sdpAnswer});return void this.rtcPears.setRemoteDescription(t)}if(this.isManyToMany&&Object.keys(this.manyToMany).length&&!this.manyToMany.isPeerCall)return void this.manyToMany.SessionStart(e);i.default.SessionStart(e,this);let n=this.getPeerById(e.sessionUuid);if(n)e.sdpAnswer||e.sdp?n.processAnswer(null!==(t=e.sdpAnswer)&&void 0!==t?t:e.sdp,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)}):console.log("This is peer to peer call no need to process Answer on receiver side.");else{if(!this.webRtcPeer)return i.default.SessionSDP("Peer connection not found!",this),console.error("Peer connection not found!");this.webRtcPeer.processAnswer(e.sdpAnswer,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)})}}async AcceptCall(e){return e.uUID||(e.uUID=e.sessionUuid),e.callType=this.sessionInfo[e.uUID]&&this.sessionInfo[e.uUID].callType?this.sessionInfo[e.uUID].callType:"one_to_one",e.isInitiator=0,e.hasOwnProperty("isPeer")||(this.sessionInfo[e.uUID].hasOwnProperty("isPeer")?e.isPeer=this.sessionInfo[e.uUID].isPeer:e.isPeer=1),new Promise(async(t,n)=>{var r,s,o;this.localVideo=e.localVideo;let a=this.currentFromUser,c=e.uUID=e.sessionUuid;this.UUIDSessions[a]=this.UUIDSessions[a]?this.UUIDSessions[a]:c,this.UUIDSessionTypes[c]=null!==(r=this.UUIDSessionTypes[c])&&void 0!==r?r:"one_to_one",this.UUIDSessionMediaTypes[a]=null!==(s=this.UUIDSessionMediaTypes[a])&&void 0!==s?s:e.video?"video":"audio";let l={};e.to=null!==(o=e.to)&&void 0!==o?o:[a];try{if(l=await this.createOptions(e),l&&!l.status)throw l.message}catch(e){return this.onErrorHandler(),n({status:!1,message:e})}if(l.localVideo&&(this.localVideos[c]=l.localVideo),c){let r=d.WebRtcPeerHelper.WebRtcPeerSendrecv(l,s=>{var o;s&&(this.onErrorHandler(),n(s));let l=e.isPeer||(this.sessionInfo[c]&&this.sessionInfo[c].incomingCallData?this.sessionInfo[c].incomingCallData.isPeer:0),u=e.sdp||(this.sessionInfo[c]&&this.sessionInfo[c].incomingCallData?this.sessionInfo[c].incomingCallData.callerSdp:"");(null===(o=this.sessionInfo[c])||void 0===o?void 0:o.participants)||(this.sessionInfo[c].participants={}),"many_to_many"===e.callType&&e.isPeer?this.sessionInfo[c].participants[a]={peerConnection:r}:this.sessionInfo[c].participants[this.currentUser]={peerConnection:r},l?r.processOffer(u,(n,r)=>{if(n)return i.default.SessionSDP(n,this),console.error(n);this.onOfferIncomingCall(n,r,a,c,1,e),t(c)}):r.generateOffer((n,r)=>{this.onOfferIncomingCall(n,r,a,c,0,e),t(c)})})}else n("Please provide session id of call you want to join!")})}RejectCall(e=null,t=null){e||(e=this.currentFromUser),t||(t=this.UUIDSessions[e]);let n={requestType:"session_invite",type:"response",from:e,requestId:(new Date).getTime().toString(),sessionUuid:t,responseCode:496,responseMessage:"rejected"};this.SendPacket(n),this.DisposeWebrtc(!1,e,t)}sendSessionBusy(e=null){e||(e=this.currentFromUser);let t={requestType:"session_busy",referenceId:this.currentUser,requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[e],mcToken:this.McToken};this.SendPacket(t)}onOfferIncomingCall(e,t,n,r=null,s=0,o){var a;if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the offer");!r&&n&&(r=this.UUIDSessions[n]);let c={type:"response",requestType:null!==(a=o.requestType)&&void 0!==a?a:"session_invite",sdpOffer:t,requestId:(new Date).getTime().toString(),sessionUuid:r,responseCode:200,mcToken:this.mcToken,referenceId:this.currentUser,responseMessage:"accepted"};s&&(c.isPeer=1),("to_receive_stream"===o.requestType||o.isReInvite)&&(o.isReInvite?c.requestType="p2p_reInvite":(c.to=o.to,c.from=o.from),delete c.sdpOffer,c.sdp=t,c.sdpType="sdp_answer"),console.log("===OnOffering Answer",c),this.SendPacket(c),this.sendStateInformation(this.videoStatus[r],this.audioStatus[r],r,{})}Register(e,t,n=0){this.streamHelper||(this.streamHelper=new u.default(this)),this.streamHelper.getNatType(this.stunServer).then(r=>{this.currentUser=e,this.authorizationToken=t;let i=new o.default;r.natType&&r.publicIps&&(i.natType=r.natType,i.publicIps=r.publicIps),i.requestId=(new Date).getTime().toString(),i.projectId=this.projectId,i.tenantId=this.projectId,i.referenceId=e,i.authorizationToken=t,i.deviceId=this.getDeviceId(),n&&(i.reConnect=1),i.SendRegisterRequest(this.ws)})}PulicBroadCast(e){return e.broadcastType=1,e.to=[],this.Broadcasting(e)}async createOptions(e,t=0){if("registered"!==this.socketState)return{message:"Not registered with VDOTOK! Current state -> "+this.socketState,status:!1};let n=e.hasOwnProperty("sessionUuid")?e.sessionUuid:(new Date).getTime().toString();this.sessionInfo[n]||(this.sessionInfo[n]={callType:e.callType,isPeer:e.isPeer||0,isInitiator:e.isInitiator||0,call_state:"STARTING"}),this.videoStatus[n]=e.video?1:0,this.isEmptyVideoStarted[n]=!this.videoStatus[n],this.audioStatus[n]=e.audio?1:0,this.isEmptyAudioStarted[n]=!this.audioStatus[n],e.sessionUuid=e.uUID=n,this.sessionInfo[n].mediaType=this.mediaType=e.video?"video":"audio",this.to=""===e.to||Array.isArray(e.to)?e.to:[e.to],e.assUUID=e.hasOwnProperty("associatedSessionUuid")?e.associatedSessionUuid:"",e.isPublic=e.hasOwnProperty("broadcastType")?e.broadcastType:0,e.data||(e.data={}),e.data.stateInfo={video:e.video,audio:e.audio};let r=!1;this.sessionInfo&&this.sessionInfo[e.uUID]&&(r=this.sessionInfo[e.uUID].isInitiator,this.sessionInfo[e.uUID].isPeer=e.isPeer=e.isPeer||this.sessionInfo[e.uUID].isPeer);let i={mandatory:{maxFrameRate:30,minFrameRate:15}};e.video||(i=!1);var s={audio:e.audio,video:i};(0,l.SetPlaysInline)(e.localVideo);let o={mediaConstraints:s,onicecandidate:t=>this.onIceCandidate(t,e.uUID,this.getFirstValue(e.to)),onerror:this.onError,status:!0};this.getFirstValue(e.to)&&(o=this.AddOnTrackHandler(o,n,this.getFirstValue(e.to))),this.streamHelper||(this.streamHelper=new u.default(this)),"screen"!=e.videoType&&"desktop"!=e.videoType||(e.videoType="screen"),"camera"!=e.videoType&&"cam"!=e.videoType&&"user"!=e.videoType&&"webcam"!=e.videoType||(e.videoType="camera"),"camera"!=e.videoType&&"screen"!=e.videoType&&"audio"!=e.videoType&&(console.info("Valid options are camera or screen, choosing camera"),e.videoType="camera");let a=await this.streamHelper.getStream(e.audio,e.video,e.videoType);if(e.video&&!a.video)return{status:!1,message:"Unable to get video stream"};if(a.video&&a.audio?o.videoStream=a.combine:a.audio&&(o.audioStream=a.audio),e.localVideo?o.localVideo=e.localVideo:a.combine&&(o.localVideo=this.getTempVideo(a.combine)),e.remoteVideo&&(o.remoteVideo=e.remoteVideo),a.video&&"screen"===e.videoType&&(a.video.getVideoTracks()[0].onended=()=>{this.screenStreamStopped(e.uUID)}),this.sessionInfo[n].currentCallParams=e,this.nativeScreenShare[e.uUID]=a.nativeScreenShare,t&&(o.params=e),e.isPeer){if(r)return new Promise((t,n)=>{this.sendStateRPC({},-1,0,"session_init",{to:e.to,from:this.currentFromUser,mediaType:e.video?"video":"audio",sessionType:"call",callType:e.callType});let r=setInterval(()=>{this.turnConfigs&&this.turnConfigs.receivers&&!this.turnConfigs.receivers.length&&(this.onErrorHandler(),n({status:!1,message:"User is offline!"})),this.turnConfigs&&(clearInterval(r),o.receivers=this.turnConfigs.receivers,o=this.setStunTurn(o),t(o))},100)});o=this.setStunTurn(o)}return o}getFirstValue(e,t=!1){let n=e;return!(!Array.isArray(e)||(n=e[0],!t))||n}AddOnTrackHandler(e,t,n){return e.ontrack=e=>{this.sessionInfo[t].streamsCollection||(this.sessionInfo[t].streamsCollection=[]),this.sessionInfo[t].streamsCollection[n]={available:!0,stream:e.streams},i.default.OnTrack(this.sessionInfo[t].streamsCollection,this,n)},e}setStunTurn(e){return this.turnConfigs&&this.turnConfigs.status&&(e.configuration={iceServers:[{urls:["stun:"+this.stunServer]},{username:this.turnConfigs.username,credential:this.turnConfigs.credential,urls:this.turnConfigs.url}]}),this.turnConfigs=null,e}async startScreenShare(e,t=null){let n=(new Date).getTime().toString()+"-xy",r=new c.default;return r.from=this.currentUser,r.to=[],r.requestId=n,r.sessionUuid=n,r.mcToken=this.McToken,r.sdpOffer="",r.type="request",r.requestType="session_invite",r.mediaType="video",r.callType="one_to_many",r.sessionType="customScreenShare",r.referenceId=this.currentUser,r.custom_field("broadcastType",1),r.custom_field("associatedSessionUuid",e),t.reInvite&&t.uuid?(r.requestType="re_invite",r.sessionUuid=t.uuid):r.requestType="session_invite",r.SendCallRequest(this.ws),console.log("this is request from mobile for screenshare->",r),e&&(this.associatedCamUUID=e),t&&(this.screenshareExtraData=t),r.sessionUuid}cancelSession(e){console.log("cancel this session--\x3e",e);let t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:e,mcToken:this.mcToken};console.log("custom screen cancel request--\x3e",t),this.SendPacket(t)}pauseScreenShare(e,t=null){return!!this.screenSharingMobile&&(this.screenSharingMobile.pauseScreenCapture=!0,t&&(t.image_screen=!0),this.sendStateRPC({status:0},e,0,"custom_billing"),this.sendStateInformation(0,0,e,t),t.currentCustomScreenSession&&(this.cancelSession(t.currentCustomScreenSession),this.currentCustomScreenUuid&&(this.currentCustomScreenUuid=null)),!0)}resumeScreenShare(e,t=null){return!!this.screenSharingMobile&&(this.screenSharingMobile.pauseScreenCapture=!1,t&&(t.image_screen=!0),this.sendStateRPC({status:1},e,0,"custom_billing"),this.sendStateInformation(1,0,e,t),!0)}async takeScreenImage(){return!!this.screenSharingMobile&&await this.screenSharingMobile.startToGeeCaptureScreen()}getTempVideo(e){const t=document.createElement("video");return this.setSrcObject(e,t),t.className="vdotok-temp-video",t.muted=!0,t.volume=0,t.width=e.width||640,t.height=e.height||480,t}setSrcObject(e,t){const n=window.URL||window.webkitURL;"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:"createObjectURL"in n?t.src=n.createObjectURL(e):console.log("createObjectURL/srcObject both are not supported.")}async Broadcasting(e){return e.callType="one_to_many",e.isInitiator=1,e.isPeer=0,e.sessionType="call",this.Call(e,!0)}onErrorHandler(){this.streamHelper&&this.streamHelper.removeAllStreams()}onOfferOneToManyCall(e,t,n,r){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the call offer ",e);this.UUIDSessions[this.currentUser]=n,this.UUIDSessionTypes[n]="one_to_many";let s=new c.default;s.from=this.currentUser,s.to=this.to,s.requestId=n,s.sessionUuid=n,s.mcToken=this.McToken,s.sdpOffer=t,s.callType="one_to_many",s.sessionType=r.sessionType,s.custom_field("broadcastType",r.isPublic),s.custom_field("associatedSessionUuid",r.assUUID),r.reInvite&&r.refId?(s.requestType="re_invite",s.referenceId=r.refId):(s.requestType="session_invite",delete s.referenceId),r.isRecord?s.isRecord=1:s.isRecord=0,s.SendCallRequest(this.ws);let o=this.getPeerById(n);(null==o?void 0:o.peerConnection)&&o.peerConnection.addEventListener("iceconnectionstatechange",this.onIceError.bind(this,n,this.currentUser),!1),this.sendStateInformation(this.videoStatus[n],this.audioStatus[n],n,{fromVideo:!0,reInvite:r.reInvite})}onIceError(e,t,n){let r=this.getPeerById(e,n);(null==r?void 0:r.peerConnection)&&r.peerConnection.iceConnectionState&&["closed","failed","disconnected"].includes(r.peerConnection.iceConnectionState)&&(this.reInviteTimeout[e]&&clearTimeout(this.reInviteTimeout[e]),console.log("SDK iceconnectionstatechange",t),this.reInviteTimeout[e]=setTimeout(()=>{console.log("Re_inviting because ice state = ",r.peerConnection.iceConnectionState);try{let t=this.autoReconnectCall(e,null,n);console.log(t)}catch(e){console.log("failed to reinvite on ice fail",e)}},1e3))}onOfferCall(e,t,n,r,s){var o;if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the call offer ",e);let a=new c.default;a.from=this.currentUser,a.to=s.to,a.requestId=(new Date).getTime().toString(),a.sessionUuid=r,a.mcToken=this.McToken,a.isPeer=s.isPeer,a.sdpOffer=t,a.mediaType=n,a.type="request",s.data&&Object.keys(s.data).length?a.data=s.data:a.data={},s.with_ai?a.callType="one_to_one_with_ai":a.callType=s.callType?s.callType:"one_to_one","many_to_many"===a.callType&&s.participants&&s.participants.length&&(a.participants=s.participants),(s.reInvite||"to_receive_stream"==s.requestType)&&(a.sdp=t,a.sdpType="sdp_offer",a.sdpOffer="",delete a.sdpOffer),s.reInvite&&s.refId?(a.referenceId=s.refId,a.requestType="re_invite",a.isPeer&&(a.requestType="p2p_reInvite",this.sessionInfo[r].lastReinviteTime=a.timestamp=(new Date).getTime().toString()),a.custom_field("fromUser",this.currentUser),a.deleteKey("from"),a.deleteKey("to")):(a.requestType=null!==(o=s.requestType)&&void 0!==o?o:"session_invite",s.timeout&&s.timeout>0&&(this.sessionInfo[r].callTimeoutInterval=setTimeout(()=>{["STARTING","ALERTING","CONNECTING","TRYING"].includes(this.sessionInfo[r].call_state)&&this.sendStateRPC({},r,0,"session_timeout")},1e3*s.timeout)),delete a.referenceId),a.SendCallRequest(this.ws),this.UUIDSessions[this.currentUser]=r,this.UUIDSessionTypes[r]=a.callType,console.log(" OnOfferCall :: :: ::",n),this.sendStateInformation(this.videoStatus[r],this.audioStatus[r],r,{}),s.reInvite&&i.default.SetCallerStatus({videoInformation:this.videoStatus[r],audioInformation:this.audioStatus[r],sessionUuid:r,referenceId:s.refId,data:{}},this)}DisposeWebrtc(e,t=null,n=null){if(t||(t=this.currentFromUser),this.sessionInfo)for(var r in this.sessionInfo)if(!n||n&&n==r){for(let t in this.sessionInfo[r].participants){let n=this.getPeerById(r,t);n&&(n.dispose(),e&&this.sendDisposePacket(r),(null==n?void 0:n.peerConnection)&&n.peerConnection.removeEventListener("iceconnectionstatechange",this.onIceError,!1))}this.sessionInfo[r].callTimeoutInterval&&clearTimeout(this.sessionInfo[r].callTimeoutInterval),delete this.sessionInfo[r]}if(this.webRtcPeer){this.webRtcPeer.dispose(),this.webRtcPeer=null,e&&this.sendDisposePacket(this.UUIDSessions[t]);let n=this.UUIDSessions[t];delete this.UUIDSessionTypes[n],delete this.UUIDSessions[t]}}sendDisposePacket(e){var t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:e,mcToken:this.mcToken};this.SendPacket(t)}onError(e){i.default.OnRTCPeer(e,this)}onIceCandidate(e,t,n){console.log("Local candidate"+JSON.stringify(e)),n||(n=this.currentUser);var r={id:"ice_candidate",requestType:"ice_candidate",type:"request",candidate:e,referenceId:n,sessionUuid:t};console.log("Local candidate Msg",r),this.SendPacket(r)}SendPacket(e){var t=JSON.stringify(e);console.log("Sending message: "+t,this.ws.readyState),null!=this.ws?this.ws.send(t):i.default.OnAuthInitialError("",this)}EndCall(e){e||(e=this.currentFromUser),this.localVideo&&this.localVideos.push(this.localVideo);for(let e in this.localVideos){let t=this.localVideos[e];t&&t.srcObject&&t.srcObject.getTracks().forEach(e=>{e.stop()})}this.streamHelper&&this.streamHelper.removeAllStreams(),this.DisposeWebrtc(!0),this.socketCloseCheck&&clearInterval(this.socketCloseCheck),this.screenSharingMobile&&(this.screenSharingMobile.disconnectMessaging(),this.currentCustomScreenUuid&&(this.cancelSession(this.currentCustomScreenUuid),this.currentCustomScreenUuid=null))}CancelCall(){let e=this.currentFromUser,t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[e],mcToken:this.McToken};this.SendPacket(t),this.DisposeWebrtc(!1)}sendStateInformation(e=0,t=0,n=null,r=null){let i=this.isManyToMany?this.callSession:this.UUIDSessions[this.currentFromUser];n&&(i=n),this.audioStatus[i]=t,this.videoStatus[i]=e;let s={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:i,mcToken:this.McToken,referenceId:this.currentUser,audioInformation:t,videoInformation:e};r&&(s.data=r),this.SendPacket(s)}SetMicMute(e){let t=this.isManyToMany?this.callSession:this.UUIDSessions[this.currentFromUser];if(e&&(t=e),this.localVideos[t]&&null!=this.localVideos[t]){let e=1==this.videoStatus[t]?1:0;this.audioStatus[t]=0,this.sendStateInformation(e,0,t,{fromAudio:!0});let n=this.localVideos[t];null!=n.srcObject&&n.srcObject.getAudioTracks()&&n.srcObject.getAudioTracks()[0]&&n.srcObject.getAudioTracks()[0].stop(),"audio"==n.localName&&n.audioTracks&&n.audioTracks[0]&&n.audioTracks[0].stop()}}async replaceStreamTracks(e,t,n="video"){var r;if(this.isManyToMany){let i=!1;for(let s in null===(r=this.sessionInfo[t])||void 0===r?void 0:r.participants)i=await this.replaceTracksInternal(t,e,n,s),i||console.error("Stream tracks not replaced for",t,e,n,s);return i}return this.replaceTracksInternal(t,e,n)}async replaceTracksInternal(e,t,n,r=null){let i=!1,s=this.getPeerById(e,r).peerConnection.getSenders();for(const o of s)if(o&&o.track&&o.track.kind===n){let s=t.getTracks().filter(e=>e.kind===n)[0];i=await o.replaceTrack(s),void 0===i?i=!0:console.error("Error while replacing tracks",i,e,n,r)}return i}async SetMicUnmute(e){let t=this.isManyToMany?this.callSession:this.UUIDSessions[this.currentFromUser];if(e&&(t=e),this.streamHelper||(this.streamHelper=new u.default(this)),this.localVideos[t]&&null!=this.localVideos[t]){let n=1==this.videoStatus[t]?1:0;this.audioStatus[t]=1;let r=null,i=null,s=this.localVideos[t];this.isEmptyAudioStarted[e];try{r=(await this.streamHelper.getStream(1,0,"audio")).audio,s&&s.srcObject&&s.srcObject.getAudioTracks()&&s.srcObject.getAudioTracks()[0]&&s.srcObject.getAudioTracks()[0].stop();await this.replaceStreamTracks(r,e,"audio");this.isEmptyAudioStarted[e]=0}catch(e){return console.log(e),{status:!1,message:e}}return this.sendStateInformation(n,1,t,{fromAudio:!0}),r&&(i=new MediaStream,r.getAudioTracks().forEach(e=>{i.addTrack(e)})),s&&s.srcObject?(i&&(s.srcObject.getVideoTracks()&&s.srcObject.getVideoTracks()[0]&&s.srcObject.getVideoTracks().forEach(e=>{i.addTrack(e)}),s.srcObject=i),s.srcObject.getAudioTracks()[0].enabled=!0):"audio"==s.localName&&(i&&(s.videoTracks&&s.videoTracks[0]&&i.addTrack(s.videoTracks[0]),s.srcObject=i),s.audioTracks[0].enabled=!0),{status:!0,error:!1}}}async SetCameraOn(e,t="user",n=null){let r=this.isManyToMany?this.callSession:this.UUIDSessions[this.currentFromUser];e&&(r=e);let i=null,s=null,o=0;this.videoStatus[r]=1,this.streamHelper||(this.streamHelper=new u.default(this)),this.isEmptyVideoStarted[e];try{if(!("environment"===t&&await this.streamHelper.getBackCameraId()||"environment"!==t))return{status:!1,message:"Back Camera not found!"};{this.localVideos[r]&&this.localVideos[r].srcObject&&this.localVideos[r].srcObject.getVideoTracks()[0]&&this.localVideos[r].srcObject.getVideoTracks()[0].stop();let n=await this.streamHelper.getStream(0,1,"screen"==t?"screen":"camera",t);if(i=n.video,!i)return{status:!1,message:"Unable to get Video Stream!"};i&&"screen"==t&&(i.getVideoTracks()[0].onended=()=>{this.screenStreamStopped(r)}),this.nativeScreenShare[r]=n.nativeScreenShare;await this.replaceStreamTracks(i,e,"video");this.isEmptyVideoStarted[e]=0,o=1}}catch(e){return this.videoStatus[r]=0,console.log("Error",e),{status:!1,message:e}}if(o&&this.localVideos[r]&&null!=this.localVideos[r]){let e=this.localVideos[r];return this.sendStateInformation(1,this.audioStatus[r],r,n),i&&(s=new MediaStream,i.getVideoTracks().forEach(e=>{s.addTrack(e)})),e&&e.srcObject&&(s&&(e.srcObject.getAudioTracks()[0]&&e.srcObject.getAudioTracks().forEach(e=>{s.addTrack(e)}),e.srcObject=s),this.localVideos[r].srcObject.getVideoTracks()[0].enabled=!0),{status:!0,error:!1}}}SetCameraOff(e,t=null){let n=this.isManyToMany?this.callSession:this.UUIDSessions[this.currentFromUser];e&&(n=e);try{if(this.localVideos[n]&&null!=this.localVideos[n])return this.videoStatus[n]=0,this.localVideos[n].srcObject&&this.localVideos[n].srcObject.getVideoTracks()[0]&&(this.localVideos[n].srcObject.getVideoTracks()[0].stop(),this.localVideos[n].srcObject.getVideoTracks()[0].onended=null),this.sendStateInformation(0,this.audioStatus[n],n,t),!0}catch(e){return console.log("Error while turning off video",e),!1}}sendCustomRPC(e,t){let n={requestType:"custom_rpc",type:"request"};n.requestId=(new Date).getTime().toString(),n.sessionUuid=t||this.UUIDSessions[this.currentUser],n.mcToken=this.McToken,n.referenceId=this.currentUser,n.data=e,this.ws.send(JSON.stringify(n))}sendStateRPC(e,t,n=1,r="hv_info",i={}){let s={};s.requestType=r,s.type="request",s.requestId=(new Date).getTime().toString(),-1===t?delete s.sessionUuid:s.sessionUuid=t||this.UUIDSessions[this.currentUser],s.mcToken=this.McToken,s.referenceId=this.currentUser,s.data=e,s.store=n,i&&Object.keys(i).length&&(s=Object.assign(Object.assign({},s),i)),this.ws.send(JSON.stringify(s))}screenStreamStopped(e){i.default.screenOffByUser({sessionUuid:e},this)}registerPingWorker(){const e=new Blob(["let pingInterval;\n                            onmessage = (res) => {\n                                let data = res.data;\n                                console.log('Message received from main script');\n                                const method = data.method;\n                                if (method === 'format') {\n                                    postMessage({\n                                        data: {\n                                            'res': 'I am a customized result string.',\n                                        }\n                                    });\n                                }\n                                else if (method === 'startPingInterval')\n                                {\n                                    if(!data.interval)\n                                    {\n                                        data.interval =  5000;\n                                    }\n                                    clearPingInterval();\n                                    startPingInterval(data.interval);\n                                }\n                                else if(method === 'clearPingInterval')\n                                {\n                                    clearPingInterval();\n                                }\n                                console.log('Posting message back to main script');\n                            }\n                            \n                            function startPingInterval(interval)\n                            {\n                                pingInterval = setInterval(()=>{\n                                    postMessage({\n                                            'sendPing': true\n                                    });\n                                },interval)\n                            }\n                            function  clearPingInterval()\n                            {\n                                if(pingInterval)\n                                {\n                                    clearInterval(pingInterval);\n                                }\n                            }\n                            "],{type:"application/javascript"});this.pingWorker=new Worker(URL.createObjectURL(e)),this.pingWorker&&(this.pingWorker.onmessage=e=>{e&&e.data&&e.data.sendPing&&this.sendPing()},this.pingWorker.postMessage({method:"startPingInterval",interval:5e3}))}sendPing(){try{this.sendStateRPC({},-1,0,"ping"),console.log("SDK Ping sent!")}catch(e){console.log("Error while sending ping to server.",e)}}updateBandwidthRestriction(e,t){let n="AS";return"firefox"===adapter.browserDetails.browser&&(t=1e3*(t>>>0),n="TIAS"),e=-1===e.indexOf("b="+n+":")?e.replace(/c=IN (.*)\r\n/,"c=IN $1\r\nb="+n+":"+t+"\r\n"):e.replace(new RegExp("b="+n+":.*\r\n"),"b="+n+":"+t+"\r\n")}removeBandwidthRestriction(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}GroupCall(e){this.currentFromUser=this.currentUser;let t=new p.default(this),n=(new Date).getTime().toString();return e.uUID=n,this.localVideos[n]=e.localVideo,this.manyToMany=t,this.isManyToMany=!0,this.sessionInfo[n]={callType:"many_to_many",isPeer:e.isPeer||0,isInitiator:1,call_state:"STARTING"},this.manyToMany.GroupCall(e)}JoinGroupCall(e){let t=new p.default(this);return t.callSession=this.callSession,t.mediaType=this.mediaType,this.manyToMany=t,this.mediaType=e.callType,this.localVideo=e.localVideo,this.isManyToMany=!0,this.manyToMany.JoinGroupCall(e,this.callSession)}SetParticipantVideo(e,t){this.manyToMany.SetParticipantVideo(e,t)}LeaveGroupCall(){this.manyToMany.LeaveGroupCall()}Disconnect(){this.cleanIntervals(),this.selfClose=!0,this.ws&&this.ws.close(),this.sessionInfo=[]}getPeerById(e,t=null){var n,r,i,s,o,a,c,l;t&&"many_to_many"==this.sessionInfo[e].callType||(t=this.currentUser);let u=null===(i=null===(r=null===(n=this.sessionInfo[e])||void 0===n?void 0:n.participants)||void 0===r?void 0:r[t])||void 0===i?void 0:i.peerConnection;if(!u&&(null===(s=this.sessionInfo[e])||void 0===s?void 0:s.participants)){let t=Object.keys(null===(o=this.sessionInfo[e])||void 0===o?void 0:o.participants);1==t.length&&(u=null===(l=null===(c=null===(a=this.sessionInfo[e])||void 0===a?void 0:a.participants)||void 0===c?void 0:c[t[0]])||void 0===l?void 0:l.peerConnection)}return u||(console.error("Unable to find peer connection object",e,t,this.sessionInfo),console.trace()),u}getDeviceId(){let e=localStorage.getItem("VDOTOKDeviceId");return e||(e=crypto.randomUUID(),localStorage.setItem("VDOTOKDeviceId",e)),e}}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER=void 0,t.SERVER="https://vtkapi.vdotok.dev/API/v0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={requestType:"register",type:"request",requestId:"YX9BLHSS0WLCI6ESCS2D29T5UW2YFJSY",tenantId:"12345",projectId:"12345",referenceId:"0d00e363ef75c8cc76d1ee79e950b30c",authorizationToken:"e2a10ce93bb2affbe767e843c0bfc76c",socketType:0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={from:"User-A",to:"User-B",type:"request",requestType:"session_invite",sessionType:"call",callType:"one_to_one",mediaType:"video",requestId:"UUID",sessionUuid:"sgdjkfgskjdgfs6876868",mcToken:"",sdpOffer:"",data:{},timestamp:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7);t.default=class{constructor(e=null,t=null){this.audioStream=null,this.videoStream=null,this.aStream=null,this.audioContext=null,this.audioContextDest=null,this.createdFromContext=0,this.emptyStreamInterval=null,this.currentStreamType="camera",this.currentFaceMode="user",this.publicIps=[],this.checkOnlineStatus=async()=>{try{const e=await fetch("/1pixel.png");return e.status>=200&&e.status<300}catch(e){return!1}},this.emitter=e,this.showId=t}async getBackCameraId(){const e=await navigator.mediaDevices.enumerateDevices();let t=null,n=!1;for(let r=0;r<e.length;r++)if("videoinput"===e[r].kind&&e[r].label.includes("0")){t=e[r].deviceId,n=!0;break}if(!n)for(let n=0;n<e.length;n++)if("videoinput"===e[n].kind&&e[n].label&&e[n].label.toLowerCase().includes("back")){t=e[n].deviceId;break}return t}delay(e){return new Promise(t=>setTimeout(t,e))}async getStream(e=!0,t=!0,n="camera",i="user"){const s={audio:!1,video:!1};if(e&&(s.audio={echoCancellation:!0,noiseSuppression:!0}),t&&this.videoStream&&this.videoStream.active&&this.currentStreamType===n&&"camera"===n)return(e&&this.createdFromContext||e&&!this.audioStream.active)&&(this.audioStream=await navigator.mediaDevices.getUserMedia({audio:s.audio})),{audio:this.audioStream,video:this.videoStream,combine:this.getCombine()};if(e&&this.audioStream&&this.audioStream.active&&"audio"===n)return{audio:this.audioStream,video:this.videoStream,combine:this.getCombine()};if(t&&"screen"==n&&(this.screenSharingMobile=new r.default(this.emitter),this.videoStream=await this.screenSharingMobile.getScreenShareStream(!1),this.currentStreamType=n),t&&"camera"==n){if(this.aStream&&(this.aStream.getVideoTracks().forEach((function(e){e.stop()})),await this.delay(1e3)),s.video={width:{ideal:1024},height:{ideal:768},frameRate:{ideal:18},aspectRatio:{ideal:1.7777777778}},"environment"===i){const e=await this.getBackCameraId();e?s.video.deviceId={exact:e}:s.video.facingMode={exact:i},this.currentFaceMode=i}else this.detectMob()?(s.video.facingMode={exact:"user"},this.currentFaceMode="user"):this.currentFaceMode="user";this.currentStreamType=n}if(this.aStream=new MediaStream,s.audio||s.video)try{this.aStream=await navigator.mediaDevices.getUserMedia(s)}catch(e){console.error(e)}s.audio&&this.aStream?(this.createdFromContext=0,this.audioStream=new MediaStream(this.aStream.getAudioTracks())):(this.audioStream=new MediaStream([this.silence()]),this.createdFromContext=1),s.video&&this.aStream?this.videoStream=new MediaStream(this.aStream.getVideoTracks()):"audio"==n||t&&"screen"==n||(this.videoStream=new MediaStream([this.black({width:640,height:480})]));const o={video:this.videoStream,audio:this.audioStream,combine:this.getCombine()};return this.screenSharingMobile&&t&&"screen"==n&&(o.nativeScreenShare=this.screenSharingMobile.nativeScreenShare),o}getCombine(){const e=[];return this.videoStream&&e.push(this.videoStream.getVideoTracks()[0]),this.audioStream&&e.push(this.audioStream.getAudioTracks()[0]),new MediaStream(e)}detectMob(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))}removeAllStreams(){this.aStream&&this.aStream.getTracks().forEach((function(e){e.stop()})),this.videoStream&&this.videoStream.getTracks().forEach((function(e){e.stop()})),this.audioStream&&this.audioStream.getTracks().forEach((function(e){e.stop()})),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.screenSharingMobile&&this.screenSharingMobile.onceAutoScrollDone&&clearInterval(this.screenSharingMobile.onceAutoScrollDone),this.emptyStreamInterval&&clearInterval(this.emptyStreamInterval)}silence(){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,this.audioContext=new AudioContext;const e=new AudioContext,t=e.createOscillator(),n=t.connect(e.createMediaStreamDestination());return t.start(),Object.assign(n.stream.getAudioTracks()[0],{enabled:!1})}black({width:e=640,height:t=480}={}){const n=Object.assign(document.createElement("canvas"),{width:e,height:t}),r=n.getContext("2d");let i=1;this.emptyStreamInterval=setInterval(()=>{r.fillRect(0,0,e,t),i?(r.fillStyle="rgba(0,0,0,0.93)",i=0):(r.fillStyle="#000",i=1),r.rect(0,0,e,t),r.fill()},1e3);const s=n.captureStream(30);return s.getVideoTracks()[0].enabled=!1,s.getVideoTracks()[0]}blackSilence(...e){return new MediaStream([this.black(...e),this.silence()])}getNatType(e){return new Promise((t,n)=>{const r=[],i=new RTCPeerConnection({iceServers:[{urls:"stun:"+e}]}),s=i.createDataChannel("foo");s.onopen=e=>{const t={message:"hello world!",timestamp:new Date};s.send(JSON.stringify(t))},s.onerror=e=>{n(e)},s.onclose=e=>{},i.onicecandidate=e=>{if(console.log("cand",e.candidate),e.candidate&&e.candidate.candidate.includes("srflx")){const t=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1]}return n}(e.candidate.candidate);r[t.relatedPort]||(r[t.relatedPort]=[]),r[t.relatedPort].push(t),this.publicIps.push(t.ip+":"+t.port)}else if(!e.candidate||"complete"===i.iceGatheringState)if(1===Object.keys(r).length){const e=r[Object.keys(r)[0]],n=1===e.length?"normal":"symmetric";t({natType:n,publicIps:this.publicIps}),console.log("candidates",r,e,this.publicIps,n),i.close()}else t({natType:"Undefined",publicIps:this.publicIps})},i.createOffer().then(e=>i.setLocalDescription(e))})}}},function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"name",(function(){return o})),n.d(t,"version",(function(){return s}));var r=n(1),i=n(2);n.d(t,"Client",(function(){return i.default}));const s=r.LIBRARY_VERSION,o="vdotok-messaging"},function(e,t,n){"use strict";n.r(t),n.d(t,"LIBRARY_VERSION",(function(){return r}));const r="0.18.0"},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"default",(function(){return h}));var r=n(4),i=n(5),s=n(11),o=n(13),a=n(15),c=n(14);e.Buffer=e.Buffer||n(17).Buffer;const l=n(21).connect,u={0:"image",1:"audio",2:"video",3:"file"};class h extends r.EventEmitter{constructor(e){super(),this.Host="",this.Port="",this.Username="",this.Password="",this.Connection="",this.ChennalKey="",this.reConnectivity="",this.projectID="",this.projectSecretKey="",this.QueueFiles={},this.projectSecretKey=e.secret,this.projectID=e.projectID,e.host?this.Host=e.host:this.Authentication(),this.registerPingWorker()}static consoleLog(...e){console.log(...e)}Register(e,t){this.Username=e,this.Password=t;const n=""+this.Host;if(0==n.length)return this.emit("authentication_error",{message:"SDK is not authorized."});h.consoleLog("hostString===",n,this.Username," ===password=== ",this.Password);const r=l(n,{username:e,password:t});this.Connection=r,r.on("message",(e,t,n)=>{try{let e=JSON.parse(t.toString());e.hasOwnProperty("event")?this.SetPresenceEvent(e):e.hasOwnProperty("status")&&200==e.status?this.emit("create",e):this.SetMessagePacket(e)}catch(e){this.SetMessagePacket(n)}}),r.on("connect",()=>{this.emit("connect")}),r.on("packetsend",e=>{h.consoleLog("on packetsend",e,(new Date).toLocaleString())}),r.on("packetreceive",e=>{}),r.on("presence",e=>{}),r.on("disconnect",e=>{this.emit("disconnect",e)}),r.on("error",e=>{this.emit("error",e)})}CreateChannel(e){const t={key:"cWV91camkwd99XO9rvHmamvXxGdyeHK5",channel:e+"/",type:"rwslp",ttl:999999};this.Connection.publish("emitter/keygen/",JSON.stringify(t))}Subscribe(e){let t=`${e.key}/${e.channel}`;e&&e.last&&(t+="?last="+e.last),this.Connection.subscribe(t,[],(t,n)=>{n&&null!=n&&this.SendPresence(e)})}UnSubscribe(e){const t=`${e.key}/${e.channel}`;this.Connection.unsubscribe(t,[],t=>{null==t&&this.emit("unsubscribed",e)})}Presence(e){}SendMessage(e){let t=`${e.key}/${e.to}`;e&&e.ttl&&(t+="?ttl="+e.ttl),this.Connection.publish(t,JSON.stringify(e),{},()=>{this.Connection.on("message",(t,n,r)=>{if(t==e.to){const i=r.payload;"publish"==r.cmd&&null!=i&&i==JSON.stringify(e)&&this.emit("messagesent",{channel:t,message:n})}})})}SendReceipt(e){const t=`${e.key}/${e.to}`;this.Connection.publish(t,JSON.stringify(e),{},()=>{this.Connection.on("message",(t,n,r)=>{if(t==e.to){const i=r.payload;"publish"==r.cmd&&null!=i&&i==JSON.stringify(e)&&this.emit("messagesent",{channel:t,message:n})}})})}SendRawMessage(e,t){const n=`${t.key}/${t.to}`;this.Connection.publish(n,e,{},()=>{this.Connection.on("message",(e,n,r)=>{if(e==t.topic){const i=r.payload;"publish"==r.cmd&&null!=i&&i==JSON.stringify(t)&&this.emit("messagesent",{channel:e,message:n})}})})}SendFile(e,t){i.default.SendFile(e,t,this)}Disconnect(){this.pingWorker&&this.pingWorker.postMessage({method:"clearPingInterval"}),this.Connection.end()}async SetFileMessage(e,t){const n=c.default;n.type=e.Header.type,n.size=e.Header.size,n.to=e.Header.topic,n.key=e.Header.key,n.from=e.Header.from,n.isBuffering=!1,n.ext=e.Header.fileExtension,n.id=t.headerId,n.filename=this.Username+Math.random()+"."+e.Header.fileExtension.toLowerCase(),n.content=await Object(a.ArrayBase64ToStringBase64Async)(e.Content,e.Header.fileExtension),n.type=u[n.type],this.emit("message",n),this.Connection._sendPacket({cmd:"pingreq"}),delete this.QueueFiles[t.headerId]}SetFileLoadingMessage(e){let t=new o.default;t.content="",t.type=e.type,t.size=e.size,t.to=e.topic,t.key=e.key,t.from=e.from,t.isBuffering=!0,t.ext=e.fileExtension,t.id=e.headerId,t.ShowFileLoadingMessage(this)}Authentication(){s.default.Authorization(this.projectID,this.projectSecretKey).then(e=>{h.consoleLog("====Authorization Chat====",e),200==e.status?(this.Host=`${e.messaging_server_map.protocol}://${e.messaging_server_map.host}:${e.messaging_server_map.port}`,this.emit("authenticated",{})):this.emit("authentication_error",{message:"SDK Credentials are invalid.Reason:"+e.message})})}SendPresence(e){const t={key:e.key,channel:e.channel,changes:!0,status:!0};this.Connection.publish("emitter/presence/",JSON.stringify(t),{},()=>{this.Connection.on("message",(e,t,n)=>{})})}SetPresenceEvent(e){"status"==e.event&&this.emit("subscribed",e),"subscribe"==e.event&&this.emit("online",e),"unsubscribe"==e.event&&this.emit("offline",e)}SetMessagePacket(e){let t=!1;const n=i.default.MapHeaderPacket(e),r=i.default.MapFileMessagePacket(e);if(n&&(t=!0,this.QueueFiles[e.headerId]={Header:e,Content:[]},this.SetFileLoadingMessage(e)),r){t=!0;const n=this.QueueFiles[e.headerId];if(null!=n){const t=n.Content;n.Content=t.concat(e.content),this.QueueFiles[e.headerId]=Object.assign({},n),n.Header.totalPacket==e.packetNo&&this.SetFileMessage(n,e)}}r||n||this.emit("message",e)}registerPingWorker(){window.URL=window.URL||window.webkitURL;const e=new Blob(["let pingInterval;\n                            onmessage = (res) => {\n                                let data = res.data;\n                                console.log('Message received from main script');\n                                const method = data.method;\n                                if (method === 'format') {\n                                    postMessage({\n                                        data: {\n                                            'res': 'I am a customized result string.',\n                                        }\n                                    });\n                                }\n                                else if (method === 'startPingInterval')\n                                {\n                                    if(!data.interval)\n                                    {\n                                        data.interval =  5000;\n                                    }\n                                    startPingInterval(data.interval);\n                                }\n                                else if(method === 'clearPingInterval')\n                                {\n                                    clearPingInterval();\n                                }\n                                console.log('Posting message back to main script');\n                            }\n                            \n                            function startPingInterval(interval)\n                            {\n                                pingInterval = setInterval(()=>{\n                                    postMessage({\n                                            'sendPing': true\n                                    });\n                                },interval)\n                            }\n                            function  clearPingInterval()\n                            {\n                                if(pingInterval)\n                                {\n                                    clearInterval(pingInterval);\n                                }\n                            } \n                            "],{type:"application/javascript"});this.pingWorker=new Worker(URL.createObjectURL(e)),this.pingWorker&&(this.pingWorker.onmessage=e=>{e&&e.data&&e.data.sendPing&&this.Connection&&this.Connection._checkPing()},this.pingWorker.postMessage({method:"startPingInterval",interval:3e3}))}}}.call(this,n(3))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,s=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,r){var i,s,o,a;if(l(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var l=c.length,u=g(c,l);for(n=0;n<l;++n)s(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,s,o;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.r(t);var r=n(6),i=n(7),s=n(9);const o={image:0,audio:1,video:2,file:3},a=new class{constructor(){}SendFile(e,t,n){let i=Object(r.GetFileObject)(e);Object(r.GetBinaryArrayOfFile)(i.file,i.fileType).then(e=>{let s=e.length,o=Object.assign(Object.assign(Object.assign({},t),i),{size:s}),a=[];if(s>12e3){a=Object(r.MakeChunkArray)(e,12e3),o.totalPacket=a.length;let i=this.SendHeaderFirst(o,n);a.forEach((e,r)=>{let s=r+1;this.SendChunkPacket(e,i,s,t,n)})}else{let t=Object.assign(Object.assign({},o),{totalPacket:1}),r=this.SendHeaderFirst(t,n);this.SendChunkPacket(e,r,1,t,n)}})}SendHeaderFirst(e,t){let n=new i.default,r=e.id;return n.from=e.from,n.fileExtension=e.ext,n.headerId=r,n.topic=e.topic,n.size=e.size,n.key=e.key,n.type=o[e.type],n.totalPacket=e.totalPacket,n.Send(t.Connection),r}SendChunkPacket(e,t,n,i,a){console.log("Binarray",e),e=Array.from(e),e=btoa(e.map(e=>String.fromCharCode(e)).join("")),console.log("Binarray Normal== ",e);let c=new s.default;c.messageId=Object(r.GetUUID)(),c.content=e,c.packetNo=n,c.from=i.from,c.headerId=t,c.topic=i.topic,c.key=i.key,c.type=o[i.type],c.Send(a.Connection),a.Connection._sendPacket({cmd:"pingreq"})}MapHeaderPacket(e){return(new i.default).MapHeader(e)}MapFileMessagePacket(e){return(new s.default).MapMessage(e)}SetMessagePacket(e,t){}};t.default=a},function(e,t,n){"use strict";function r(){return(new Date).getTime().toString()}function i(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=e=>{let n=r.result,i=new Uint8Array(n);t(i)},r.onerror=e=>n(e),r.readAsArrayBuffer(e)})}function s(e){return e=e.substr(e.indexOf(",")+1),new Promise((t,n)=>{fetch("data:application/octet-binary;base64,"+e).then(e=>e.arrayBuffer()).then(e=>{t(new Uint8Array(e))})})}function o(e){return m(e)}async function a(e,t){let n;switch(t){case"File":n=await i(e);break;case"Base64":n=await s(e),g(n);break;default:n=[]}return n}function c(e){return"string"==typeof e&&e.indexOf(";base64")>-1}function l(e){let t={fileType:"",file:"",ext:""};return c(e)?(t.fileType="Base64",t.file=e,t.ext=e.substring(e.indexOf("/")+1,e.indexOf(";base64"))):"object"==typeof e&&(null!=e[0]&&(t.fileType="File",t.file=e[0],t.ext=e[0].name.split(".").pop()),null!=e.name&&(t.fileType="File",t.file=e,t.ext=e.name.split(".").pop())),t}function u(e,t){const n=[];for(let r=0,i=e.length;r<i;r+=t)n.push(e.slice(r,r+t));return n}function h(e){let t=JSON.stringify(e,null,0),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function d(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(parseInt(e[n]));return JSON.parse(t)}function p(e){return m(JSON.stringify(e))}function f(e){return(new TextEncoder).encode(e)}function m(e){for(var t=e.length,n=-1,r="undefined"==typeof Uint8Array?new Array(1.5*t):new Uint8Array(3*t),i=0,s=0,o=0;o!==t;){if(i=e.charCodeAt(o),o+=1,i>=55296&&i<=56319){if(o===t){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;break}if(!((s=e.charCodeAt(o))>=56320&&s<=57343)){r[n+=1]=239,r[n+=1]=191,r[n+=1]=189;continue}if(o+=1,(i=1024*(i-55296)+s-56320+65536)>65535){r[n+=1]=240|i>>>18,r[n+=1]=128|i>>>12&63,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i;continue}}i<=127?r[n+=1]=0|i:i<=2047?(r[n+=1]=192|i>>>6,r[n+=1]=128|63&i):(r[n+=1]=224|i>>>12,r[n+=1]=128|i>>>6&63,r[n+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?r.subarray(0,n+1):(r.length=n+1,r)}function g(e){var t=new Blob([e],{type:"application/octet-binary"});return new Promise((e,n)=>{let r=new FileReader;r.onload=function(){let t=r.result,n=t.substr(t.indexOf(",")+1);e(n)},r.readAsDataURL(t)})}function y(e){}n.r(t),n.d(t,"GetUUID",(function(){return r})),n.d(t,"ReadFileToUnInt8Array",(function(){return i})),n.d(t,"Base64ToUnInt8Array",(function(){return s})),n.d(t,"NewBase64ToUInt8Array",(function(){return o})),n.d(t,"GetBinaryArrayOfFile",(function(){return a})),n.d(t,"IsBase64",(function(){return c})),n.d(t,"GetFileObject",(function(){return l})),n.d(t,"MakeChunkArray",(function(){return u})),n.d(t,"JsonToUint8Array",(function(){return h})),n.d(t,"Uin8ArrayToJson",(function(){return d})),n.d(t,"ConvertJsonUTF8",(function(){return p})),n.d(t,"ConvertStrUTF8",(function(){return f})),n.d(t,"TextEncoderUTF8",(function(){return m})),n.d(t,"BufferToBase64Async",(function(){return g})),n.d(t,"ByteToBase64",(function(){return y}))},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n(8);class i{constructor(){this.message=r.default}set from(e){this.message.from=e}get from(){return this.message.from}set fileExtension(e){this.message.fileExtension=e}get fileExtension(){return this.message.fileExtension}set headerId(e){this.message.headerId=e}get headerId(){return this.message.headerId}set topic(e){this.message.topic=e}get topic(){return this.message.topic}set size(e){this.message.size=e}get size(){return this.message.size}set key(e){this.message.key=e}get key(){return this.message.key}set totalPacket(e){this.message.totalPacket=e}get totalPacket(){return this.message.totalPacket}set type(e){this.message.type=e}get type(){return this.message.type}set date(e){this.message.date=e}get date(){return this.message.date}Send(e){let t=`${this.message.key}/${this.message.topic}`;e.publish(t,JSON.stringify(this.message),{},()=>{})}MapHeader(e){let t=Object.keys(this.message),n=Object.keys(e);return t.filter(e=>n.indexOf(e)>-1).length==t.length}}},function(e,t,n){"use strict";n.r(t),t.default={from:"",fileExtension:"",headerId:"",size:"",topic:"",key:"",totalPacket:0,type:0,date:(new Date).getTime()}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n(10);class i{constructor(){this.message=r.default}set messageId(e){this.message.messageId=e}get messageId(){return this.message.messageId}set content(e){this.message.content=e}get content(){return this.message.content}set packetNo(e){this.message.packetNo=e}get packetNo(){return this.message.packetNo}set from(e){this.message.from=e}get from(){return this.message.from}set headerId(e){this.message.headerId=e}get headerId(){return this.message.headerId}set topic(e){this.message.topic=e}get topic(){return this.message.topic}set key(e){this.message.key=e}get key(){return this.message.key}set type(e){this.message.type=e}get type(){return this.message.type}Send(e){let t=`${this.message.key}/${this.message.topic}`,n=JSON.stringify(this.message);e.publish(t,n,{},()=>{})}MapMessage(e){let t=Object.keys(this.message),n=Object.keys(e);return t.filter(e=>n.indexOf(e)>-1).length==t.length}}},function(e,t,n){"use strict";n.r(t),t.default={messageId:"",content:[],packetNo:0,from:"",headerId:"",topic:"",key:"",type:""}},function(e,t,n){"use strict";n.r(t);var r=n(12);const i=new class{constructor(){}async Authorization(e,t){let n={project_id:e,auth_token:t};return fetch(r.SERVER+"/AuthenticateSDK",{method:"POST",body:JSON.stringify(n),mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(e=>e.json()).then(e=>e).catch(e=>(console.log(e),e))}};t.default=i},function(e,t,n){"use strict";n.r(t),n.d(t,"SERVER",(function(){return r}));const r="https://vtkapi.vdotok.dev/API/v0"},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));var r=n(14),i=n(15);const s={0:"image",1:"audio",2:"video",3:"file"};class o{constructor(){this.message=r.default}set from(e){this.message.from=e}get from(){return this.message.from}set content(e){this.message.content=e}get content(){return this.message.content}set id(e){this.message.id=e}get id(){return this.message.id}set size(e){this.message.size=e}get size(){return this.message.size}set key(e){this.message.key=e}get key(){return this.message.key}set type(e){this.message.type=e}get type(){return this.message.type}set to(e){this.message.to=e}get to(){return this.message.to}set isGroupMessage(e){this.message.isGroupMsg=e}get isGroupMessage(){return this.message.isGroupMessage}set isBuffering(e){this.message.isBuffering=e}get isBuffering(){return this.message.isBuffering}set ext(e){this.message.ext=e}get ext(){return this.message.ext}set filename(e){this.message.filename=e}get filename(){return this.message.filename}set date(e){this.message.date=e}get date(){return this.message.date}set status(e){this.message.status=e}get status(){return this.message.status}set subtype(e){this.message.subtype=e}get subtype(){return this.message.subtype}ShowFileMessage(e){Object(i.BufferToBase64Async)(this.message.content,this.message.ext).then(t=>{this.message.content=t,this.message.type=s[this.message.type],e.emit("message",this.message)})}ShowFileLoadingMessage(e){this.message.type=s[this.message.type],e.emit("message",this.message)}MapMessage(e){const t=Object.keys(this.message),n=Object.keys(e);return t.filter(e=>n.includes(e)).length==t.length}}},function(e,t,n){"use strict";n.r(t),t.default={from:"",content:"",id:"",size:0,key:"",type:"",to:"",isGroupMessage:!1,date:(new Date).getTime(),status:1,subtype:0,isBuffering:!0}},function(e,t,n){"use strict";n.r(t),n.d(t,"BufferToBase64Async",(function(){return i})),n.d(t,"ArrayBase64ToStringBase64Async",(function(){return s}));var r=n(16);function i(e,t){const n=new Uint8Array(e);let i=new Blob([n],{type:"application/octet-binary"});return new Promise((e,n)=>{let s=new FileReader;s.onload=function(){let n=s.result,i=n.substr(n.indexOf(",")+1),o=r.default[t];e(`data:${o};base64,${i}`)},s.readAsDataURL(i)})}function s(e,t){return new Promise((n,i)=>{console.log("completeFile buffer: ",e);let s=e.join("");t=t.toLowerCase(),n(`data:${r.default[t]};base64,${s}`)})}},function(e,t,n){"use strict";n.r(t),t.default={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm",class:"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",csv:"text/csv",dcr:"application/x-director",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dtd:"application/xml-dtd",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",json:"application/json",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",log:"application/octet-stream",m3u:"audio/x-mpegurl",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mp4:"video/mp4",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"audio/ogg",oga:"audio/ogg",pbm:"image/x-portable-bitmap",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",qt:"video/quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rss:"application/rss+xml",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",aac:"audio/aac",wbmp:"image/vnd.wap.wbmp",wbxml:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}},function(e,t,n){"use strict";(function(e){var r=n(18),i=n(19),s=n(20);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return l(this,e,t,n)}function l(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,n),i=(e=a(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):d(e,t);if("Buffer"===t.type&&s(t.data))return d(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return P(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var s,o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(s=n;s<a;s++)if(l(e,s)===l(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var h=!0,d=0;d<c;d++)if(l(e,s+d)!==l(t,d)){h=!1;break}if(h)return s}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[n+o]=a}return o}function w(e,t,n,r){return V(B(t,e.length-n),e,n,r)}function _(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return _(e,t,n,r)}function I(e,t,n,r){return V(q(t),e,n,r)}function k(e,t,n,r){return V(function(e,t){for(var n,r,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,o,a,c,l=e[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=n)switch(h){case 1:l<128&&(u=l);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&l)<<6|63&s)>127&&(u=c);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(c=(15&l)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r,i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var s="",o=t;o<n;++o)s+=(r=e[o])<16?"0"+r.toString(16):r.toString(16);return s}function O(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function U(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function R(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function j(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,r,s){return s||j(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,s){return s||j(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return u(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),a=Math.min(s,o),l=this.slice(r,i),u=e.slice(t,n),h=0;h<a;++h)if(l[h]!==u[h]){s=l[h],o=u[h];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return I(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||U(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||U(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||U(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||U(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||U(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||U(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||U(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||U(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||U(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||U(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||U(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||U(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||U(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||U(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||U(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var o=c.isBuffer(e)?e:B(new c(e,r).toString()),a=o.length;for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function q(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(3))},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=l(e),o=r[0],a=r[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),u=0,h=a>0?o-4:o;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(u(e,o,o+16383>a?a:o+16383));return 1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var i,s,o=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=l}return(p?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&a,p+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+p]=255&o,p+=f,o/=256,l-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){e.exports=function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return i(t[o][1][e]||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var s=!1,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,n,r){(function(t,r){"use strict";var i=e("events").EventEmitter,s=e("./store"),o=e("mqtt-packet"),a=e("readable-stream").Writable,c=e("inherits"),l=e("reinterval"),u=e("./validations"),h=e("xtend"),d=e("debug")("mqttjs:client"),p=t?t.nextTick:function(e){setTimeout(e,0)},f=r.setImmediate||function(e){p(e)},m={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},g=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],y={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function v(e,t,n){d("sendPacket :: packet: %O",t),d("sendPacket :: emitting `packetsend`"),e.emit("packetsend",t),d("sendPacket :: writing to stream");var r=o.writeToStream(t,e.stream,e.options);d("sendPacket :: writeToStream result %s",r),!r&&n?(d("sendPacket :: handle events on `drain` once through callback."),e.stream.once("drain",n)):n&&(d("sendPacket :: invoking cb"),n())}function b(e){e&&(d("flush: queue exists? %b",!!e),Object.keys(e).forEach((function(t){"function"==typeof e[t].cb&&(e[t].cb(new Error("Connection closed")),delete e[t])})))}function w(e,t,n,r){d("storeAndSend :: store packet with cmd %s to outgoingStore",t.cmd),e.outgoingStore.put(t,(function(i){if(i)return n&&n(i);r(),v(e,t,n)}))}function _(e){d("nop ::",e)}function S(e,t){var n,r=this;if(!(this instanceof S))return new S(e,t);for(n in this.options=t||{},m)void 0===this.options[n]?this.options[n]=m[n]:this.options[n]=t[n];d("MqttClient :: options.protocol",t.protocol),d("MqttClient :: options.protocolVersion",t.protocolVersion),d("MqttClient :: options.username",t.username),d("MqttClient :: options.keepalive",t.keepalive),d("MqttClient :: options.reconnectPeriod",t.reconnectPeriod),d("MqttClient :: options.rejectUnauthorized",t.rejectUnauthorized),this.options.clientId="string"==typeof t.clientId?t.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),d("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=5===t.protocolVersion&&t.customHandleAcks?t.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=e,this.outgoingStore=t.outgoingStore||new s,this.incomingStore=t.incomingStore||new s,this.queueQoSZero=void 0===t.queueQoSZero||t.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("connect",(function(){var e=this.queue;d("connect :: sending queued packets"),function t(){var n,i=e.shift();d("deliver :: entry %o",i),i&&(n=i.packet,d("deliver :: call _sendPacket for %o",n),r._sendPacket(n,(function(e){i.cb&&i.cb(e),t()})))}()})),this.on("close",(function(){d("close :: connected set to `false`"),this.connected=!1,d("close :: clearing connackTimer"),clearTimeout(this.connackTimer),d("close :: clearing ping timer"),null!==r.pingTimer&&(r.pingTimer.clear(),r.pingTimer=null),d("close :: calling _setupReconnect"),this._setupReconnect()})),i.call(this),d("MqttClient :: setting up stream"),this._setupStream()}c(S,i),S.prototype._setupStream=function(){var e,t=this,n=new a,r=o.parser(this.options),i=null,s=[];function c(){if(s.length)p(l);else{var e=i;i=null,e()}}function l(){d("work :: getting next packet in queue");var e=s.shift();if(e)d("work :: packet pulled from queue"),t._handlePacket(e,c);else{d("work :: no packets in queue");var n=i;i=null,d("work :: done flag is %s",!!n),n&&n()}}if(d("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),d("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),r.on("packet",(function(e){d("parser :: on packet push to packets array."),s.push(e)})),n._write=function(e,t,n){i=n,d("writable stream :: parsing buffer"),r.parse(e),l()},d("_setupStream :: pipe stream to writable stream"),this.stream.pipe(n),this.stream.on("error",(function(e){d("streamErrorHandler :: error",e.message),g.includes(e.code)?(d("streamErrorHandler :: emitting error"),t.emit("error",e)):_(e)})),this.stream.on("close",(function(){var e;d("(%s)stream :: on close",t.options.clientId),(e=t.outgoing)&&(d("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(e).forEach((function(t){e[t].volatile&&"function"==typeof e[t].cb&&(e[t].cb(new Error("Connection closed")),delete e[t])}))),d("stream: emit close to MqttClient"),t.emit("close")})),d("_setupStream: sending packet `connect`"),(e=Object.create(this.options)).cmd="connect",v(this,e),r.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return t.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket&&v(this,h({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout((function(){d("!!connectTimeout hit!! Calling _cleanUp with force `true`"),t._cleanUp(!0)}),this.options.connectTimeout)},S.prototype._handlePacket=function(e,t){var n=this.options;if(5===n.protocolVersion&&n.properties&&n.properties.maximumPacketSize&&n.properties.maximumPacketSize<e.length)return this.emit("error",new Error("exceeding packets size "+e.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(d("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",e),e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t();break;case"disconnect":this._handleDisconnect(e),t()}},S.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},S.prototype.publish=function(e,t,n,r){var i;d("publish :: message `%s` to topic `%s`",t,e);var s=this.options;if("function"==typeof n&&(r=n,n=null),n=h({qos:0,retain:!1,dup:!1},n),this._checkDisconnecting(r))return this;switch(i={cmd:"publish",topic:e,payload:t,qos:n.qos,retain:n.retain,messageId:this._nextId(),dup:n.dup},5===s.protocolVersion&&(i.properties=n.properties,(!s.properties&&i.properties&&i.properties.topicAlias||n.properties&&s.properties&&(n.properties.topicAlias&&s.properties.topicAliasMaximum&&n.properties.topicAlias>s.properties.topicAliasMaximum||!s.properties.topicAliasMaximum&&n.properties.topicAlias))&&delete i.properties.topicAlias),d("publish :: qos",n.qos),n.qos){case 1:case 2:this.outgoing[i.messageId]={volatile:!1,cb:r||_},this._storeProcessing?(d("_storeProcessing enabled"),this._packetIdsDuringStoreProcessing[i.messageId]=!1,this._storePacket(i,void 0,n.cbStorePut)):(d("MqttClient:publish: packet cmd: %s",i.cmd),this._sendPacket(i,void 0,n.cbStorePut));break;default:this._storeProcessing?(d("_storeProcessing enabled"),this._storePacket(i,r,n.cbStorePut)):(d("MqttClient:publish: packet cmd: %s",i.cmd),this._sendPacket(i,r,n.cbStorePut))}return this},S.prototype.subscribe=function(){for(var e,t=new Array(arguments.length),n=0;n<arguments.length;n++)t[n]=arguments[n];var r,i=[],s=t.shift(),o=s.resubscribe,a=t.pop()||_,c=t.pop(),l=this,p=this.options.protocolVersion;if(delete s.resubscribe,"string"==typeof s&&(s=[s]),"function"!=typeof a&&(c=a,a=_),null!==(r=u.validateTopics(s)))return f(a,new Error("Invalid topic "+r)),this;if(this._checkDisconnecting(a))return d("subscribe: discconecting true"),this;var m={qos:0};if(5===p&&(m.nl=!1,m.rap=!1,m.rh=0),c=h(m,c),Array.isArray(s)?s.forEach((function(e){if(d("subscribe: array topic %s",e),!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<c.qos||o){var t={topic:e,qos:c.qos};5===p&&(t.nl=c.nl,t.rap=c.rap,t.rh=c.rh,t.properties=c.properties),d("subscribe: pushing topic `%s` and qos `%s` to subs list",t.topic,t.qos),i.push(t)}})):Object.keys(s).forEach((function(e){if(d("subscribe: object topic %s",e),!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<s[e].qos||o){var t={topic:e,qos:s[e].qos};5===p&&(t.nl=s[e].nl,t.rap=s[e].rap,t.rh=s[e].rh,t.properties=c.properties),d("subscribe: pushing `%s` to subs list",t),i.push(t)}})),e={cmd:"subscribe",subscriptions:i,qos:1,retain:!1,dup:!1,messageId:this._nextId()},c.properties&&(e.properties=c.properties),i.length){if(this.options.resubscribe){d("subscribe :: resubscribe true");var g=[];i.forEach((function(e){if(l.options.reconnectPeriod>0){var t={qos:e.qos};5===p&&(t.nl=e.nl||!1,t.rap=e.rap||!1,t.rh=e.rh||0,t.properties=e.properties),l._resubscribeTopics[e.topic]=t,g.push(e.topic)}})),l.messageIdToTopic[e.messageId]=g}return this.outgoing[e.messageId]={volatile:!0,cb:function(e,t){if(!e)for(var n=t.granted,r=0;r<n.length;r+=1)i[r].qos=n[r];a(e,i)}},d("subscribe :: call _sendPacket"),this._sendPacket(e),this}a(null,[])},S.prototype.unsubscribe=function(){for(var e={cmd:"unsubscribe",qos:1,messageId:this._nextId()},t=this,n=new Array(arguments.length),r=0;r<arguments.length;r++)n[r]=arguments[r];var i=n.shift(),s=n.pop()||_,o=n.pop();return"string"==typeof i&&(i=[i]),"function"!=typeof s&&(o=s,s=_),this._checkDisconnecting(s)||("string"==typeof i?e.unsubscriptions=[i]:Array.isArray(i)&&(e.unsubscriptions=i),this.options.resubscribe&&e.unsubscriptions.forEach((function(e){delete t._resubscribeTopics[e]})),"object"==typeof o&&o.properties&&(e.properties=o.properties),this.outgoing[e.messageId]={volatile:!0,cb:s},d("unsubscribe: call _sendPacket"),this._sendPacket(e)),this},S.prototype.end=function(e,t,n){var r=this;function i(){d("end :: closeStores: closing incoming and outgoing stores"),r.disconnected=!0,r.incomingStore.close((function(e){r.outgoingStore.close((function(t){if(d("end :: closeStores: emitting end"),r.emit("end"),n){let r=e||t;d("end :: closeStores: invoking callback with args"),n(r)}}))})),r._deferredReconnect&&r._deferredReconnect()}function s(){d("end :: (%s) :: finish :: calling _cleanUp with force %s",r.options.clientId,e),r._cleanUp(e,()=>{d("end :: finish :: calling process.nextTick on closeStores"),p(i.bind(r))},t)}return d("end :: (%s)",this.options.clientId),null!=e&&"boolean"==typeof e||(n=t||_,t=e,e=!1,"object"!=typeof t&&(n=t,t=null,"function"!=typeof n&&(n=_))),"object"!=typeof t&&(n=t,t=null),d("end :: cb? %s",!!n),n=n||_,this.disconnecting?(n(),this):(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?(d("end :: (%s) :: calling finish in 10ms once outgoing is empty",r.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,s,10))):(d("end :: (%s) :: immediately calling finish",r.options.clientId),s()),this)},S.prototype.removeOutgoingMessage=function(e){var t=this.outgoing[e]?this.outgoing[e].cb:null;return delete this.outgoing[e],this.outgoingStore.del({messageId:e},(function(){t(new Error("Message removed"))})),this},S.prototype.reconnect=function(e){d("client reconnect");var t=this,n=function(){e?(t.options.incomingStore=e.incomingStore,t.options.outgoingStore=e.outgoingStore):(t.options.incomingStore=null,t.options.outgoingStore=null),t.incomingStore=t.options.incomingStore||new s,t.outgoingStore=t.options.outgoingStore||new s,t.disconnecting=!1,t.disconnected=!1,t._deferredReconnect=null,t._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=n:n(),this},S.prototype._reconnect=function(){d("_reconnect: emitting reconnect to client"),this.emit("reconnect"),d("_reconnect: calling _setupStream"),this._setupStream()},S.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&e.options.reconnectPeriod>0?(this.reconnecting||(d("_setupReconnect :: emit `offline` state"),this.emit("offline"),d("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),d("_setupReconnect :: setting reconnectTimer for %d ms",e.options.reconnectPeriod),e.reconnectTimer=setInterval((function(){d("reconnectTimer :: reconnect triggered!"),e._reconnect()}),e.options.reconnectPeriod)):d("_setupReconnect :: doing nothing...")},S.prototype._clearReconnect=function(){d("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},S.prototype._cleanUp=function(e,t){var n=arguments[2];if(t&&(d("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",t)),d("_cleanUp :: forced? %s",e),e)0===this.options.reconnectPeriod&&this.options.clean&&b(this.outgoing),d("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{var r=h({cmd:"disconnect"},n);d("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(r,f.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(d("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(d("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),t&&!this.connected&&(d("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",t),t())},S.prototype._sendPacket=function(e,t,n){if(d("_sendPacket :: (%s) ::  start",this.options.clientId),n=n||_,!this.connected)return d("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(e,t,n);switch(this._shiftPingInterval(),e.cmd){case"publish":break;case"pubrel":return void w(this,e,t,n);default:return void v(this,e,t)}switch(e.qos){case 2:case 1:w(this,e,t,n);break;case 0:default:v(this,e,t)}d("_sendPacket :: (%s) ::  end",this.options.clientId)},S.prototype._storePacket=function(e,t,n){d("_storePacket :: packet: %o",e),d("_storePacket :: cb? %s",!!t),n=n||_,0===(e.qos||0)&&this.queueQoSZero||"publish"!==e.cmd?this.queue.push({packet:e,cb:t}):e.qos>0?(t=this.outgoing[e.messageId]?this.outgoing[e.messageId].cb:null,this.outgoingStore.put(e,(function(e){if(e)return t&&t(e);n()}))):t&&t(new Error("No connection to broker"))},S.prototype._setupPingTimer=function(){d("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=l((function(){e._checkPing()}),1e3*this.options.keepalive))},S.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},S.prototype._checkPing=function(){d("_checkPing :: checking ping..."),this.pingResp?(d("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(d("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},S.prototype._handlePingresp=function(){this.pingResp=!0},S.prototype._handleConnack=function(e){d("_handleConnack");var t=this.options,n=5===t.protocolVersion?e.reasonCode:e.returnCode;if(clearTimeout(this.connackTimer),e.properties&&(e.properties.topicAliasMaximum&&(t.properties||(t.properties={}),t.properties.topicAliasMaximum=e.properties.topicAliasMaximum),e.properties.serverKeepAlive&&t.keepalive&&(t.keepalive=e.properties.serverKeepAlive,this._shiftPingInterval()),e.properties.maximumPacketSize&&(t.properties||(t.properties={}),t.properties.maximumPacketSize=e.properties.maximumPacketSize)),0===n)this.reconnecting=!1,this._onConnect(e);else if(n>0){var r=new Error("Connection refused: "+y[n]);r.code=n,this.emit("error",r)}},S.prototype._handlePublish=function(e,t){d("_handlePublish: packet %o",e),t=void 0!==t?t:_;var n=e.topic.toString(),r=e.payload,i=e.qos,s=e.messageId,o=this,a=this.options,c=[0,16,128,131,135,144,145,151,153];switch(d("_handlePublish: qos %d",i),i){case 2:a.customHandleAcks(n,r,e,(function(n,r){return n instanceof Error||(r=n,n=null),n?o.emit("error",n):-1===c.indexOf(r)?o.emit("error",new Error("Wrong reason code for pubrec")):void(r?o._sendPacket({cmd:"pubrec",messageId:s,reasonCode:r},t):o.incomingStore.put(e,(function(){o._sendPacket({cmd:"pubrec",messageId:s},t)})))}));break;case 1:a.customHandleAcks(n,r,e,(function(i,a){return i instanceof Error||(a=i,i=null),i?o.emit("error",i):-1===c.indexOf(a)?o.emit("error",new Error("Wrong reason code for puback")):(a||o.emit("message",n,r,e),void o.handleMessage(e,(function(e){if(e)return t&&t(e);o._sendPacket({cmd:"puback",messageId:s,reasonCode:a},t)})))}));break;case 0:this.emit("message",n,r,e),this.handleMessage(e,t);break;default:d("_handlePublish: unknown QoS. Doing nothing.")}},S.prototype.handleMessage=function(e,t){t()},S.prototype._handleAck=function(e){var t,n=e.messageId,r=e.cmd,i=null,s=this.outgoing[n]?this.outgoing[n].cb:null,o=this;if(s){switch(d("_handleAck :: packet type",r),r){case"pubcomp":case"puback":var a=e.reasonCode;a&&a>0&&16!==a&&((t=new Error("Publish error: "+y[a])).code=a,s(t,e)),delete this.outgoing[n],this.outgoingStore.del(e,s);break;case"pubrec":i={cmd:"pubrel",qos:2,messageId:n};var c=e.reasonCode;c&&c>0&&16!==c?((t=new Error("Publish error: "+y[c])).code=c,s(t,e)):this._sendPacket(i);break;case"suback":delete this.outgoing[n];for(var l=0;l<e.granted.length;l++)if(0!=(128&e.granted[l])){var u=this.messageIdToTopic[n];u&&u.forEach((function(e){delete o._resubscribeTopics[e]}))}s(null,e);break;case"unsuback":delete this.outgoing[n],s(null);break;default:o.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}else d("_handleAck :: Server sent an ack in error. Ignoring.")},S.prototype._handlePubrel=function(e,t){d("handling pubrel packet"),t=void 0!==t?t:_;var n=e.messageId,r=this,i={cmd:"pubcomp",messageId:n};r.incomingStore.get(e,(function(e,n){e?r._sendPacket(i,t):(r.emit("message",n.topic,n.payload,n),r.handleMessage(n,(function(e){if(e)return t(e);r.incomingStore.del(n,_),r._sendPacket(i,t)})))}))},S.prototype._handleDisconnect=function(e){this.emit("disconnect",e)},S.prototype._nextId=function(){var e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e},S.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},S.prototype._resubscribe=function(e){d("_resubscribe");var t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!e.sessionPresent)&&t.length>0)if(this.options.resubscribe)if(5===this.options.protocolVersion){d("_resubscribe: protocolVersion 5");for(var n=0;n<t.length;n++){var r={};r[t[n]]=this._resubscribeTopics[t[n]],r.resubscribe=!0,this.subscribe(r,{properties:r[t[n]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},S.prototype._onConnect=function(e){if(this.disconnected)this.emit("connect",e);else{var t=this;this._setupPingTimer(),this._resubscribe(e),this.connected=!0,function n(){var r=t.outgoingStore.createStream();function i(){t._storeProcessing=!1,t._packetIdsDuringStoreProcessing={}}function s(){r.destroy(),r=null,i()}t.once("close",s),r.on("error",(function(e){i(),t.removeListener("close",s),t.emit("error",e)})),r.on("end",(function(){var r=!0;for(var o in t._packetIdsDuringStoreProcessing)if(!t._packetIdsDuringStoreProcessing[o]){r=!1;break}r?(i(),t.removeListener("close",s),t.emit("connect",e)):n()})),function e(){if(r){t._storeProcessing=!0;var n,i=r.read(1);i?t._packetIdsDuringStoreProcessing[i.messageId]?e():t.disconnecting||t.reconnectTimer?r.destroy&&r.destroy():(n=t.outgoing[i.messageId]?t.outgoing[i.messageId].cb:null,t.outgoing[i.messageId]={volatile:!1,cb:function(t,r){n&&n(t,r),e()}},t._packetIdsDuringStoreProcessing[i.messageId]=!0,t._sendPacket(i)):r.once("readable",e)}}()}()}},n.exports=S}).call(this,e("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:101,debug:17,events:83,inherits:88,"mqtt-packet":93,"readable-stream":115,reinterval:116,xtend:140}],2:[function(e,t,n){(function(n){"use strict";var r,i,s,o=e("readable-stream").Transform,a=e("duplexify"),c=e("base64-js"),l=!1;t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var u="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";!function(e){e.hostname||(e.hostname="localhost"),e.path||(e.path="/"),e.wsOptions||(e.wsOptions={})}(t);var h=function(e,t){var n="alis"===e.protocol?"wss":"ws",r=n+"://"+e.hostname+e.path;return e.port&&80!==e.port&&443!==e.port&&(r=n+"://"+e.hostname+":"+e.port+e.path),"function"==typeof e.transformWsUrl&&(r=e.transformWsUrl(r,e,t)),r}(t,e);return(r=t.my).connectSocket({url:h,protocols:u}),i=function(){var e=new o;return e._write=function(e,t,n){r.sendSocketMessage({data:e.buffer,success:function(){n()},fail:function(){n(new Error)}})},e._flush=function(e){r.closeSocket({success:function(){e()}})},e}(),s=a.obj(),l||(l=!0,r.onSocketOpen((function(){s.setReadable(i),s.setWritable(i),s.emit("connect")})),r.onSocketMessage((function(e){if("string"==typeof e.data){var t=c.toByteArray(e.data),r=n.from(t);i.push(r)}else{var s=new FileReader;s.addEventListener("load",(function(){var e=s.result;e=e instanceof ArrayBuffer?n.from(e):n.from(e,"utf8"),i.push(e)})),s.readAsArrayBuffer(e.data)}})),r.onSocketClose((function(){s.end(),s.destroy()})),r.onSocketError((function(e){s.destroy(e)}))),s}}).call(this,e("buffer").Buffer)},{"base64-js":10,buffer:13,duplexify:19,"readable-stream":115}],3:[function(e,t,n){"use strict";var r=e("net"),i=e("debug")("mqttjs:tcp");t.exports=function(e,t){var n,s;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",n=t.port,s=t.hostname,i("port %d and host %s",n,s),r.createConnection(n,s)}},{debug:17,net:12}],4:[function(e,t,n){"use strict";var r=e("tls"),i=e("debug")("mqttjs:tls");t.exports=function(e,t){var n;function s(r){t.rejectUnauthorized&&e.emit("error",r),n.end()}return t.port=t.port||8883,t.host=t.hostname||t.host||"localhost",t.servername=t.host,t.rejectUnauthorized=!1!==t.rejectUnauthorized,delete t.path,i("port %d host %s rejectUnauthorized %b",t.port,t.host,t.rejectUnauthorized),(n=r.connect(t)).on("secureConnect",(function(){t.rejectUnauthorized&&!n.authorized?n.emit("error",new Error("TLS not authorized")):n.removeListener("error",s)})),n.on("error",s),n}},{debug:17,tls:12}],5:[function(e,t,r){(function(r){"use strict";const i=e("ws"),s=e("debug")("mqttjs:ws"),o=e("duplexify"),a=e("safe-buffer").Buffer,c=e("url"),l=e("readable-stream").Transform;let u=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];const h=void 0!==r&&"browser"===r.title||"function"==typeof n;function d(e,t){let n=e.protocol+"://"+e.hostname+":"+e.port+e.path;return"function"==typeof e.transformWsUrl&&(n=e.transformWsUrl(n,e,t)),n}function p(e){let t=e;return e.hostname||(t.hostname="localhost"),e.port||("wss"===e.protocol?t.port=443:t.port=80),e.path||(t.path="/"),e.wsOptions||(t.wsOptions={}),h||"wss"!==e.protocol||u.forEach((function(n){e.hasOwnProperty(n)&&!e.wsOptions.hasOwnProperty(n)&&(t.wsOptions[n]=e[n])})),t}t.exports=h?function(e,t){let n;s("browserStreamBuilder");const r=function(e){let t=p(e);if(t.hostname||(t.hostname=t.host),!t.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");const e=c.parse(document.URL);t.hostname=e.hostname,t.port||(t.port=e.port)}return void 0===t.objectMode&&(t.objectMode=!(!0===t.binary||void 0===t.binary)),t}(t).browserBufferSize||524288,i=t.browserBufferTimeout||1e3,u=!t.objectMode;let h=function(e,t){const n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";let r=d(t,e),i=new WebSocket(r,[n]);return i.binaryType="arraybuffer",i}(e,t),f=function(e,t,n){let r=new l({objectModeMode:e.objectMode});return r._write=t,r._flush=n,r}(t,(function e(t,n,s){h.bufferedAmount>r&&setTimeout(e,i,t,n,s),u&&"string"==typeof t&&(t=a.from(t,"utf8"));try{h.send(t)}catch(e){return s(e)}s()}),(function(e){h.close(),e()}));t.objectMode||(f._writev=w),f.on("close",()=>{h.close()});const m=void 0===h.addEventListener;function g(){n.setReadable(f),n.setWritable(f),n.emit("connect")}function y(){n.end(),n.destroy()}function v(e){n.destroy(e)}function b(e){let t=e.data;t=t instanceof ArrayBuffer?a.from(t):a.from(t,"utf8"),f.push(t)}function w(e,t){const n=new Array(e.length);for(let t=0;t<e.length;t++)"string"==typeof e[t].chunk?n[t]=a.from(e[t],"utf8"):n[t]=e[t].chunk;this._write(a.concat(n),"binary",t)}return h.readyState===h.OPEN?n=f:(n=n=o(void 0,void 0,t),t.objectMode||(n._writev=w),m?h.addEventListener("open",g):h.onopen=g),n.socket=h,m?(h.addEventListener("close",y),h.addEventListener("error",v),h.addEventListener("message",b)):(h.onclose=y,h.onerror=v,h.onmessage=b),n}:function(e,t){s("streamBuilder");let n=p(t);const r=d(n,e);let o=function(e,t,n){s("createWebSocket"),s("protocol: "+n.protocolId+" "+n.protocolVersion);const r="MQIsdp"===n.protocolId&&3===n.protocolVersion?"mqttv3.1":"mqtt";return s("creating new Websocket for url: "+t+" and protocol: "+r),new i(t,[r],n.wsOptions)}(0,r,n),a=i.createWebSocketStream(o,n.wsOptions);return a.url=r,a}}).call(this,e("_process"))},{_process:101,debug:17,duplexify:19,"readable-stream":115,"safe-buffer":117,url:132,ws:139}],6:[function(e,t,n){(function(n){"use strict";var r,i,s,o=e("readable-stream").Transform,a=e("duplexify");t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var c="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";!function(e){e.hostname||(e.hostname="localhost"),e.path||(e.path="/"),e.wsOptions||(e.wsOptions={})}(t);var l=function(e,t){var n="wxs"===e.protocol?"wss":"ws",r=n+"://"+e.hostname+e.path;return e.port&&80!==e.port&&443!==e.port&&(r=n+"://"+e.hostname+":"+e.port+e.path),"function"==typeof e.transformWsUrl&&(r=e.transformWsUrl(r,e,t)),r}(t,e);r=wx.connectSocket({url:l,protocols:[c]}),i=function(){var e=new o;return e._write=function(e,t,n){r.send({data:e.buffer,success:function(){n()},fail:function(e){n(new Error(e))}})},e._flush=function(e){r.close({success:function(){e()}})},e}(),(s=a.obj())._destroy=function(e,t){r.close({success:function(){t&&t(e)}})};var u=s.destroy;return s.destroy=function(){s.destroy=u;var e=this;setTimeout((function(){r.close({fail:function(){e._destroy(new Error)}})}),0)}.bind(s),r.onOpen((function(){s.setReadable(i),s.setWritable(i),s.emit("connect")})),r.onMessage((function(e){var t=e.data;t=t instanceof ArrayBuffer?n.from(t):n.from(t,"utf8"),i.push(t)})),r.onClose((function(){s.end(),s.destroy()})),r.onError((function(e){s.destroy(new Error(e.errMsg))})),s}}).call(this,e("buffer").Buffer)},{buffer:13,duplexify:19,"readable-stream":115}],7:[function(e,t,n){"use strict";var r=e("xtend"),i=e("readable-stream").Readable,s={objectMode:!0},o={clean:!0},a=e("es6-map");function c(e){if(!(this instanceof c))return new c(e);this.options=e||{},this.options=r(o,e),this._inflights=new a}c.prototype.put=function(e,t){return this._inflights.set(e.messageId,e),t&&t(),this},c.prototype.createStream=function(){var e=new i(s),t=!1,n=[],r=0;return this._inflights.forEach((function(e,t){n.push(e)})),e._read=function(){!t&&r<n.length?this.push(n[r++]):this.push(null)},e.destroy=function(){if(!t){var e=this;t=!0,setTimeout((function(){e.emit("close")}),0)}},e},c.prototype.del=function(e,t){return(e=this._inflights.get(e.messageId))?(this._inflights.delete(e.messageId),t(null,e)):t&&t(new Error("missing packet")),this},c.prototype.get=function(e,t){return(e=this._inflights.get(e.messageId))?t(null,e):t&&t(new Error("missing packet")),this},c.prototype.close=function(e){this.options.clean&&(this._inflights=null),e&&e()},t.exports=c},{"es6-map":68,"readable-stream":115,xtend:140}],8:[function(e,t,n){"use strict";function r(e){for(var t=e.split("/"),n=0;n<t.length;n++)if("+"!==t[n]){if("#"===t[n])return n===t.length-1;if(-1!==t[n].indexOf("+")||-1!==t[n].indexOf("#"))return!1}return!0}t.exports={validateTopics:function(e){if(0===e.length)return"empty_topic_list";for(var t=0;t<e.length;t++)if(!r(e[t]))return e[t];return null}}},{}],9:[function(e,t,r){(function(r){"use strict";var i=e("../client"),s=e("../store"),o=e("url"),a=e("xtend"),c=e("debug")("mqttjs"),l={};function u(e,t){if(c("connecting to an MQTT broker..."),"object"!=typeof e||t||(t=e,e=null),t=t||{},e){var n=o.parse(e,!0);if(null!=n.port&&(n.port=Number(n.port)),null===(t=a(n,t)).protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}if(function(e){var t;e.auth&&((t=e.auth.match(/^(.+):(.+)$/))?(e.username=t[1],e.password=t[2]):e.username=e.auth)}(t),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;case"wx":t.protocol="wxs";break;case"ali":t.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+t.protocol+'"!')}}if(!l[t.protocol]){var r=-1!==["mqtts","wss"].indexOf(t.protocol);t.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((function(e,t){return(!r||t%2!=0)&&"function"==typeof l[e]}))[0]}if(!1===t.clean&&!t.clientId)throw new Error("Missing clientId for unclean clients");t.protocol&&(t.defaultProtocol=t.protocol);var s=new i((function(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol?t.servers[e._reconnectCount].protocol:t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),c("calling streambuilder for",t.protocol),l[t.protocol](e,t)}),t);return s.on("error",(function(){})),s}void 0!==r&&"browser"!==r.title||"function"==typeof n?(l.mqtt=e("./tcp"),l.tcp=e("./tcp"),l.ssl=e("./tls"),l.tls=e("./tls"),l.mqtts=e("./tls")):(l.wx=e("./wx"),l.wxs=e("./wx"),l.ali=e("./ali"),l.alis=e("./ali")),l.ws=e("./ws"),l.wss=e("./ws"),t.exports=u,t.exports.connect=u,t.exports.MqttClient=i,t.exports.Store=s}).call(this,e("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:101,debug:17,url:132,xtend:140}],10:[function(e,t,n){"use strict";n.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=l(e),o=r[0],a=r[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),u=0,h=a>0?o-4:o;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(u(e,o,o+16383>a?a:o+16383));return 1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var i,s,o=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],11:[function(e,t,n){var r=e("readable-stream/duplex"),i=e("util"),s=e("safe-buffer").Buffer;function o(e){if(!(this instanceof o))return new o(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",(function(e){e.on("error",t)})),this.on("unpipe",(function(e){e.removeListener("error",t)}))}else this.append(e);r.call(this)}i.inherits(o,r),o.prototype._offset=function(e){var t,n=0,r=0;if(0===e)return[0,0];for(;r<this._bufs.length;r++){if(e<(t=n+this._bufs[r].length)||r==this._bufs.length-1)return[r,e-n];n=t}},o.prototype.append=function(e){var t=0;if(s.isBuffer(e))this._appendBuffer(e);else if(Array.isArray(e))for(;t<e.length;t++)this.append(e[t]);else if(e instanceof o)for(;t<e._bufs.length;t++)this.append(e._bufs[t]);else null!=e&&("number"==typeof e&&(e=e.toString()),this._appendBuffer(s.from(e)));return this},o.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},o.prototype._write=function(e,t,n){this._appendBuffer(e),"function"==typeof n&&n()},o.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},o.prototype.end=function(e){r.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},o.prototype.get=function(e){return this.slice(e,e+1)[0]},o.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},o.prototype.copy=function(e,t,n,r){if(("number"!=typeof n||n<0)&&(n=0),("number"!=typeof r||r>this.length)&&(r=this.length),n>=this.length)return e||s.alloc(0);if(r<=0)return e||s.alloc(0);var i,o,a=!!e,c=this._offset(n),l=r-n,u=l,h=a&&t||0,d=c[1];if(0===n&&r==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:s.concat(this._bufs,this.length);for(o=0;o<this._bufs.length;o++)this._bufs[o].copy(e,h),h+=this._bufs[o].length;return e}if(u<=this._bufs[c[0]].length-d)return a?this._bufs[c[0]].copy(e,t,d,d+u):this._bufs[c[0]].slice(d,d+u);for(a||(e=s.allocUnsafe(l)),o=c[0];o<this._bufs.length;o++){if(!(u>(i=this._bufs[o].length-d))){this._bufs[o].copy(e,h,d,d+u);break}this._bufs[o].copy(e,h,d),h+=i,u-=i,d&&(d=0)}return e},o.prototype.shallowSlice=function(e,t){e=e||0,t=t||this.length,e<0&&(e+=this.length),t<0&&(t+=this.length);var n=this._offset(e),r=this._offset(t),i=this._bufs.slice(n[0],r[0]+1);return 0==r[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,r[1]),0!=n[1]&&(i[0]=i[0].slice(n[1])),new o(i)},o.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)},o.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},o.prototype.duplicate=function(){for(var e=0,t=new o;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},o.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var t in e)!function(t){o.prototype[t]=function(n){return this.slice(n,n+e[t])[t](0)}}(t)}(),t.exports=o},{"readable-stream/duplex":106,"safe-buffer":117,util:137}],12:[function(e,t,n){},{}],13:[function(e,t,n){(function(t){"use strict";var r=e("base64-js"),i=e("ieee754");function s(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');var n=new Uint8Array(e);return n.__proto__=t.prototype,n}function t(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return o(e,t,n)}function o(e,n,r){if("string"==typeof e)return function(e,n){if("string"==typeof n&&""!==n||(n="utf8"),!t.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var r=0|h(e,n),i=s(r),o=i.write(e,n);return o!==r&&(i=i.slice(0,o)),i}(e,n);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(L(e,ArrayBuffer)||e&&L(e.buffer,ArrayBuffer))return function(e,n,r){if(n<0||e.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<n+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;return(i=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r)).__proto__=t.prototype,i}(e,n,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return t.from(i,n,r);var o=function(e){if(t.isBuffer(e)){var n=0|u(e.length),r=s(n);return 0===r.length||e.copy(r,0,0,n),r}return void 0!==e.length?"number"!=typeof e.length||N(e.length)?s(0):l(e):"Buffer"===e.type&&Array.isArray(e.data)?l(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return t.from(e[Symbol.toPrimitive]("string"),n,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return a(e),s(e<0?0:0|u(e))}function l(e){for(var t=e.length<0?0:0|u(e.length),n=s(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function u(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function h(e,n){if(t.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||L(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;for(var s=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return j(e).length;default:if(s)return i?-1:M(e).length;n=(""+n).toLowerCase(),s=!0}}function d(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function f(e,n,r,i,s){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),N(r=+r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof n&&(n=t.from(n,i)),t.isBuffer(n))return 0===n.length?-1:m(e,n,r,i,s);if("number"==typeof n)return n&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,n,r):Uint8Array.prototype.lastIndexOf.call(e,n,r):m(e,[n],r,i,s);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var s,o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(s=n;s<a;s++)if(l(e,s)===l(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var h=!0,d=0;d<c;d++)if(l(e,s+d)!==l(t,d)){h=!1;break}if(h)return s}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(N(a))return o;e[n+o]=a}return o}function y(e,t,n,r){return D(M(t,e.length-n),e,n,r)}function v(e,t,n,r){return D(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return v(e,t,n,r)}function w(e,t,n,r){return D(j(t),e,n,r)}function _(e,t,n,r){return D(function(e,t){for(var n,r,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,o,a,c,l=e[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=n)switch(h){case 1:l<128&&(u=l);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&l)<<6|63&s)>127&&(u=c);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(c=(15&l)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){var r,i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var s="",o=t;o<n;++o)s+=(r=e[o])<16?"0"+r.toString(16):r.toString(16);return s}function P(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,n,r,i,s,o){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>s||n<o)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function O(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,r,s){return t=+t,n>>>=0,s||O(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function A(e,t,n,r,s){return t=+t,n>>>=0,s||O(e,0,n,8),i.write(e,t,n,r,52,8),n+8}n.Buffer=t,n.SlowBuffer=function(e){return+e!=e&&(e=0),t.alloc(+e)},n.INSPECT_MAX_BYTES=50,n.kMaxLength=2147483647,t.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(e,t,n){return o(e,t,n)},t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,t.alloc=function(e,t,n){return function(e,t,n){return a(e),e<=0?s(e):void 0!==t?"string"==typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},t.allocUnsafe=function(e){return c(e)},t.allocUnsafeSlow=function(e){return c(e)},t.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==t.prototype},t.compare=function(e,n){if(L(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),L(n,Uint8Array)&&(n=t.from(n,n.offset,n.byteLength)),!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===n)return 0;for(var r=e.length,i=n.length,s=0,o=Math.min(r,i);s<o;++s)if(e[s]!==n[s]){r=e[s],i=n[s];break}return r<i?-1:i<r?1:0},t.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,n){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var r;if(void 0===n)for(n=0,r=0;r<e.length;++r)n+=e[r].length;var i=t.allocUnsafe(n),s=0;for(r=0;r<e.length;++r){var o=e[r];if(L(o,Uint8Array)&&(o=t.from(o)),!t.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,s),s+=o.length}return i},t.byteLength=h,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},t.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},t.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},t.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):d.apply(this,arguments)},t.prototype.toLocaleString=t.prototype.toString,t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},t.prototype.compare=function(e,n,r,i,s){if(L(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),!t.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===s&&(s=this.length),n<0||r>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&n>=r)return 0;if(i>=s)return-1;if(n>=r)return 1;if(this===e)return 0;for(var o=(s>>>=0)-(i>>>=0),a=(r>>>=0)-(n>>>=0),c=Math.min(o,a),l=this.slice(i,s),u=e.slice(n,r),h=0;h<c;++h)if(l[h]!==u[h]){o=l[h],a=u[h];break}return o<a?-1:a<o?1:0},t.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},t.prototype.indexOf=function(e,t,n){return f(this,e,t,n,!0)},t.prototype.lastIndexOf=function(e,t,n){return f(this,e,t,n,!1)},t.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},t.prototype.slice=function(e,n){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(n=void 0===n?r:~~n)<0?(n+=r)<0&&(n=0):n>r&&(n=r),n<e&&(n=e);var i=this.subarray(e,n);return i.__proto__=t.prototype,i},t.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},t.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},t.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},t.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},t.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},t.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},t.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},t.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},t.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},t.prototype.readInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},t.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},t.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},t.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!0,23,4)},t.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!1,23,4)},t.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!0,52,8)},t.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!1,52,8)},t.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||x(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},t.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||x(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},t.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,1,255,0),this[t]=255&e,t+1},t.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},t.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},t.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},t.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},t.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},t.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},t.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},t.prototype.writeDoubleLE=function(e,t,n){return A(this,e,t,!0,n)},t.prototype.writeDoubleBE=function(e,t,n){return A(this,e,t,!1,n)},t.prototype.copy=function(e,n,r,i){if(!t.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),n>=e.length&&(n=e.length),n||(n=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-n<i-r&&(i=e.length-n+r);var s=i-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(n,r,i);else if(this===e&&r<n&&n<i)for(var o=s-1;o>=0;--o)e[o+n]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,i),n);return s},t.prototype.fill=function(e,n,r,i){if("string"==typeof e){if("string"==typeof n?(i=n,n=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var s=e.charCodeAt(0);("utf8"===i&&s<128||"latin1"===i)&&(e=s)}}else"number"==typeof e&&(e&=255);if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;var o;if(n>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=n;o<r;++o)this[o]=e;else{var a=t.isBuffer(e)?e:t.from(e,i),c=a.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-n;++o)this[o+n]=a[o%c]}return this};var R=/[^+/0-9A-Za-z-_]/g;function M(e,t){var n;t=t||1/0;for(var r=e.length,i=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function j(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function L(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function N(e){return e!=e}}).call(this,e("buffer").Buffer)},{"base64-js":10,buffer:13,ieee754:87}],14:[function(e,t,n){(function(e){function t(e){return Object.prototype.toString.call(e)}n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},n.isBoolean=function(e){return"boolean"==typeof e},n.isNull=function(e){return null===e},n.isNullOrUndefined=function(e){return null==e},n.isNumber=function(e){return"number"==typeof e},n.isString=function(e){return"string"==typeof e},n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=function(e){return void 0===e},n.isRegExp=function(e){return"[object RegExp]"===t(e)},n.isObject=function(e){return"object"==typeof e&&null!==e},n.isDate=function(e){return"[object Date]"===t(e)},n.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},n.isFunction=function(e){return"function"==typeof e},n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":89}],15:[function(e,t,n){"use strict";var r,i=e("type/value/is"),s=e("type/value/ensure"),o=e("type/plain-function/ensure"),a=e("es5-ext/object/copy"),c=e("es5-ext/object/normalize-options"),l=e("es5-ext/object/map"),u=Function.prototype.bind,h=Object.defineProperty,d=Object.prototype.hasOwnProperty;r=function(e,t,n){var r,i=s(t)&&o(t.value);return delete(r=a(t)).writable,delete r.value,r.get=function(){return!n.overwriteDefinition&&d.call(this,e)?i:(t.value=u.call(i,n.resolveContext?n.resolveContext(this):this),h(this,e,t),this[e])},r},t.exports=function(e){var t=c(arguments[1]);return i(t.resolveContext)&&o(t.resolveContext),l(e,(function(e,n){return r(n,e,t)}))}},{"es5-ext/object/copy":41,"es5-ext/object/map":49,"es5-ext/object/normalize-options":50,"type/plain-function/ensure":126,"type/value/ensure":130,"type/value/is":131}],16:[function(e,t,n){"use strict";var r=e("type/value/is"),i=e("type/plain-function/is"),s=e("es5-ext/object/assign"),o=e("es5-ext/object/normalize-options"),a=e("es5-ext/string/#/contains");(t.exports=function(e,t){var n,i,c,l,u;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],r(e)?(n=a.call(e,"c"),i=a.call(e,"e"),c=a.call(e,"w")):(n=c=!0,i=!1),u={value:t,configurable:n,enumerable:i,writable:c},l?s(o(l),u):u}).gs=function(e,t,n){var c,l,u,h;return"string"!=typeof e?(u=n,n=t,t=e,e=null):u=arguments[3],r(t)?i(t)?r(n)?i(n)||(u=n,n=void 0):n=void 0:(u=t,t=n=void 0):t=void 0,r(e)?(c=a.call(e,"c"),l=a.call(e,"e")):(c=!0,l=!1),h={get:t,set:n,configurable:c,enumerable:l},u?s(o(u),h):h}},{"es5-ext/object/assign":38,"es5-ext/object/normalize-options":50,"es5-ext/string/#/contains":57,"type/plain-function/is":127,"type/value/is":131}],17:[function(e,t,n){(function(r){n.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},n.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,n)},n.save=function(e){try{e?n.storage.setItem("debug",e):n.storage.removeItem("debug")}catch(e){}},n.load=function(){let e;try{e=n.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},n.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},n.storage=function(){try{return localStorage}catch(e){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(n);const{formatters:i}=t.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":18,_process:101}],18:[function(e,t,n){t.exports=function(t){function n(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let t;function o(...e){if(!o.enabled)return;const n=o,i=Number(new Date),s=i-(t||i);n.diff=s,n.prev=t,n.curr=i,t=i,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if("%%"===t)return t;a++;const s=r.formatters[i];if("function"==typeof s){const r=e[a];t=s.call(n,r),e.splice(a,1),a--}return t}),r.formatArgs.call(n,e),(n.log||r.log).apply(n,e)}return o.namespace=e,o.enabled=r.enabled(e),o.useColors=r.useColors(),o.color=n(e),o.destroy=i,o.extend=s,"function"==typeof r.init&&r.init(o),r.instances.push(o),o}function i(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function s(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(o),...r.skips.map(o).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),Object.keys(t).forEach(e=>{r[e]=t[e]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=n,r.enable(r.load()),r}},{ms:98}],19:[function(e,t,n){(function(n,r){var i=e("readable-stream"),s=e("end-of-stream"),o=e("inherits"),a=e("stream-shift"),c=r.from&&r.from!==Uint8Array.from?r.from([0]):new r([0]),l=function(e,t){e._corked?e.once("uncork",t):t()},u=function(e,t){return function(n){n?function(e,t){e._autoDestroy&&e.destroy(t)}(e,"premature close"===n.message?null:n):t&&!e._ended&&e.end()}},h=function(e,t,n){if(!(this instanceof h))return new h(e,t,n);i.Duplex.call(this,n),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!n||!1!==n.autoDestroy,this._forwardDestroy=!n||!1!==n.destroy,this._forwardEnd=!n||!1!==n.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};o(h,i.Duplex),h.obj=function(e,t,n){return n||(n={}),n.objectMode=!0,n.highWaterMark=16,new h(e,t,n)},h.prototype.cork=function(){1==++this._corked&&this.emit("cork")},h.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},h.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)e&&e.destroy&&e.destroy();else if(null!==e&&!1!==e){var t=this,r=s(e,{writable:!0,readable:!1},u(this,this._forwardEnd)),i=function(){var e=t._ondrain;t._ondrain=null,e&&e()};this._unwrite&&n.nextTick(i),this._writable=e,this._writable.on("drain",i),this._unwrite=function(){t._writable.removeListener("drain",i),r()},this.uncork()}else this.end()},h.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)e&&e.destroy&&e.destroy();else{if(null===e||!1===e)return this.push(null),void this.resume();var t,n=this,r=s(e,{writable:!1,readable:!0},u(this)),o=function(){n._forward()},a=function(){n.push(null)};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(t=e,new i.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on("readable",o),this._readable2.on("end",a),this._unread=function(){n._readable2.removeListener("readable",o),n._readable2.removeListener("end",a),r()},this._forward()}},h.prototype._read=function(){this._drained=!0,this._forward()},h.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=a(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},h.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;n.nextTick((function(){t._destroy(e)}))}},h.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},h.prototype._write=function(e,t,n){return this.destroyed?n():this._corked?l(this,this._write.bind(this,e,t,n)):e===c?this._finish(n):this._writable?void(!1===this._writable.write(e)?this._ondrain=n:n()):n()},h.prototype._finish=function(e){var t=this;this.emit("preend"),l(this,(function(){var n,r;n=t._forwardEnd&&t._writable,r=function(){!1===t._writableState.prefinished&&(t._writableState.prefinished=!0),t.emit("prefinish"),l(t,e)},n?n._writableState&&n._writableState.finished?r():n._writableState?n.end(r):(n.end(),r()):r()}))},h.prototype.end=function(e,t,n){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(c),i.Writable.prototype.end.call(this,n))},t.exports=h}).call(this,e("_process"),e("buffer").Buffer)},{_process:101,buffer:13,"end-of-stream":20,inherits:88,"readable-stream":115,"stream-shift":118}],20:[function(e,t,n){(function(n){var r=e("once"),i=function(){},s=function(e,t,o){if("function"==typeof t)return s(e,null,t);t||(t={}),o=r(o||i);var a=e._writableState,c=e._readableState,l=t.readable||!1!==t.readable&&e.readable,u=t.writable||!1!==t.writable&&e.writable,h=!1,d=function(){e.writable||p()},p=function(){u=!1,l||o.call(e)},f=function(){l=!1,u||o.call(e)},m=function(t){o.call(e,t?new Error("exited with error code: "+t):null)},g=function(t){o.call(e,t)},y=function(){n.nextTick(v)},v=function(){if(!h)return(!l||c&&c.ended&&!c.destroyed)&&(!u||a&&a.ended&&!a.destroyed)?void 0:o.call(e,new Error("premature close"))},b=function(){e.req.on("finish",p)};return function(e){return e.setHeader&&"function"==typeof e.abort}(e)?(e.on("complete",p),e.on("abort",y),e.req?b():e.on("request",b)):u&&!a&&(e.on("end",d),e.on("close",d)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(e)&&e.on("exit",m),e.on("end",f),e.on("finish",p),!1!==t.error&&e.on("error",g),e.on("close",y),function(){h=!0,e.removeListener("complete",p),e.removeListener("abort",y),e.removeListener("request",b),e.req&&e.req.removeListener("finish",p),e.removeListener("end",d),e.removeListener("close",d),e.removeListener("finish",p),e.removeListener("exit",m),e.removeListener("end",f),e.removeListener("error",g),e.removeListener("close",y)}};t.exports=s}).call(this,e("_process"))},{_process:101,once:99}],21:[function(e,t,n){"use strict";var r=e("../../object/valid-value");t.exports=function(){return r(this).length=0,this}},{"../../object/valid-value":56}],22:[function(e,t,n){"use strict";var r=e("../../number/is-nan"),i=e("../../number/to-pos-integer"),s=e("../../object/valid-value"),o=Array.prototype.indexOf,a=Object.prototype.hasOwnProperty,c=Math.abs,l=Math.floor;t.exports=function(e){var t,n,u,h;if(!r(e))return o.apply(this,arguments);for(n=i(s(this).length),u=arguments[1],t=u=isNaN(u)?0:u>=0?l(u):i(this.length)-l(c(u));t<n;++t)if(a.call(this,t)&&(h=this[t],r(h)))return t;return-1}},{"../../number/is-nan":32,"../../number/to-pos-integer":36,"../../object/valid-value":56}],23:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":24,"./shim":25}],24:[function(e,t,n){"use strict";t.exports=function(){var e,t,n=Array.from;return"function"==typeof n&&(t=n(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],25:[function(e,t,n){"use strict";var r=e("es6-symbol").iterator,i=e("../../function/is-arguments"),s=e("../../function/is-function"),o=e("../../number/to-pos-integer"),a=e("../../object/valid-callable"),c=e("../../object/valid-value"),l=e("../../object/is-value"),u=e("../../string/is-string"),h=Array.isArray,d=Function.prototype.call,p={configurable:!0,enumerable:!0,writable:!0,value:null},f=Object.defineProperty;t.exports=function(e){var t,n,m,g,y,v,b,w,_,S,I=arguments[1],k=arguments[2];if(e=Object(c(e)),l(I)&&a(I),this&&this!==Array&&s(this))t=this;else{if(!I){if(i(e))return 1!==(y=e.length)?Array.apply(null,e):((g=new Array(1))[0]=e[0],g);if(h(e)){for(g=new Array(y=e.length),n=0;n<y;++n)g[n]=e[n];return g}}g=[]}if(!h(e))if(void 0!==(_=e[r])){for(b=a(_).call(e),t&&(g=new t),w=b.next(),n=0;!w.done;)S=I?d.call(I,k,w.value,n):w.value,t?(p.value=S,f(g,n,p)):g[n]=S,w=b.next(),++n;y=n}else if(u(e)){for(y=e.length,t&&(g=new t),n=0,m=0;n<y;++n)S=e[n],n+1<y&&(v=S.charCodeAt(0))>=55296&&v<=56319&&(S+=e[++n]),S=I?d.call(I,k,S,m):S,t?(p.value=S,f(g,m,p)):g[m]=S,++m;y=m}if(void 0===y)for(y=o(e.length),t&&(g=new t(y)),n=0;n<y;++n)S=I?d.call(I,k,e[n],n):e[n],t?(p.value=S,f(g,n,p)):g[n]=S;return t&&(p.value=null,g.length=y),g}},{"../../function/is-arguments":26,"../../function/is-function":27,"../../number/to-pos-integer":36,"../../object/is-value":45,"../../object/valid-callable":55,"../../object/valid-value":56,"../../string/is-string":60,"es6-symbol":74}],26:[function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call(function(){return arguments}());t.exports=function(e){return r.call(e)===i}},{}],27:[function(e,t,n){"use strict";var r=Object.prototype.toString,i=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);t.exports=function(e){return"function"==typeof e&&i(r.call(e))}},{}],28:[function(e,t,n){"use strict";t.exports=function(){}},{}],29:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":30,"./shim":31}],30:[function(e,t,n){"use strict";t.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},{}],31:[function(e,t,n){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},{}],32:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Number.isNaN:e("./shim")},{"./is-implemented":33,"./shim":34}],33:[function(e,t,n){"use strict";t.exports=function(){var e=Number.isNaN;return"function"==typeof e&&!e({})&&e(NaN)&&!e(34)}},{}],34:[function(e,t,n){"use strict";t.exports=function(e){return e!=e}},{}],35:[function(e,t,n){"use strict";var r=e("../math/sign"),i=Math.abs,s=Math.floor;t.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?r(e)*s(i(e)):e}},{"../math/sign":29}],36:[function(e,t,n){"use strict";var r=e("./to-integer"),i=Math.max;t.exports=function(e){return i(0,r(e))}},{"./to-integer":35}],37:[function(e,t,n){"use strict";var r=e("./valid-callable"),i=e("./valid-value"),s=Function.prototype.bind,o=Function.prototype.call,a=Object.keys,c=Object.prototype.propertyIsEnumerable;t.exports=function(e,t){return function(n,l){var u,h=arguments[2],d=arguments[3];return n=Object(i(n)),r(l),u=a(n),d&&u.sort("function"==typeof d?s.call(d,n):void 0),"function"!=typeof e&&(e=u[e]),o.call(e,u,(function(e,r){return c.call(n,e)?o.call(l,h,n[e],e,n,r):t}))}}},{"./valid-callable":55,"./valid-value":56}],38:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":39,"./shim":40}],39:[function(e,t,n){"use strict";t.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],40:[function(e,t,n){"use strict";var r=e("../keys"),i=e("../valid-value"),s=Math.max;t.exports=function(e,t){var n,o,a,c=s(arguments.length,2);for(e=Object(i(e)),a=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},o=1;o<c;++o)r(t=arguments[o]).forEach(a);if(void 0!==n)throw n;return e}},{"../keys":46,"../valid-value":56}],41:[function(e,t,n){"use strict";var r=e("../array/from"),i=e("./assign"),s=e("./valid-value");t.exports=function(e){var t=Object(s(e)),n=arguments[1],o=Object(arguments[2]);if(t!==e&&!n)return t;var a={};return n?r(n,(function(t){(o.ensure||t in e)&&(a[t]=e[t])})):i(a,e),a}},{"../array/from":23,"./assign":38,"./valid-value":56}],42:[function(e,t,n){"use strict";var r,i,s,o,a=Object.create;e("./set-prototype-of/is-implemented")()||(r=e("./set-prototype-of/shim")),t.exports=r?1!==r.level?a:(i={},s={},o={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach((function(e){s[e]="__proto__"!==e?o:{configurable:!0,enumerable:!1,writable:!0,value:void 0}})),Object.defineProperties(i,s),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:i}),function(e,t){return a(null===e?i:e,t)}):a},{"./set-prototype-of/is-implemented":53,"./set-prototype-of/shim":54}],43:[function(e,t,n){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":37}],44:[function(e,t,n){"use strict";var r=e("./is-value"),i={function:!0,object:!0};t.exports=function(e){return r(e)&&i[typeof e]||!1}},{"./is-value":45}],45:[function(e,t,n){"use strict";var r=e("../function/noop")();t.exports=function(e){return e!==r&&null!==e}},{"../function/noop":28}],46:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":47,"./shim":48}],47:[function(e,t,n){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],48:[function(e,t,n){"use strict";var r=e("../is-value"),i=Object.keys;t.exports=function(e){return i(r(e)?Object(e):e)}},{"../is-value":45}],49:[function(e,t,n){"use strict";var r=e("./valid-callable"),i=e("./for-each"),s=Function.prototype.call;t.exports=function(e,t){var n={},o=arguments[2];return r(t),i(e,(function(e,r,i,a){n[r]=s.call(t,o,e,r,i,a)})),n}},{"./for-each":43,"./valid-callable":55}],50:[function(e,t,n){"use strict";var r=e("./is-value"),i=Array.prototype.forEach,s=Object.create,o=function(e,t){var n;for(n in e)t[n]=e[n]};t.exports=function(e){var t=s(null);return i.call(arguments,(function(e){r(e)&&o(Object(e),t)})),t}},{"./is-value":45}],51:[function(e,t,n){"use strict";var r=Array.prototype.forEach,i=Object.create;t.exports=function(e){var t=i(null);return r.call(arguments,(function(e){t[e]=!0})),t}},{}],52:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Object.setPrototypeOf:e("./shim")},{"./is-implemented":53,"./shim":54}],53:[function(e,t,n){"use strict";var r=Object.create,i=Object.getPrototypeOf,s={};t.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||r;return"function"==typeof e&&i(e(t(null),s))===s}},{}],54:[function(e,t,n){"use strict";var r,i=e("../is-object"),s=e("../valid-value"),o=Object.prototype.isPrototypeOf,a=Object.defineProperty,c={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(e,t){if(s(e),null===t||i(t))return e;throw new TypeError("Prototype must be null or an object")},t.exports=function(e){var t,n;return e?(2===e.level?e.set?(n=e.set,t=function(e,t){return n.call(r(e,t),t),e}):t=function(e,t){return r(e,t).__proto__=t,e}:t=function e(t,n){var i;return r(t,n),(i=o.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===n&&(n=e.nullPolyfill),t.__proto__=n,i&&a(e.nullPolyfill,"__proto__",c),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:e.level})):null}(function(){var e,t=Object.create(null),n={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{(e=r.set).call(t,n)}catch(e){}if(Object.getPrototypeOf(t)===n)return{set:e,level:2}}return t.__proto__=n,Object.getPrototypeOf(t)===n?{level:2}:((t={}).__proto__=n,Object.getPrototypeOf(t)===n&&{level:1})}()),e("../create")},{"../create":42,"../is-object":44,"../valid-value":56}],55:[function(e,t,n){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],56:[function(e,t,n){"use strict";var r=e("./is-value");t.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},{"./is-value":45}],57:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":58,"./shim":59}],58:[function(e,t,n){"use strict";var r="razdwatrzy";t.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},{}],59:[function(e,t,n){"use strict";var r=String.prototype.indexOf;t.exports=function(e){return r.call(this,e,arguments[1])>-1}},{}],60:[function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||r.call(e)===i)||!1}},{}],61:[function(e,t,n){"use strict";var r,i=e("es5-ext/object/set-prototype-of"),s=e("es5-ext/string/#/contains"),o=e("d"),a=e("es6-symbol"),c=e("./"),l=Object.defineProperty;r=t.exports=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");c.call(this,e),t=t?s.call(t,"key+value")?"key+value":s.call(t,"key")?"key":"value":"value",l(this,"__kind__",o("",t))},i&&i(r,c),delete r.prototype.constructor,r.prototype=Object.create(c.prototype,{_resolve:o((function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e}))}),l(r.prototype,a.toStringTag,o("c","Array Iterator"))},{"./":64,d:16,"es5-ext/object/set-prototype-of":52,"es5-ext/string/#/contains":57,"es6-symbol":74}],62:[function(e,t,n){"use strict";var r=e("es5-ext/function/is-arguments"),i=e("es5-ext/object/valid-callable"),s=e("es5-ext/string/is-string"),o=e("./get"),a=Array.isArray,c=Function.prototype.call,l=Array.prototype.some;t.exports=function(e,t){var n,u,h,d,p,f,m,g,y=arguments[2];if(a(e)||r(e)?n="array":s(e)?n="string":e=o(e),i(t),h=function(){d=!0},"array"!==n)if("string"!==n)for(u=e.next();!u.done;){if(c.call(t,y,u.value,h),d)return;u=e.next()}else for(f=e.length,p=0;p<f&&(m=e[p],p+1<f&&(g=m.charCodeAt(0))>=55296&&g<=56319&&(m+=e[++p]),c.call(t,y,m,h),!d);++p);else l.call(e,(function(e){return c.call(t,y,e,h),d}))}},{"./get":63,"es5-ext/function/is-arguments":26,"es5-ext/object/valid-callable":55,"es5-ext/string/is-string":60}],63:[function(e,t,n){"use strict";var r=e("es5-ext/function/is-arguments"),i=e("es5-ext/string/is-string"),s=e("./array"),o=e("./string"),a=e("./valid-iterable"),c=e("es6-symbol").iterator;t.exports=function(e){return"function"==typeof a(e)[c]?e[c]():r(e)?new s(e):i(e)?new o(e):new s(e)}},{"./array":61,"./string":66,"./valid-iterable":67,"es5-ext/function/is-arguments":26,"es5-ext/string/is-string":60,"es6-symbol":74}],64:[function(e,t,n){"use strict";var r,i=e("es5-ext/array/#/clear"),s=e("es5-ext/object/assign"),o=e("es5-ext/object/valid-callable"),a=e("es5-ext/object/valid-value"),c=e("d"),l=e("d/auto-bind"),u=e("es6-symbol"),h=Object.defineProperty,d=Object.defineProperties;t.exports=r=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");d(this,{__list__:c("w",a(e)),__context__:c("w",t),__nextIndex__:c("w",0)}),t&&(o(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete r.prototype.constructor,d(r.prototype,s({_next:c((function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()})),next:c((function(){return this._createResult(this._next())})),_createResult:c((function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}})),_resolve:c((function(e){return this.__list__[e]})),_unBind:c((function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)})),toString:c((function(){return"[object "+(this[u.toStringTag]||"Object")+"]"}))},l({_onAdd:c((function(e){e>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach((function(t,n){t>=e&&(this.__redo__[n]=++t)}),this),this.__redo__.push(e)):h(this,"__redo__",c("c",[e])))})),_onDelete:c((function(e){var t;e>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(e))&&this.__redo__.splice(t,1),this.__redo__.forEach((function(t,n){t>e&&(this.__redo__[n]=--t)}),this)))})),_onClear:c((function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0}))}))),h(r.prototype,u.iterator,c((function(){return this})))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":21,"es5-ext/object/assign":38,"es5-ext/object/valid-callable":55,"es5-ext/object/valid-value":56,"es6-symbol":74}],65:[function(e,t,n){"use strict";var r=e("es5-ext/function/is-arguments"),i=e("es5-ext/object/is-value"),s=e("es5-ext/string/is-string"),o=e("es6-symbol").iterator,a=Array.isArray;t.exports=function(e){return!(!i(e)||!a(e)&&!s(e)&&!r(e)&&"function"!=typeof e[o])}},{"es5-ext/function/is-arguments":26,"es5-ext/object/is-value":45,"es5-ext/string/is-string":60,"es6-symbol":74}],66:[function(e,t,n){"use strict";var r,i=e("es5-ext/object/set-prototype-of"),s=e("d"),o=e("es6-symbol"),a=e("./"),c=Object.defineProperty;r=t.exports=function(e){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");e=String(e),a.call(this,e),c(this,"__length__",s("",e.length))},i&&i(r,a),delete r.prototype.constructor,r.prototype=Object.create(a.prototype,{_next:s((function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()})),_resolve:s((function(e){var t,n=this.__list__[e];return this.__nextIndex__===this.__length__?n:(t=n.charCodeAt(0))>=55296&&t<=56319?n+this.__list__[this.__nextIndex__++]:n}))}),c(r.prototype,o.toStringTag,s("c","String Iterator"))},{"./":64,d:16,"es5-ext/object/set-prototype-of":52,"es6-symbol":74}],67:[function(e,t,n){"use strict";var r=e("./is-iterable");t.exports=function(e){if(!r(e))throw new TypeError(e+" is not iterable");return e}},{"./is-iterable":65}],68:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Map:e("./polyfill")},{"./is-implemented":69,"./polyfill":73}],69:[function(e,t,n){"use strict";t.exports=function(){var e,t;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&3===e.size&&"function"==typeof e.clear&&"function"==typeof e.delete&&"function"==typeof e.entries&&"function"==typeof e.forEach&&"function"==typeof e.get&&"function"==typeof e.has&&"function"==typeof e.keys&&"function"==typeof e.set&&"function"==typeof e.values&&!1===(t=e.entries().next()).done&&!!t.value&&"raz"===t.value[0]&&"one"===t.value[1]}},{}],70:[function(e,t,n){"use strict";t.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],71:[function(e,t,n){"use strict";t.exports=e("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":51}],72:[function(e,t,n){"use strict";var r,i=e("es5-ext/object/set-prototype-of"),s=e("d"),o=e("es6-iterator"),a=e("es6-symbol").toStringTag,c=e("./iterator-kinds"),l=Object.defineProperties,u=o.prototype._unBind;r=t.exports=function(e,t){if(!(this instanceof r))return new r(e,t);o.call(this,e.__mapKeysData__,e),t&&c[t]||(t="key+value"),l(this,{__kind__:s("",t),__values__:s("w",e.__mapValuesData__)})},i&&i(r,o),r.prototype=Object.create(o.prototype,{constructor:s(r),_resolve:s((function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]})),_unBind:s((function(){this.__values__=null,u.call(this)})),toString:s((function(){return"[object Map Iterator]"}))}),Object.defineProperty(r.prototype,a,s("c","Map Iterator"))},{"./iterator-kinds":71,d:16,"es5-ext/object/set-prototype-of":52,"es6-iterator":64,"es6-symbol":74}],73:[function(e,t,n){"use strict";var r,i=e("es5-ext/array/#/clear"),s=e("es5-ext/array/#/e-index-of"),o=e("es5-ext/object/set-prototype-of"),a=e("es5-ext/object/valid-callable"),c=e("es5-ext/object/valid-value"),l=e("d"),u=e("event-emitter"),h=e("es6-symbol"),d=e("es6-iterator/valid-iterable"),p=e("es6-iterator/for-of"),f=e("./lib/iterator"),m=e("./is-native-implemented"),g=Function.prototype.call,y=Object.defineProperties,v=Object.getPrototypeOf;t.exports=r=function(){var e,t,n,i=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return n=m&&o&&Map!==r?o(new Map,v(this)):this,null!=i&&d(i),y(n,{__mapKeysData__:l("c",e=[]),__mapValuesData__:l("c",t=[])}),i?(p(i,(function(n){var r=c(n)[0];n=n[1],-1===s.call(e,r)&&(e.push(r),t.push(n))}),n),n):n},m&&(o&&o(r,Map),r.prototype=Object.create(Map.prototype,{constructor:l(r)})),u(y(r.prototype,{clear:l((function(){this.__mapKeysData__.length&&(i.call(this.__mapKeysData__),i.call(this.__mapValuesData__),this.emit("_clear"))})),delete:l((function(e){var t=s.call(this.__mapKeysData__,e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)})),entries:l((function(){return new f(this,"key+value")})),forEach:l((function(e){var t,n,r=arguments[1];for(a(e),n=(t=this.entries())._next();void 0!==n;)g.call(e,r,this.__mapValuesData__[n],this.__mapKeysData__[n],this),n=t._next()})),get:l((function(e){var t=s.call(this.__mapKeysData__,e);if(-1!==t)return this.__mapValuesData__[t]})),has:l((function(e){return-1!==s.call(this.__mapKeysData__,e)})),keys:l((function(){return new f(this,"key")})),set:l((function(e,t){var n,r=s.call(this.__mapKeysData__,e);return-1===r&&(r=this.__mapKeysData__.push(e)-1,n=!0),this.__mapValuesData__[r]=t,n&&this.emit("_add",r,e),this})),size:l.gs((function(){return this.__mapKeysData__.length})),values:l((function(){return new f(this,"value")})),toString:l((function(){return"[object Map]"}))})),Object.defineProperty(r.prototype,h.iterator,l((function(){return this.entries()}))),Object.defineProperty(r.prototype,h.toStringTag,l("c","Map"))},{"./is-native-implemented":70,"./lib/iterator":72,d:16,"es5-ext/array/#/clear":21,"es5-ext/array/#/e-index-of":22,"es5-ext/object/set-prototype-of":52,"es5-ext/object/valid-callable":55,"es5-ext/object/valid-value":56,"es6-iterator/for-of":62,"es6-iterator/valid-iterable":67,"es6-symbol":74,"event-emitter":82}],74:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?e("ext/global-this").Symbol:e("./polyfill")},{"./is-implemented":75,"./polyfill":80,"ext/global-this":85}],75:[function(e,t,n){"use strict";var r=e("ext/global-this"),i={object:!0,symbol:!0};t.exports=function(){var e,t=r.Symbol;if("function"!=typeof t)return!1;e=t("test symbol");try{String(e)}catch(e){return!1}return!!i[typeof t.iterator]&&!!i[typeof t.toPrimitive]&&!!i[typeof t.toStringTag]}},{"ext/global-this":85}],76:[function(e,t,n){"use strict";t.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},{}],77:[function(e,t,n){"use strict";var r=e("d"),i=Object.create,s=Object.defineProperty,o=Object.prototype,a=i(null);t.exports=function(e){for(var t,n,i=0;a[e+(i||"")];)++i;return a[e+=i||""]=!0,s(o,t="@@"+e,r.gs(null,(function(e){n||(n=!0,s(this,t,r(e)),n=!1)}))),t}},{d:16}],78:[function(e,t,n){"use strict";var r=e("d"),i=e("ext/global-this").Symbol;t.exports=function(e){return Object.defineProperties(e,{hasInstance:r("",i&&i.hasInstance||e("hasInstance")),isConcatSpreadable:r("",i&&i.isConcatSpreadable||e("isConcatSpreadable")),iterator:r("",i&&i.iterator||e("iterator")),match:r("",i&&i.match||e("match")),replace:r("",i&&i.replace||e("replace")),search:r("",i&&i.search||e("search")),species:r("",i&&i.species||e("species")),split:r("",i&&i.split||e("split")),toPrimitive:r("",i&&i.toPrimitive||e("toPrimitive")),toStringTag:r("",i&&i.toStringTag||e("toStringTag")),unscopables:r("",i&&i.unscopables||e("unscopables"))})}},{d:16,"ext/global-this":85}],79:[function(e,t,n){"use strict";var r=e("d"),i=e("../../../validate-symbol"),s=Object.create(null);t.exports=function(e){return Object.defineProperties(e,{for:r((function(t){return s[t]?s[t]:s[t]=e(String(t))})),keyFor:r((function(e){var t;for(t in i(e),s)if(s[t]===e)return t}))})}},{"../../../validate-symbol":81,d:16}],80:[function(e,t,n){"use strict";var r,i,s,o=e("d"),a=e("./validate-symbol"),c=e("ext/global-this").Symbol,l=e("./lib/private/generate-name"),u=e("./lib/private/setup/standard-symbols"),h=e("./lib/private/setup/symbol-registry"),d=Object.create,p=Object.defineProperties,f=Object.defineProperty;if("function"==typeof c)try{String(c()),s=!0}catch(e){}else c=null;i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return r(e)},t.exports=r=function e(t){var n;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return s?c(t):(n=d(i.prototype),t=void 0===t?"":String(t),p(n,{__description__:o("",t),__name__:o("",l(t))}))},u(r),h(r),p(i.prototype,{constructor:o(r),toString:o("",(function(){return this.__name__}))}),p(r.prototype,{toString:o((function(){return"Symbol ("+a(this).__description__+")"})),valueOf:o((function(){return a(this)}))}),f(r.prototype,r.toPrimitive,o("",(function(){var e=a(this);return"symbol"==typeof e?e:e.toString()}))),f(r.prototype,r.toStringTag,o("c","Symbol")),f(i.prototype,r.toStringTag,o("c",r.prototype[r.toStringTag])),f(i.prototype,r.toPrimitive,o("c",r.prototype[r.toPrimitive]))},{"./lib/private/generate-name":77,"./lib/private/setup/standard-symbols":78,"./lib/private/setup/symbol-registry":79,"./validate-symbol":81,d:16,"ext/global-this":85}],81:[function(e,t,n){"use strict";var r=e("./is-symbol");t.exports=function(e){if(!r(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":76}],82:[function(e,t,n){"use strict";var r,i,s,o,a,c,l,u=e("d"),h=e("es5-ext/object/valid-callable"),d=Function.prototype.apply,p=Function.prototype.call,f=Object.create,m=Object.defineProperty,g=Object.defineProperties,y=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return h(t),i=this,r.call(this,e,n=function(){s.call(i,e,n),d.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a={on:r=function(e,t){var n;return h(t),y.call(this,"__ee__")?n=this.__ee__:(n=v.value=f(null),m(this,"__ee__",v),v.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:s=function(e,t){var n,r,i,s;if(h(t),!y.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==typeof(r=n[e]))for(s=0;i=r[s];++s)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[s?0:1]:r.splice(s,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:o=function(e){var t,n,r,i,s;if(y.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,s=new Array(n-1),t=1;t<n;++t)s[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)d.call(r,this,s)}else switch(arguments.length){case 1:p.call(i,this);break;case 2:p.call(i,this,arguments[1]);break;case 3:p.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,s=new Array(n-1),t=1;t<n;++t)s[t-1]=arguments[t];d.call(i,this,s)}}},c={on:u(r),once:u(i),off:u(s),emit:u(o)},l=g({},c),t.exports=n=function(e){return null==e?f(l):g(Object(e),c)},n.methods=a},{d:16,"es5-ext/object/valid-callable":55}],83:[function(e,t,n){var r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},s=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function o(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0;var a,c=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),a=0===l.x}catch(e){a=!1}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,n){if(t)e.call(n);else for(var r=e.length,i=_(e,r),s=0;s<r;++s)i[s].call(n)}function d(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=_(e,i),o=0;o<i;++o)s[o].call(n,r)}function p(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=_(e,s),a=0;a<s;++a)o[a].call(n,r,i)}function f(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,a=_(e,o),c=0;c<o;++c)a[c].call(n,r,i,s)}function m(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=_(e,i),o=0;o<i;++o)s[o].apply(n,r)}function g(e,t,n,i){var s,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=r(null),e._eventsCount=0),a){if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(s=u(e))&&s>0&&a.length>s){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else a=o[t]=n,++e._eventsCount;return e}function y(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function v(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=s.call(y,r);return i.listener=n,r.wrapFn=i,i}function b(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):_(i,i.length):[]}function w(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function _(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}a?Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):o.defaultMaxListeners=c,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){var t,n,r,i,s,o,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:h(n,l,this);break;case 2:d(n,l,this,arguments[1]);break;case 3:p(n,l,this,arguments[1],arguments[2]);break;case 4:f(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];m(n,l,this,i)}return!0},o.prototype.addListener=function(e,t){return g(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return g(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,v(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,v(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,s,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;0===s?n.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,s),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.removeAllListeners=function(e){var t,n,s;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var o,a=i(n);for(s=0;s<a.length;++s)"removeListener"!==(o=a[s])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return b(this,e,!0)},o.prototype.rawListeners=function(e){return b(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):w.call(e,t)},o.prototype.listenerCount=w,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],84:[function(e,t,n){var r=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},{}],85:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?globalThis:e("./implementation")},{"./implementation":84,"./is-implemented":86}],86:[function(e,t,n){"use strict";t.exports=function(){return"object"==typeof globalThis&&!!globalThis&&globalThis.Array===Array}},{}],87:[function(e,t,n){n.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=l}return(p?-1:1)*o*Math.pow(2,s-r)},n.write=function(e,t,n,r,i,s){var o,a,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&a,p+=f,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+p]=255&o,p+=f,o/=256,l-=8);e[n+p-f]|=128*m}},{}],88:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],89:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],90:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],91:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=t.exports;for(var s in i.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},i.codes={},i.types){var o=i.types[s];i.codes[o]=s}for(var a in i.CMD_SHIFT=4,i.CMD_MASK=240,i.DUP_MASK=8,i.QOS_MASK=3,i.QOS_SHIFT=1,i.RETAIN_MASK=1,i.LENGTH_MASK=127,i.LENGTH_FIN_MASK=128,i.SESSIONPRESENT_MASK=1,i.SESSIONPRESENT_HEADER=r.from([i.SESSIONPRESENT_MASK]),i.CONNACK_HEADER=r.from([i.codes.connack<<i.CMD_SHIFT]),i.USERNAME_MASK=128,i.PASSWORD_MASK=64,i.WILL_RETAIN_MASK=32,i.WILL_QOS_MASK=24,i.WILL_QOS_SHIFT=3,i.WILL_FLAG_MASK=4,i.CLEAN_SESSION_MASK=2,i.CONNECT_HEADER=r.from([i.codes.connect<<i.CMD_SHIFT]),i.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},i.propertiesCodes={},i.properties){var c=i.properties[a];i.propertiesCodes[c]=a}function l(e){return[0,1,2].map((function(t){return[0,1].map((function(n){return[0,1].map((function(s){var o=r.alloc(1);return o.writeUInt8(i.codes[e]<<i.CMD_SHIFT|(n?i.DUP_MASK:0)|t<<i.QOS_SHIFT|s,0,!0),o}))}))}))}i.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},i.PUBLISH_HEADER=l("publish"),i.SUBSCRIBE_HEADER=l("subscribe"),i.SUBSCRIBE_OPTIONS_QOS_MASK=3,i.SUBSCRIBE_OPTIONS_NL_MASK=1,i.SUBSCRIBE_OPTIONS_NL_SHIFT=2,i.SUBSCRIBE_OPTIONS_RAP_MASK=1,i.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,i.SUBSCRIBE_OPTIONS_RH_MASK=3,i.SUBSCRIBE_OPTIONS_RH_SHIFT=4,i.SUBSCRIBE_OPTIONS_RH=[0,16,32],i.SUBSCRIBE_OPTIONS_NL=4,i.SUBSCRIBE_OPTIONS_RAP=8,i.SUBSCRIBE_OPTIONS_QOS=[0,1,2],i.UNSUBSCRIBE_HEADER=l("unsubscribe"),i.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},i.SUBACK_HEADER=r.from([i.codes.suback<<i.CMD_SHIFT]),i.VERSION3=r.from([3]),i.VERSION4=r.from([4]),i.VERSION5=r.from([5]),i.QOS=[0,1,2].map((function(e){return r.from([e])})),i.EMPTY={pingreq:r.from([i.codes.pingreq<<4,0]),pingresp:r.from([i.codes.pingresp<<4,0]),disconnect:r.from([i.codes.disconnect<<4,0])}},{"safe-buffer":117}],92:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=e("./writeToStream"),s=e("events").EventEmitter;function o(){this._array=new Array(20),this._i=0}e("inherits")(o,s),o.prototype.write=function(e){return this._array[this._i++]=e,!0},o.prototype.concat=function(){var e,t,n=0,i=new Array(this._array.length),s=this._array,o=0;for(e=0;e<s.length&&void 0!==s[e];e++)"string"!=typeof s[e]?i[e]=s[e].length:i[e]=r.byteLength(s[e]),n+=i[e];for(t=r.allocUnsafe(n),e=0;e<s.length&&void 0!==s[e];e++)"string"!=typeof s[e]?(s[e].copy(t,o),o+=i[e]):(t.write(s[e],o),o+=i[e]);return t},t.exports=function(e,t){var n=new o;return i(e,n,t),n.concat()}},{"./writeToStream":97,events:83,inherits:88,"safe-buffer":117}],93:[function(e,t,n){"use strict";n.parser=e("./parser"),n.generate=e("./generate"),n.writeToStream=e("./writeToStream")},{"./generate":92,"./parser":96,"./writeToStream":97}],94:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i={};function s(e){var t=r.allocUnsafe(2);return t.writeUInt8(e>>8,0),t.writeUInt8(255&e,1),t}t.exports={cache:i,generateCache:function(){for(var e=0;e<65536;e++)i[e]=s(e)},generateNumber:s,genBufVariableByteInt:function(e){var t=0,n=0,i=function(e){return e>=0&&e<128?1:e>=128&&e<16384?2:e>=16384&&e<2097152?3:e>=2097152&&e<268435456?4:0}(e),s=r.allocUnsafe(i);do{t=e%128|0,(e=e/128|0)>0&&(t|=128),s.writeUInt8(t,n++)}while(e>0);return{data:s,length:i}},generate4ByteBuffer:function(e){var t=r.allocUnsafe(4);return t.writeUInt32BE(e,0),t}}},{"safe-buffer":117}],95:[function(e,t,n){t.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},{}],96:[function(e,t,n){"use strict";var r=e("bl"),i=e("inherits"),s=e("events").EventEmitter,o=e("./packet"),a=e("./constants"),c=e("debug")("mqtt-packet:parser");function l(e){if(!(this instanceof l))return new l(e);this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}i(l,s),l.prototype._resetState=function(){c("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new o,this.error=null,this._list=r(),this._stateCounter=0},l.prototype.parse=function(e){for(this.error&&this._resetState(),this._list.append(e),c("parse: current state: %s",this._states[this._stateCounter]);(-1!==this.packet.length||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,c("parse: state complete. _stateCounter is now: %d",this._stateCounter),c("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return c("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length},l.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=a.types[e>>a.CMD_SHIFT],this.packet.retain=0!=(e&a.RETAIN_MASK),this.packet.qos=e>>a.QOS_SHIFT&a.QOS_MASK,this.packet.dup=0!=(e&a.DUP_MASK),c("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0},l.prototype._parseLength=function(){var e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),c("_parseLength %d",e.value),!!e},l.prototype._parsePayload=function(){c("_parsePayload: payload %O",this._list);var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return c("_parsePayload complete result: %s",e),e},l.prototype._parseConnect=function(){var e,t,n,r,i,s;c("_parseConnect");var o={},l=this.packet;if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==e&&"MQIsdp"!==e)return this._emitError(new Error("Invalid protocolId"));if(l.protocolId=e,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(l.protocolVersion=this._list.readUInt8(this._pos),3!==l.protocolVersion&&4!==l.protocolVersion&&5!==l.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.username=this._list.readUInt8(this._pos)&a.USERNAME_MASK,o.password=this._list.readUInt8(this._pos)&a.PASSWORD_MASK,o.will=this._list.readUInt8(this._pos)&a.WILL_FLAG_MASK,o.will&&(l.will={},l.will.retain=0!=(this._list.readUInt8(this._pos)&a.WILL_RETAIN_MASK),l.will.qos=(this._list.readUInt8(this._pos)&a.WILL_QOS_MASK)>>a.WILL_QOS_SHIFT),l.clean=0!=(this._list.readUInt8(this._pos)&a.CLEAN_SESSION_MASK),this._pos++,l.keepalive=this._parseNum(),-1===l.keepalive)return this._emitError(new Error("Packet too short"));if(5===l.protocolVersion){var u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(l.properties=u)}if(null===(t=this._parseString()))return this._emitError(new Error("Packet too short"));if(l.clientId=t,c("_parseConnect: packet.clientId: %s",l.clientId),o.will){if(5===l.protocolVersion){var h=this._parseProperties();Object.getOwnPropertyNames(h).length&&(l.will.properties=h)}if(null===(n=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(l.will.topic=n,c("_parseConnect: packet.will.topic: %s",l.will.topic),null===(r=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));l.will.payload=r,c("_parseConnect: packet.will.paylaod: %s",l.will.payload)}if(o.username){if(null===(s=this._parseString()))return this._emitError(new Error("Cannot parse username"));l.username=s,c("_parseConnect: packet.username: %s",l.username)}if(o.password){if(null===(i=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));l.password=i}return this.settings=l,c("_parseConnect: complete"),l},l.prototype._parseConnack=function(){c("_parseConnack");var e=this.packet;if(this._list.length<2)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&a.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?e.reasonCode=this._list.readUInt8(this._pos++):e.returnCode=this._list.readUInt8(this._pos++),-1===e.returnCode||-1===e.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}c("_parseConnack: complete")},l.prototype._parsePublish=function(){c("_parsePublish");var e=this.packet;if(e.topic=this._parseString(),null===e.topic)return this._emitError(new Error("Cannot parse topic"));if(!(e.qos>0)||this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length),c("_parsePublish: payload from buffer list: %o",e.payload)}},l.prototype._parseSubscribe=function(){c("_parseSubscribe");var e,t,n,r,i,s,o,l=this.packet;if(1!==l.qos)return this._emitError(new Error("Wrong subscribe header"));if(l.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(l.properties=u)}for(;this._pos<l.length;){if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse topic"));if(this._pos>=l.length)return this._emitError(new Error("Malformed Subscribe Payload"));n=(t=this._parseByte())&a.SUBSCRIBE_OPTIONS_QOS_MASK,s=0!=(t>>a.SUBSCRIBE_OPTIONS_NL_SHIFT&a.SUBSCRIBE_OPTIONS_NL_MASK),i=0!=(t>>a.SUBSCRIBE_OPTIONS_RAP_SHIFT&a.SUBSCRIBE_OPTIONS_RAP_MASK),r=t>>a.SUBSCRIBE_OPTIONS_RH_SHIFT&a.SUBSCRIBE_OPTIONS_RH_MASK,o={topic:e,qos:n},5===this.settings.protocolVersion&&(o.nl=s,o.rap=i,o.rh=r),c("_parseSubscribe: push subscription `%s` to subscription",o),l.subscriptions.push(o)}}},l.prototype._parseSuback=function(){c("_parseSuback");var e=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},l.prototype._parseUnsubscribe=function(){c("_parseUnsubscribe");var e=this.packet;if(e.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){var n;if(null===(n=this._parseString()))return this._emitError(new Error("Cannot parse topic"));c("_parseUnsubscribe: push topic `%s` to unsubscriptions",n),e.unsubscriptions.push(n)}}},l.prototype._parseUnsuback=function(){c("_parseUnsuback");var e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},l.prototype._parseConfirmation=function(){c("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);var e=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&(e.length>2&&(e.reasonCode=this._parseByte(),c("_parseConfirmation: packet.reasonCode `%d`",e.reasonCode)),e.length>3)){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},l.prototype._parseDisconnect=function(){var e=this.packet;if(c("_parseDisconnect"),5===this.settings.protocolVersion){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return c("_parseDisconnect result: true"),!0},l.prototype._parseAuth=function(){c("_parseAuth");var e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();var t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),c("_parseAuth: result: true"),!0},l.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null===e.messageId?(this._emitError(new Error("Cannot parse messageId")),!1):(c("_parseMessageId: packet.messageId %d",e.messageId),!0)},l.prototype._parseString=function(e){var t,n=this._parseNum(),r=n+this._pos;return-1===n||r>this._list.length||r>this.packet.length?null:(t=this._list.toString("utf8",this._pos,r),this._pos+=n,c("_parseString: result: %s",t),t)},l.prototype._parseStringPair=function(){return c("_parseStringPair"),{name:this._parseString(),value:this._parseString()}},l.prototype._parseBuffer=function(){var e,t=this._parseNum(),n=t+this._pos;return-1===t||n>this._list.length||n>this.packet.length?null:(e=this._list.slice(this._pos,n),this._pos+=t,c("_parseBuffer: result: %o",e),e)},l.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var e=this._list.readUInt16BE(this._pos);return this._pos+=2,c("_parseNum: result: %s",e),e},l.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var e=this._list.readUInt32BE(this._pos);return this._pos+=4,c("_parse4ByteNum: result: %s",e),e},l.prototype._parseVarByteNum=function(e){c("_parseVarByteNum");for(var t,n=0,r=1,i=0,s=!0,o=this._pos?this._pos:0;n<5&&(i+=r*((t=this._list.readUInt8(o+n++))&a.LENGTH_MASK),r*=128,0!=(t&a.LENGTH_FIN_MASK));)if(this._list.length<=n){s=!1;break}return o&&(this._pos+=n),c("_parseVarByteNum: result: %o",s=!!s&&(e?{bytes:n,value:i}:i)),s},l.prototype._parseByte=function(){var e=this._list.readUInt8(this._pos);return this._pos++,c("_parseByte: result: %o",e),e},l.prototype._parseByType=function(e){switch(c("_parseByType: type: %s",e),e){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},l.prototype._parseProperties=function(){c("_parseProperties");for(var e=this._parseVarByteNum(),t=this._pos+e,n={};this._pos<t;){var r=this._parseByte(),i=a.propertiesCodes[r];if(!i)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==i)n[i]?(Array.isArray(n[i])||(n[i]=[n[i]]),n[i].push(this._parseByType(a.propertiesTypes[i]))):n[i]=this._parseByType(a.propertiesTypes[i]);else{n[i]||(n[i]={});var s=this._parseByType(a.propertiesTypes[i]);if(n[i][s.name])if(Array.isArray(n[i][s.name]))n[i][s.name].push(s.value);else{var o=n[i][s.name];n[i][s.name]=[o],n[i][s.name].push(s.value)}else n[i][s.name]=s.value}}return n},l.prototype._newPacket=function(){return c("_newPacket"),this.packet&&(this._list.consume(this.packet.length),c("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),c("_newPacket: new packet"),this.packet=new o,this._pos=0,!0},l.prototype._emitError=function(e){c("_emitError"),this.error=e,this.emit("error",e)},t.exports=l},{"./constants":91,"./packet":95,bl:11,debug:17,events:83,inherits:88}],97:[function(e,t,n){"use strict";var r=e("./constants"),i=e("safe-buffer").Buffer,s=i.allocUnsafe(0),o=i.from([0]),a=e("./numbers"),c=e("process-nextick-args").nextTick,l=e("debug")("mqtt-packet:writeToStream"),u=a.cache,h=a.generateNumber,d=a.generateCache,p=a.genBufVariableByteInt,f=a.generate4ByteBuffer,m=I,g=!0;function y(e,t,n){switch(l("generate called"),t.cork&&(t.cork(),c(v,t)),g&&(g=!1,d()),l("generate: packet.cmd: %s",e.cmd),e.cmd){case"connect":return function(e,t,n){var s=e||{},o=s.protocolId||"MQTT",a=s.protocolVersion||4,c=s.will,l=s.clean,u=s.keepalive||0,h=s.clientId||"",d=s.username,p=s.password,f=s.properties;void 0===l&&(l=!0);var g=0;if(!o||"string"!=typeof o&&!i.isBuffer(o))return t.emit("error",new Error("Invalid protocolId")),!1;if(g+=o.length+2,3!==a&&4!==a&&5!==a)return t.emit("error",new Error("Invalid protocol version")),!1;if(g+=1,"string"!=typeof h&&!i.isBuffer(h)||!h&&4!==a||!h&&!l){if(a<4)return t.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*l==0)return t.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else g+=h.length+2;if("number"!=typeof u||u<0||u>65535||u%1!=0)return t.emit("error",new Error("Invalid keepalive")),!1;if(g+=2,g+=1,5===a){var y=T(t,f);if(!y)return!1;g+=y.length}if(c){if("object"!=typeof c)return t.emit("error",new Error("Invalid will")),!1;if(!c.topic||"string"!=typeof c.topic)return t.emit("error",new Error("Invalid will topic")),!1;if(g+=i.byteLength(c.topic)+2,g+=2,c.payload){if(!(c.payload.length>=0))return t.emit("error",new Error("Invalid will payload")),!1;"string"==typeof c.payload?g+=i.byteLength(c.payload):g+=c.payload.length}var v={};if(5===a){if(!(v=T(t,c.properties)))return!1;g+=v.length}}var b=!1;if(null!=d){if(!U(d))return t.emit("error",new Error("Invalid username")),!1;b=!0,g+=i.byteLength(d)+2}if(null!=p){if(!b)return t.emit("error",new Error("Username is required to use password")),!1;if(!U(p))return t.emit("error",new Error("Invalid password")),!1;g+=O(p)+2}t.write(r.CONNECT_HEADER),w(t,g),C(t,o),t.write(4===a?r.VERSION4:5===a?r.VERSION5:r.VERSION3);var S=0;return S|=null!=d?r.USERNAME_MASK:0,S|=null!=p?r.PASSWORD_MASK:0,S|=c&&c.retain?r.WILL_RETAIN_MASK:0,S|=c&&c.qos?c.qos<<r.WILL_QOS_SHIFT:0,S|=c?r.WILL_FLAG_MASK:0,S|=l?r.CLEAN_SESSION_MASK:0,t.write(i.from([S])),m(t,u),5===a&&y.write(),C(t,h),c&&(5===a&&v.write(),_(t,c.topic),C(t,c.payload)),null!=d&&C(t,d),null!=p&&C(t,p),!0}(e,t);case"connack":return function(e,t,n){var s=n?n.protocolVersion:4,a=e||{},c=5===s?a.reasonCode:a.returnCode,l=a.properties,u=2;if("number"!=typeof c)return t.emit("error",new Error("Invalid return code")),!1;var h=null;if(5===s){if(!(h=T(t,l)))return!1;u+=h.length}return t.write(r.CONNACK_HEADER),w(t,u),t.write(a.sessionPresent?r.SESSIONPRESENT_HEADER:o),t.write(i.from([c])),null!=h&&h.write(),!0}(e,t,n);case"publish":return function(e,t,n){l("publish: packet: %o",e);var o=n?n.protocolVersion:4,a=e||{},c=a.qos||0,u=a.retain?r.RETAIN_MASK:0,h=a.topic,d=a.payload||s,p=a.messageId,f=a.properties,g=0;if("string"==typeof h)g+=i.byteLength(h)+2;else{if(!i.isBuffer(h))return t.emit("error",new Error("Invalid topic")),!1;g+=h.length+2}if(i.isBuffer(d)?g+=d.length:g+=i.byteLength(d),c&&"number"!=typeof p)return t.emit("error",new Error("Invalid messageId")),!1;c&&(g+=2);var y=null;if(5===o){if(!(y=T(t,f)))return!1;g+=y.length}return t.write(r.PUBLISH_HEADER[c][a.dup?1:0][u?1:0]),w(t,g),m(t,O(h)),t.write(h),c>0&&m(t,p),null!=y&&y.write(),l("publish: payload: %o",d),t.write(d)}(e,t,n);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(e,t,n){var s=n?n.protocolVersion:4,o=e||{},a=o.cmd||"puback",c=o.messageId,l=o.dup&&"pubrel"===a?r.DUP_MASK:0,u=0,h=o.reasonCode,d=o.properties,p=5===s?3:2;if("pubrel"===a&&(u=1),"number"!=typeof c)return t.emit("error",new Error("Invalid messageId")),!1;var f=null;if(5===s&&"object"==typeof d){if(!(f=P(t,d,n,p)))return!1;p+=f.length}return t.write(r.ACKS[a][u][l][0]),w(t,p),m(t,c),5===s&&t.write(i.from([h])),null!==f&&f.write(),!0}(e,t,n);case"subscribe":return function(e,t,n){l("subscribe: packet: ");var s=n?n.protocolVersion:4,o=e||{},a=o.dup?r.DUP_MASK:0,c=o.messageId,u=o.subscriptions,h=o.properties,d=0;if("number"!=typeof c)return t.emit("error",new Error("Invalid messageId")),!1;d+=2;var p=null;if(5===s){if(!(p=T(t,h)))return!1;d+=p.length}if("object"!=typeof u||!u.length)return t.emit("error",new Error("Invalid subscriptions")),!1;for(var f=0;f<u.length;f+=1){var g=u[f].topic,y=u[f].qos;if("string"!=typeof g)return t.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof y)return t.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===s){if("boolean"!=typeof(u[f].nl||!1))return t.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if("boolean"!=typeof(u[f].rap||!1))return t.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var v=u[f].rh||0;if("number"!=typeof v||v>2)return t.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}d+=i.byteLength(g)+2+1}l("subscribe: writing to stream: %o",r.SUBSCRIBE_HEADER),t.write(r.SUBSCRIBE_HEADER[1][a?1:0][0]),w(t,d),m(t,c),null!==p&&p.write();for(var b=!0,S=0;S<u.length;S++){var I,k=u[S],C=k.topic,P=k.qos,E=+k.nl,x=+k.rap,O=k.rh;_(t,C),I=r.SUBSCRIBE_OPTIONS_QOS[P],5===s&&(I|=E?r.SUBSCRIBE_OPTIONS_NL:0,I|=x?r.SUBSCRIBE_OPTIONS_RAP:0,I|=O?r.SUBSCRIBE_OPTIONS_RH[O]:0),b=t.write(i.from([I]))}return b}(e,t,n);case"suback":return function(e,t,n){var s=n?n.protocolVersion:4,o=e||{},a=o.messageId,c=o.granted,l=o.properties,u=0;if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;if(u+=2,"object"!=typeof c||!c.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var h=0;h<c.length;h+=1){if("number"!=typeof c[h])return t.emit("error",new Error("Invalid qos vector")),!1;u+=1}var d=null;if(5===s){if(!(d=P(t,l,n,u)))return!1;u+=d.length}return t.write(r.SUBACK_HEADER),w(t,u),m(t,a),null!==d&&d.write(),t.write(i.from(c))}(e,t,n);case"unsubscribe":return function(e,t,n){var s=n?n.protocolVersion:4,o=e||{},a=o.messageId,c=o.dup?r.DUP_MASK:0,l=o.unsubscriptions,u=o.properties,h=0;if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;if(h+=2,"object"!=typeof l||!l.length)return t.emit("error",new Error("Invalid unsubscriptions")),!1;for(var d=0;d<l.length;d+=1){if("string"!=typeof l[d])return t.emit("error",new Error("Invalid unsubscriptions")),!1;h+=i.byteLength(l[d])+2}var p=null;if(5===s){if(!(p=T(t,u)))return!1;h+=p.length}t.write(r.UNSUBSCRIBE_HEADER[1][c?1:0][0]),w(t,h),m(t,a),null!==p&&p.write();for(var f=!0,g=0;g<l.length;g++)f=_(t,l[g]);return f}(e,t,n);case"unsuback":return function(e,t,n){var s=n?n.protocolVersion:4,o=e||{},a=o.messageId,c=o.dup?r.DUP_MASK:0,l=o.granted,u=o.properties,h=o.cmd,d=2;if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;if(5===s){if("object"!=typeof l||!l.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var p=0;p<l.length;p+=1){if("number"!=typeof l[p])return t.emit("error",new Error("Invalid qos vector")),!1;d+=1}}var f=null;if(5===s){if(!(f=P(t,u,n,d)))return!1;d+=f.length}return t.write(r.ACKS[h][0][c][0]),w(t,d),m(t,a),null!==f&&f.write(),5===s&&t.write(i.from(l)),!0}(e,t,n);case"pingreq":case"pingresp":return function(e,t,n){return t.write(r.EMPTY[e.cmd])}(e,t);case"disconnect":return function(e,t,n){var s=n?n.protocolVersion:4,o=e||{},a=o.reasonCode,c=o.properties,l=5===s?1:0,u=null;if(5===s){if(!(u=P(t,c,n,l)))return!1;l+=u.length}return t.write(i.from([r.codes.disconnect<<4])),w(t,l),5===s&&t.write(i.from([a])),null!==u&&u.write(),!0}(e,t,n);case"auth":return function(e,t,n){var s=n?n.protocolVersion:4,o=e||{},a=o.reasonCode,c=o.properties,l=5===s?1:0;5!==s&&t.emit("error",new Error("Invalid mqtt version for auth packet"));var u=P(t,c,n,l);return!!u&&(l+=u.length,t.write(i.from([r.codes.auth<<4])),w(t,l),t.write(i.from([a])),null!==u&&u.write(),!0)}(e,t,n);default:return t.emit("error",new Error("Unknown command")),!1}}function v(e){e.uncork()}Object.defineProperty(y,"cacheNumbers",{get:function(){return m===I},set:function(e){e?(u&&0!==Object.keys(u).length||(g=!0),m=I):(g=!1,m=k)}});var b={};function w(e,t){var n=b[t];n||(n=p(t).data,t<16384&&(b[t]=n)),l("writeVarByteInt: writing to stream: %o",n),e.write(n)}function _(e,t){var n=i.byteLength(t);return m(e,n),l("writeString: %s",t),e.write(t,"utf8")}function S(e,t,n){_(e,t),_(e,n)}function I(e,t){return l("writeNumberCached: number: %d",t),l("writeNumberCached: %o",u[t]),e.write(u[t])}function k(e,t){var n=h(t);return l("writeNumberGenerated: %o",n),e.write(n)}function C(e,t){"string"==typeof t?_(e,t):t?(m(e,t.length),e.write(t)):m(e,0)}function T(e,t){if("object"!=typeof t||null!=t.length)return{length:1,write:function(){x(e,{},0)}};var n=0;function s(t,n){var s=0;switch(r.propertiesTypes[t]){case"byte":if("boolean"!=typeof n)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=2;break;case"int8":if("number"!=typeof n||n<0||n>255)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=2;break;case"binary":if(n&&null===n)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=1+i.byteLength(n)+2;break;case"int16":if("number"!=typeof n||n<0||n>65535)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=3;break;case"int32":if("number"!=typeof n||n<0||n>4294967295)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=5;break;case"var":if("number"!=typeof n||n<0||n>4294967295)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=1+p(n).length;break;case"string":if("string"!=typeof n)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=3+i.byteLength(n.toString());break;case"pair":if("object"!=typeof n)return e.emit("error",new Error("Invalid "+t+": "+n)),!1;s+=Object.getOwnPropertyNames(n).reduce((function(e,t){var r=n[t];return Array.isArray(r)?e+=r.reduce((function(e,n){return e+=3+i.byteLength(t.toString())+2+i.byteLength(n.toString())}),0):e+=3+i.byteLength(t.toString())+2+i.byteLength(n[t].toString()),e}),0);break;default:return e.emit("error",new Error("Invalid property "+t+": "+n)),!1}return s}if(t)for(var o in t){var a=0,c=0,l=t[o];if(Array.isArray(l))for(var u=0;u<l.length;u++){if(!(c=s(o,l[u])))return!1;a+=c}else{if(!(c=s(o,l)))return!1;a=c}if(!a)return!1;n+=a}return{length:p(n).length+n,write:function(){x(e,t,n)}}}function P(e,t,n,r){var i=["reasonString","userProperties"],s=n&&n.properties&&n.properties.maximumPacketSize?n.properties.maximumPacketSize:0,o=T(e,t);if(s)for(;r+o.length>s;){var a=i.shift();if(!a||!t[a])return!1;delete t[a],o=T(e,t)}return o}function E(e,t,n){switch(r.propertiesTypes[t]){case"byte":e.write(i.from([r.properties[t]])),e.write(i.from([+n]));break;case"int8":e.write(i.from([r.properties[t]])),e.write(i.from([n]));break;case"binary":e.write(i.from([r.properties[t]])),C(e,n);break;case"int16":e.write(i.from([r.properties[t]])),m(e,n);break;case"int32":e.write(i.from([r.properties[t]])),function(e,t){var n=f(t);l("write4ByteNumber: %o",n),e.write(n)}(e,n);break;case"var":e.write(i.from([r.properties[t]])),w(e,n);break;case"string":e.write(i.from([r.properties[t]])),_(e,n);break;case"pair":Object.getOwnPropertyNames(n).forEach((function(s){var o=n[s];Array.isArray(o)?o.forEach((function(n){e.write(i.from([r.properties[t]])),S(e,s.toString(),n.toString())})):(e.write(i.from([r.properties[t]])),S(e,s.toString(),o.toString()))}));break;default:return e.emit("error",new Error("Invalid property "+t+" value: "+n)),!1}}function x(e,t,n){for(var r in w(e,n),t)if(t.hasOwnProperty(r)&&null!==t[r]){var i=t[r];if(Array.isArray(i))for(var s=0;s<i.length;s++)E(e,r,i[s]);else E(e,r,i)}}function O(e){return e?e instanceof i?e.length:i.byteLength(e):0}function U(e){return"string"==typeof e||e instanceof i}t.exports=y},{"./constants":91,"./numbers":94,debug:17,"process-nextick-args":100,"safe-buffer":117}],98:[function(e,t,n){var r=1e3,i=6e4,s=60*i,o=24*s;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}t.exports=function(e,t){t=t||{};var n,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===l&&isFinite(e))return t.long?(n=e,(c=Math.abs(n))>=o?a(n,c,o,"day"):c>=s?a(n,c,s,"hour"):c>=i?a(n,c,i,"minute"):c>=r?a(n,c,r,"second"):n+" ms"):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=s?Math.round(e/s)+"h":t>=i?Math.round(e/i)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],99:[function(e,t,n){var r=e("wrappy");function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function s(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}t.exports=r(i),t.exports.strict=r(s),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return s(this)},configurable:!0})}))},{wrappy:138}],100:[function(e,t,n){(function(e){"use strict";void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,n)}));case 3:return e.nextTick((function(){t.call(null,n,r)}));case 4:return e.nextTick((function(){t.call(null,n,r,i)}));default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return e.nextTick((function(){t.apply(null,s)}))}}}:t.exports=e}).call(this,e("_process"))},{_process:101}],101:[function(e,t,n){var r,i,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var l,u=[],h=!1,d=-1;function p(){h&&l&&(h=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!h){var e=c(p);h=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||h||c(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],102:[function(e,n,r){(function(e){!function(t){var i="object"==typeof r&&r&&!r.nodeType&&r,s="object"==typeof n&&n&&!n.nodeType&&n,o="object"==typeof e&&e;o.global!==o&&o.window!==o&&o.self!==o||(t=o);var a,c,l=2147483647,u=/^xn--/,h=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function g(e){throw new RangeError(p[e])}function y(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function v(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+y((e=e.replace(d,".")).split("."),t).join(".")}function b(e){for(var t,n,r=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function w(e){return y(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=m(e)})).join("")}function _(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,n){var r=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;r+=36)e=f(e/35);return f(r+36*e/(e+38))}function I(e){var t,n,r,i,s,o,a,c,u,h,d,p=[],m=e.length,y=0,v=128,b=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&g("not-basic"),p.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(s=y,o=1,a=36;i>=m&&g("invalid-input"),((c=(d=e.charCodeAt(i++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||c>f((l-y)/o))&&g("overflow"),y+=c*o,!(c<(u=a<=b?1:a>=b+26?26:a-b));a+=36)o>f(l/(h=36-u))&&g("overflow"),o*=h;b=S(y-s,t=p.length+1,0==s),f(y/t)>l-v&&g("overflow"),v+=f(y/t),y%=t,p.splice(y++,0,v)}return w(p)}function k(e){var t,n,r,i,s,o,a,c,u,h,d,p,y,v,w,I=[];for(p=(e=b(e)).length,t=128,n=0,s=72,o=0;o<p;++o)(d=e[o])<128&&I.push(m(d));for(r=i=I.length,i&&I.push("-");r<p;){for(a=l,o=0;o<p;++o)(d=e[o])>=t&&d<a&&(a=d);for(a-t>f((l-n)/(y=r+1))&&g("overflow"),n+=(a-t)*y,t=a,o=0;o<p;++o)if((d=e[o])<t&&++n>l&&g("overflow"),d==t){for(c=n,u=36;!(c<(h=u<=s?1:u>=s+26?26:u-s));u+=36)w=c-h,v=36-h,I.push(m(_(h+w%v,0))),c=f(w/v);I.push(m(_(c,0))),s=S(n,y,r==i),n=0,++r}++n,++t}return I.join("")}if(a={version:"1.4.1",ucs2:{decode:b,encode:w},decode:I,encode:k,toASCII:function(e){return v(e,(function(e){return h.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return v(e,(function(e){return u.test(e)?I(e.slice(4).toLowerCase()):e}))}},i&&s)if(n.exports==i)s.exports=a;else for(c in a)a.hasOwnProperty(c)&&(i[c]=a[c]);else t.punycode=a}(this)}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],103:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var a=/\+/g;e=e.split(t);var c=1e3;s&&"number"==typeof s.maxKeys&&(c=s.maxKeys);var l=e.length;c>0&&l>c&&(l=c);for(var u=0;u<l;++u){var h,d,p,f,m=e[u].replace(a,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),r(o,p)?i(o[p])?o[p].push(f):o[p]=[o[p],f]:o[p]=f}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],104:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?s(o(e),(function(o){var a=encodeURIComponent(r(o))+n;return i(e[o])?s(e[o],(function(e){return a+encodeURIComponent(r(e))})).join(t):a+encodeURIComponent(r(e[o]))})).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],105:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":103,"./encode":104}],106:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":107}],107:[function(e,t,n){"use strict";var r=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=h;var s=Object.create(e("core-util-is"));s.inherits=e("inherits");var o=e("./_stream_readable"),a=e("./_stream_writable");s.inherits(h,o);for(var c=i(a.prototype),l=0;l<c.length;l++){var u=c[l];h.prototype[u]||(h.prototype[u]=a.prototype[u])}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},{"./_stream_readable":109,"./_stream_writable":111,"core-util-is":14,inherits:88,"process-nextick-args":100}],108:[function(e,t,n){"use strict";t.exports=s;var r=e("./_stream_transform"),i=Object.create(e("core-util-is"));function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}i.inherits=e("inherits"),i.inherits(s,r),s.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":110,"core-util-is":14,inherits:88}],109:[function(e,n,r){(function(t,r){"use strict";var i=e("process-nextick-args");n.exports=b;var s,o=e("isarray");b.ReadableState=v,e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},c=e("./internal/streams/stream"),l=e("safe-buffer").Buffer,u=r.Uint8Array||function(){},h=Object.create(e("core-util-is"));h.inherits=e("inherits");var d=e("util"),p=void 0;p=d&&d.debuglog?d.debuglog("stream"):function(){};var f,m=e("./internal/streams/BufferList"),g=e("./internal/streams/destroy");h.inherits(b,c);var y=["error","close","destroy","pause","resume"];function v(t,n){t=t||{};var r=n instanceof(s=s||e("./_stream_duplex"));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,o=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=e("string_decoder/").StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function b(t){if(s=s||e("./_stream_duplex"),!(this instanceof b))return new b(t);this._readableState=new v(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function w(e,t,n,r,i){var s,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,I(e)}}(e,o)):(i||(s=function(e,t){var n,r;return r=t,l.isBuffer(r)||r instanceof u||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?_(e,o,t,!1):C(e,o)):_(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function _(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&I(e)),C(e,t)}function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function I(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(p("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e))}function k(e){p("emit readable"),e.emit("readable"),x(e)}function C(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(T,e,t))}function T(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(p("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function P(e){p("readable nexttick read 0"),e.read(0)}function E(e,t){t.reading||(p("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(p("flow",t.flowing);t.flowing&&null!==e.read(););}function O(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?i+=s:i+=s.slice(0,e),0==(e-=o)){o===s.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=l.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0==(e-=o)){o===s.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=s.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function U(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(A,t,e))}function A(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function R(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=l.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},b.prototype.unshift=function(e){return w(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){return f||(f=e("string_decoder/").StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this},b.prototype.read=function(e){p("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):I(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&U(this),null;var r,i=t.needReadable;return p("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&p("length less than watermark",i=!0),t.ended||t.reading?p("reading or ended",i=!1):i&&(p("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(n,t))),null===(r=e>0?O(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&U(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,n){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,p("pipe count=%d opts=%j",s.pipesCount,n);var c=n&&!1===n.end||e===t.stdout||e===t.stderr?b:u;function l(t,n){p("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,p("cleanup"),e.removeListener("close",y),e.removeListener("finish",v),e.removeListener("drain",h),e.removeListener("error",g),e.removeListener("unpipe",l),r.removeListener("end",u),r.removeListener("end",b),r.removeListener("data",m),d=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function u(){p("onend"),e.end()}s.endEmitted?i.nextTick(c):r.once("end",c),e.on("unpipe",l);var h=function(e){return function(){var t=e._readableState;p("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,x(e))}}(r);e.on("drain",h);var d=!1,f=!1;function m(t){p("ondata"),f=!1,!1!==e.write(t)||f||((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==R(s.pipes,e))&&!d&&(p("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,f=!0),r.pause())}function g(t){p("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",v),b()}function v(){p("onfinish"),e.removeListener("close",y),b()}function b(){p("unpipe"),r.unpipe(e)}return r.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",v),e.emit("pipe",r),s.flowing||(p("pipe resume"),r.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,n);return this}var o=R(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},b.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&I(this):i.nextTick(P,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(p("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(E,e,t))}(this,e)),this},b.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(p("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){p("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<y.length;s++)e.on(y[s],this.emit.bind(this,y[s]));return this._read=function(t){p("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=O}).call(this,e("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":107,"./internal/streams/BufferList":112,"./internal/streams/destroy":113,"./internal/streams/stream":114,_process:101,"core-util-is":14,events:83,inherits:88,isarray:90,"process-nextick-args":100,"safe-buffer":117,"string_decoder/":119,util:12}],110:[function(e,t,n){"use strict";t.exports=o;var r=e("./_stream_duplex"),i=Object.create(e("core-util-is"));function s(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},{"./_stream_duplex":107,"core-util-is":14,inherits:88}],111:[function(e,n,r){(function(t,r,i){"use strict";var s=e("process-nextick-args");function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}n.exports=v;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?i:s.nextTick;v.WritableState=y;var l=Object.create(e("core-util-is"));l.inherits=e("inherits");var u,h={deprecate:e("util-deprecate")},d=e("./internal/streams/stream"),p=e("safe-buffer").Buffer,f=r.Uint8Array||function(){},m=e("./internal/streams/destroy");function g(){}function y(t,n){a=a||e("./_stream_duplex"),t=t||{};var r=n instanceof a;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,l=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(l||0===l)?l:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===t.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(s.nextTick(i,r),s.nextTick(k,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),k(e,t))}(e,n,r,t,i);else{var o=S(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?c(w,e,n,o,i):w(e,n,o,i)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function v(t){if(a=a||e("./_stream_duplex"),!(u.call(v,this)||this instanceof a))return new v(t);this._writableState=new y(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),d.call(this)}function b(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function w(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),k(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,b(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,h=n.callback;if(b(e,t,!1,t.objectMode?1:l.length,l,u,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function I(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),k(e,t)}))}function k(e,t){var n=S(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,s.nextTick(I,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}l.inherits(v,d),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===v&&e&&e._writableState instanceof y}})):u=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,a=!i.objectMode&&(r=e,p.isBuffer(r)||r instanceof f);return a&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=g),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),s.nextTick(t,n)}(this,n):(a||function(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),s.nextTick(r,o),i=!1),i}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,s){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,a,r,i,s);return c}(this,i,a,e,t,n)),o},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,k(e,t),n&&(t.finished?s.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=m.destroy,v.prototype._undestroy=m.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,e("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./_stream_duplex":107,"./internal/streams/destroy":113,"./internal/streams/stream":114,_process:101,"core-util-is":14,inherits:88,"process-nextick-args":100,"safe-buffer":117,timers:120,"util-deprecate":134}],112:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,s=r.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=s,i=a,t.copy(n,i),a+=o.data.length,o=o.next;return s},e}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":117,util:12}],113:[function(e,t,n){"use strict";var r=e("process-nextick-args");function i(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":100}],114:[function(e,t,n){t.exports=e("events").EventEmitter},{events:83}],115:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":107,"./lib/_stream_passthrough.js":108,"./lib/_stream_readable.js":109,"./lib/_stream_transform.js":110,"./lib/_stream_writable.js":111}],116:[function(e,t,n){"use strict";function r(e,t,n){var r=this;this._callback=e,this._args=n,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e||(e=r._interval),r._interval&&clearInterval(r._interval),r._interval=setInterval(r._callback,e,r._args)},this.clear=function(){r._interval&&(clearInterval(r._interval),r._interval=void 0)},this.destroy=function(){r._interval&&clearInterval(r._interval),r._callback=void 0,r._interval=void 0,r._args=void 0}}t.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new r(arguments[0],arguments[1],e)}},{}],117:[function(e,t,n){var r=e("buffer"),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(s(r,n),n.Buffer=o),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:13}],118:[function(e,t,n){t.exports=function(e){var t,n=e._readableState;return n?n.objectMode||"number"==typeof e._duplexState?e.read():e.read((t=n).buffer.length?t.buffer.head?t.buffer.head.data.length:t.buffer[0].length:t.length):null}},{}],119:[function(e,t,n){"use strict";var r=e("safe-buffer").Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=h,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}n.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},s.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=o(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=o(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":117}],120:[function(e,t,n){(function(t,r){var i=e("process/browser.js").nextTick,s=Function.prototype.apply,o=Array.prototype.slice,a={},c=0;function l(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new l(s.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new l(s.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},l.prototype.unref=l.prototype.ref=function(){},l.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=c++,r=!(arguments.length<2)&&o.call(arguments,1);return a[t]=!0,i((function(){a[t]&&(r?e.apply(null,r):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof r?r:function(e){delete a[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":101,timers:120}],121:[function(e,t,n){"use strict";var r=e("../prototype/is");t.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!r(e)}},{"../prototype/is":128}],122:[function(e,t,n){"use strict";var r=e("../value/is"),i=e("../object/is"),s=e("../string/coerce"),o=e("./to-short-string"),a=function(e,t){return e.replace("%v",o(t))};t.exports=function(e,t,n){if(!i(n))throw new TypeError(a(t,e));if(!r(e)){if("default"in n)return n.default;if(n.isOptional)return null}var o=s(n.errorMessage);throw r(o)||(o=t),new TypeError(a(o,e))}},{"../object/is":125,"../string/coerce":129,"../value/is":131,"./to-short-string":124}],123:[function(e,t,n){"use strict";t.exports=function(e){try{return e.toString()}catch(t){try{return String(e)}catch(e){return null}}}},{}],124:[function(e,t,n){"use strict";var r=e("./safe-to-string"),i=/[\n\r\u2028\u2029]/g;t.exports=function(e){var t=r(e);return null===t?"<Non-coercible to string value>":(t.length>100&&(t=t.slice(0,99)+"\u2026"),t=t.replace(i,(function(e){switch(e){case"\n":return"\\n";case"\r":return"\\r";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw new Error("Unexpected character")}})))}},{"./safe-to-string":123}],125:[function(e,t,n){"use strict";var r=e("../value/is"),i={object:!0,function:!0,undefined:!0};t.exports=function(e){return!!r(e)&&hasOwnProperty.call(i,typeof e)}},{"../value/is":131}],126:[function(e,t,n){"use strict";var r=e("../lib/resolve-exception"),i=e("./is");t.exports=function(e){return i(e)?e:r(e,"%v is not a plain function",arguments[1])}},{"../lib/resolve-exception":122,"./is":127}],127:[function(e,t,n){"use strict";var r=e("../function/is"),i=/^\s*class[\s{/}]/,s=Function.prototype.toString;t.exports=function(e){return!!r(e)&&!i.test(s.call(e))}},{"../function/is":121}],128:[function(e,t,n){"use strict";var r=e("../object/is");t.exports=function(e){if(!r(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},{"../object/is":125}],129:[function(e,t,n){"use strict";var r=e("../value/is"),i=e("../object/is"),s=Object.prototype.toString;t.exports=function(e){if(!r(e))return null;if(i(e)){var t=e.toString;if("function"!=typeof t)return null;if(t===s)return null}try{return""+e}catch(e){return null}}},{"../object/is":125,"../value/is":131}],130:[function(e,t,n){"use strict";var r=e("../lib/resolve-exception"),i=e("./is");t.exports=function(e){return i(e)?e:r(e,"Cannot use %v",arguments[1])}},{"../lib/resolve-exception":122,"./is":131}],131:[function(e,t,n){"use strict";t.exports=function(e){return null!=e}},{}],132:[function(e,t,n){"use strict";var r=e("punycode"),i=e("./util");function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=b,n.resolve=function(e,t){return b(e,!1,!0).resolve(t)},n.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},n.format=function(e){return i.isString(e)&&(e=b(e)),e instanceof s?e.format():s.prototype.format.call(e)},n.Url=s;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(l),h=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=e("querystring");function b(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;return r.parse(e,t,n),r}s.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),a=-1!==s&&s<e.indexOf("#")?"?":"#",l=e.split(a);l[0]=l[0].replace(/\\/g,"/");var b=e=l.join(a);if(b=b.trim(),!n&&1===e.split("#").length){var w=c.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var _=o.exec(b);if(_){var S=(_=_[0]).toLowerCase();this.protocol=S,b=b.substr(_.length)}if(n||_||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var I="//"===b.substr(0,2);!I||_&&g[_]||(b=b.substr(2),this.slashes=!0)}if(!g[_]&&(I||_&&!y[_])){for(var k,C,T=-1,P=0;P<d.length;P++)-1!==(E=b.indexOf(d[P]))&&(-1===T||E<T)&&(T=E);for(-1!==(C=-1===T?b.lastIndexOf("@"):b.lastIndexOf("@",T))&&(k=b.slice(0,C),b=b.slice(C+1),this.auth=decodeURIComponent(k)),T=-1,P=0;P<h.length;P++){var E;-1!==(E=b.indexOf(h[P]))&&(-1===T||E<T)&&(T=E)}-1===T&&(T=b.length),this.host=b.slice(0,T),b=b.slice(T),this.parseHost(),this.hostname=this.hostname||"";var x="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!x)for(var O=this.hostname.split(/\./),U=(P=0,O.length);P<U;P++){var A=O[P];if(A&&!A.match(p)){for(var R="",M=0,j=A.length;M<j;M++)A.charCodeAt(M)>127?R+="x":R+=A[M];if(!R.match(p)){var D=O.slice(0,P),L=O.slice(P+1),N=A.match(f);N&&(D.push(N[1]),L.unshift(N[2])),L.length&&(b="/"+L.join(".")+b),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+B,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[S])for(P=0,U=u.length;P<U;P++){var V=u[P];if(-1!==b.indexOf(V)){var F=encodeURIComponent(V);F===V&&(F=escape(V)),b=b.split(V).join(F)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var H=b.indexOf("?");if(-1!==H?(this.search=b.substr(H),this.query=b.substr(H+1),t&&(this.query=v.parse(this.query)),b=b.slice(0,H)):t&&(this.search="",this.query={}),b&&(this.pathname=b),y[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=!1,o="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==s?(s="//"+(s||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+s+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},s.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,!1,!0),e=t}for(var n=new s,r=Object.keys(this),o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),l=0;l<c.length;l++){var u=c[l];"protocol"!==u&&(n[u]=e[u])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",v=n.search||"";n.path=m+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),_=w||b||n.host&&e.pathname,S=_,I=n.pathname&&n.pathname.split("/")||[],k=(f=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(k&&(n.hostname="",n.port=null,n.host&&(""===I[0]?I[0]=n.host:I.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),_=_&&(""===f[0]||""===I[0])),w)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,I=f;else if(f.length)I||(I=[]),I.pop(),I=I.concat(f),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search))return k&&(n.hostname=n.host=I.shift(),(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.host=n.hostname=x.shift())),n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!I.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var C=I.slice(-1)[0],T=(n.host||e.host||I.length>1)&&("."===C||".."===C)||""===C,P=0,E=I.length;E>=0;E--)"."===(C=I[E])?I.splice(E,1):".."===C?(I.splice(E,1),P++):P&&(I.splice(E,1),P--);if(!_&&!S)for(;P--;P)I.unshift("..");!_||""===I[0]||I[0]&&"/"===I[0].charAt(0)||I.unshift(""),T&&"/"!==I.join("/").substr(-1)&&I.push("");var x,O=""===I[0]||I[0]&&"/"===I[0].charAt(0);return k&&(n.hostname=n.host=O?"":I.length?I.shift():"",(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.host=n.hostname=x.shift())),(_=_||n.host&&I.length)&&!O&&I.unshift(""),I.length?n.pathname=I.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},s.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":133,punycode:102,querystring:105}],133:[function(e,t,n){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],134:[function(e,n,r){(function(e){function t(t){try{if(!e.localStorage)return!1}catch(e){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}n.exports=function(e,n){if(t("noDeprecation"))return e;var r=!1;return function(){if(!r){if(t("throwDeprecation"))throw new Error(n);t("traceDeprecation")?console.trace(n):console.warn(n),r=!0}return e.apply(this,arguments)}}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],135:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],136:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],137:[function(e,n,r){(function(t,n){var i=/%[sdj%]/g;r.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,s=r.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),c=r[n];n<s;c=r[++n])m(c)||!w(c)?o+=" "+c:o+=" "+a(c);return o},r.deprecate=function(e,i){if(v(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return function(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}};var s,o={};function a(e,t){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(t)?n.showHidden=t:t&&r._extend(n,t),v(n.showHidden)&&(n.showHidden=!1),v(n.depth)&&(n.depth=2),v(n.colors)&&(n.colors=!1),v(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),u(n,e,n.depth)}function c(e,t){var n=a.styles[t];return n?"\x1b["+a.colors[n][0]+"m"+e+"\x1b["+a.colors[n][1]+"m":e}function l(e,t){return e}function u(e,t,n){if(e.customInspect&&t&&I(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return y(i)||(i=u(e,i,n)),i}var s=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(s)return s;var o=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),S(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(t);if(0===o.length){if(I(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(_(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return h(t)}var l,w="",k=!1,C=["{","}"];return p(t)&&(k=!0,C=["[","]"]),I(t)&&(w=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(w=" "+RegExp.prototype.toString.call(t)),_(t)&&(w=" "+Date.prototype.toUTCString.call(t)),S(t)&&(w=" "+h(t)),0!==o.length||k&&0!=t.length?n<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=k?function(e,t,n,r,i){for(var s=[],o=0,a=t.length;o<a;++o)E(t,String(o))?s.push(d(e,t,n,r,String(o),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(d(e,t,n,r,i,!0))})),s}(e,t,n,a,o):o.map((function(r){return d(e,t,n,a,r,k)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,w,C)):C[0]+w+C[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i,s){var o,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),E(r,i)||(o="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=m(n)?u(e,c.value,null):u(e,c.value,n-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),v(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function p(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function b(e){return w(e)&&"[object RegExp]"===k(e)}function w(e){return"object"==typeof e&&null!==e}function _(e){return w(e)&&"[object Date]"===k(e)}function S(e){return w(e)&&("[object Error]"===k(e)||e instanceof Error)}function I(e){return"function"==typeof e}function k(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}r.debuglog=function(e){if(v(s)&&(s=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(s)){var n=t.pid;o[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else o[e]=function(){};return o[e]},r.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=p,r.isBoolean=f,r.isNull=m,r.isNullOrUndefined=function(e){return null==e},r.isNumber=g,r.isString=y,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=v,r.isRegExp=b,r.isObject=w,r.isDate=_,r.isError=S,r.isFunction=I,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),T[e.getMonth()],t].join(" ")}function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.log=function(){console.log("%s - %s",P(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":136,_process:101,inherits:135}],138:[function(e,t,n){t.exports=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r;function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(e){r[e]=i[e]})),r}}},{}],139:[function(e,t,n){"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],140:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}]},{},[9])(9)}).call(this,n(3))}])},e.exports=r()},function(e,t,n){var r;!function(i,s){"use strict";var o="model",a="name",c="type",l="vendor",u="version",h="mobile",d="tablet",p="smarttv",f=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},m=function(e,t){return"string"==typeof e&&-1!==g(t).indexOf(g(e))},g=function(e){return e.toLowerCase()},y=function(e,t){if("string"==typeof e)return e=e.replace(/^\s\s*/,""),void 0===t?e:e.substring(0,350)},v=function(e,t){for(var n,r,i,s,o,a,c=0;c<t.length&&!o;){var l=t[c],u=t[c+1];for(n=r=0;n<l.length&&!o&&l[n];)if(o=l[n++].exec(e))for(i=0;i<u.length;i++)a=o[++r],"object"==typeof(s=u[i])&&s.length>0?2===s.length?"function"==typeof s[1]?this[s[0]]=s[1].call(this,a):this[s[0]]=s[1]:3===s.length?"function"!=typeof s[1]||s[1].exec&&s[1].test?this[s[0]]=a?a.replace(s[1],s[2]):void 0:this[s[0]]=a?s[1].call(this,a,s[2]):void 0:4===s.length&&(this[s[0]]=a?s[3].call(this,a.replace(s[1],s[2])):void 0):this[s]=a||void 0;c+=2}},b=function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(m(t[n][r],e))return"?"===n?void 0:n}else if(m(t[n],e))return"?"===n?void 0:n;return e},w={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[a,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[a,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[a,u],[/opios[\/ ]+([\w\.]+)/i],[u,[a,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[u,[a,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[a,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[a,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[a,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[a,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[a,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[a,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[u,[a,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[a,/(.+)/,"$1 Secure Browser"],u],[/\bfocus\/([\w\.]+)/i],[u,[a,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[u,[a,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[a,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[a,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[a,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[a,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[u,[a,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[a,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[a,/(.+)/,"$1 Browser"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[a,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[a],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[a,"Facebook"],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[a,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[a,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[u,[a,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[a,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[a,"Chrome WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[a,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[a,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,a],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[a,[u,b,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[a,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[a,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[a,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[a,u],[/(cobalt)\/([\w\.]+)/i],[a,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",g]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",g]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",g]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[o,[l,"Samsung"],[c,d]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[o,[l,"Samsung"],[c,h]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[o,[l,"Apple"],[c,h]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[o,[l,"Apple"],[c,d]],[/(macintosh);/i],[o,[l,"Apple"]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[o,[l,"Sharp"],[c,h]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[o,[l,"Huawei"],[c,d]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[o,[l,"Huawei"],[c,h]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[o,/_/g," "],[l,"Xiaomi"],[c,h]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[o,/_/g," "],[l,"Xiaomi"],[c,d]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[o,[l,"OPPO"],[c,h]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[o,[l,"Vivo"],[c,h]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[o,[l,"Realme"],[c,h]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[o,[l,"Motorola"],[c,h]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[o,[l,"Motorola"],[c,d]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[o,[l,"LG"],[c,d]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[o,[l,"LG"],[c,h]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[o,[l,"Lenovo"],[c,d]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[o,/_/g," "],[l,"Nokia"],[c,h]],[/(pixel c)\b/i],[o,[l,"Google"],[c,d]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[o,[l,"Google"],[c,h]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[o,[l,"Sony"],[c,h]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[o,"Xperia Tablet"],[l,"Sony"],[c,d]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[o,[l,"OnePlus"],[c,h]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[o,[l,"Amazon"],[c,d]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[o,/(.+)/g,"Fire Phone $1"],[l,"Amazon"],[c,h]],[/(playbook);[-\w\),; ]+(rim)/i],[o,l,[c,d]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[o,[l,"BlackBerry"],[c,h]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[o,[l,"ASUS"],[c,d]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[o,[l,"ASUS"],[c,h]],[/(nexus 9)/i],[o,[l,"HTC"],[c,d]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l,[o,/_/g," "],[c,h]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[o,[l,"Acer"],[c,d]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[o,[l,"Meizu"],[c,h]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l,o,[c,h]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l,o,[c,d]],[/(surface duo)/i],[o,[l,"Microsoft"],[c,d]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[o,[l,"Fairphone"],[c,h]],[/(u304aa)/i],[o,[l,"AT&T"],[c,h]],[/\bsie-(\w*)/i],[o,[l,"Siemens"],[c,h]],[/\b(rct\w+) b/i],[o,[l,"RCA"],[c,d]],[/\b(venue[\d ]{2,7}) b/i],[o,[l,"Dell"],[c,d]],[/\b(q(?:mv|ta)\w+) b/i],[o,[l,"Verizon"],[c,d]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[o,[l,"Barnes & Noble"],[c,d]],[/\b(tm\d{3}\w+) b/i],[o,[l,"NuVision"],[c,d]],[/\b(k88) b/i],[o,[l,"ZTE"],[c,d]],[/\b(nx\d{3}j) b/i],[o,[l,"ZTE"],[c,h]],[/\b(gen\d{3}) b.+49h/i],[o,[l,"Swiss"],[c,h]],[/\b(zur\d{3}) b/i],[o,[l,"Swiss"],[c,d]],[/\b((zeki)?tb.*\b) b/i],[o,[l,"Zeki"],[c,d]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l,"Dragon Touch"],o,[c,d]],[/\b(ns-?\w{0,9}) b/i],[o,[l,"Insignia"],[c,d]],[/\b((nxa|next)-?\w{0,9}) b/i],[o,[l,"NextBook"],[c,d]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l,"Voice"],o,[c,h]],[/\b(lvtel\-)?(v1[12]) b/i],[[l,"LvTel"],o,[c,h]],[/\b(ph-1) /i],[o,[l,"Essential"],[c,h]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[o,[l,"Envizen"],[c,d]],[/\b(trio[-\w\. ]+) b/i],[o,[l,"MachSpeed"],[c,d]],[/\btu_(1491) b/i],[o,[l,"Rotor"],[c,d]],[/(shield[\w ]+) b/i],[o,[l,"Nvidia"],[c,d]],[/(sprint) (\w+)/i],[l,o,[c,h]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[l,"Microsoft"],[c,h]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[o,[l,"Zebra"],[c,d]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[o,[l,"Zebra"],[c,h]],[/smart-tv.+(samsung)/i],[l,[c,p]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[l,"Samsung"],[c,p]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l,"LG"],[c,p]],[/(apple) ?tv/i],[l,[o,"Apple TV"],[c,p]],[/crkey/i],[[o,"Chromecast"],[l,"Google"],[c,p]],[/droid.+aft(\w)( bui|\))/i],[o,[l,"Amazon"],[c,p]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[o,[l,"Sharp"],[c,p]],[/(bravia[\w ]+)( bui|\))/i],[o,[l,"Sony"],[c,p]],[/(mitv-\w{5}) bui/i],[o,[l,"Xiaomi"],[c,p]],[/Hbbtv.*(technisat) (.*);/i],[l,o,[c,p]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l,y],[o,y],[c,p]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[c,p]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l,o,[c,"console"]],[/droid.+; (shield) bui/i],[o,[l,"Nvidia"],[c,"console"]],[/(playstation [345portablevi]+)/i],[o,[l,"Sony"],[c,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[o,[l,"Microsoft"],[c,"console"]],[/((pebble))app/i],[l,o,[c,"wearable"]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[o,[l,"Apple"],[c,"wearable"]],[/droid.+; (glass) \d/i],[o,[l,"Google"],[c,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[o,[l,"Zebra"],[c,"wearable"]],[/(quest( 2| pro)?)/i],[o,[l,"Facebook"],[c,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l,[c,"embedded"]],[/(aeobc)\b/i],[o,[l,"Amazon"],[c,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[o,[c,h]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[o,[c,d]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[c,d]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[c,h]],[/(android[-\w\. ]{0,9});.+buil/i],[o,[l,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[a,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[a,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[a,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,a]],os:[[/microsoft (windows) (vista|xp)/i],[a,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[a,[u,b,w]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[a,"Windows"],[u,b,w]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[a,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[a,"Mac OS"],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,a],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[a,u],[/\(bb(10);/i],[u,[a,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[a,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[a,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[a,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[a,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[a,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[a,"Chromium OS"],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[a,u],[/(sunos) ?([\w\.\d]*)/i],[[a,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[a,u]]},S=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof S))return new S(e,t).getResult();var n=void 0!==i&&i.navigator?i.navigator:void 0,r=e||(n&&n.userAgent?n.userAgent:""),s=n&&n.userAgentData?n.userAgentData:void 0,l=t?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(_,t):_,p=n&&n.userAgent==r;return this.getBrowser=function(){var e,t={};return t[a]=void 0,t[u]=void 0,v.call(t,r,l.browser),t.major="string"==typeof(e=t[u])?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0,p&&n&&n.brave&&"function"==typeof n.brave.isBrave&&(t[a]="Brave"),t},this.getCPU=function(){var e={architecture:void 0};return v.call(e,r,l.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return v.call(e,r,l.device),p&&!e[c]&&s&&s.mobile&&(e[c]=h),p&&"Macintosh"==e[o]&&n&&void 0!==n.standalone&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[o]="iPad",e[c]=d),e},this.getEngine=function(){var e={name:void 0,version:void 0};return v.call(e,r,l.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return v.call(e,r,l.os),p&&!e[a]&&s&&"Unknown"!=s.platform&&(e[a]=s.platform.replace(/chrome os/i,"Chromium OS").replace(/macos/i,"Mac OS")),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r="string"==typeof e&&e.length>350?y(e,350):e,this},this.setUA(r),this};S.VERSION="1.0.35",S.BROWSER=f([a,u,"major"]),S.CPU=f(["architecture"]),S.DEVICE=f([o,l,c,"console",h,p,d,"wearable","embedded"]),S.ENGINE=S.OS=f([a,u]),void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=S),t.UAParser=S):n(20)?void 0===(r=function(){return S}.call(t,n,t,e))||(e.exports=r):void 0!==i&&(i.UAParser=S);var I=void 0!==i&&(i.jQuery||i.Zepto);if(I&&!I.ua){var k=new S;I.ua=k.getResult(),I.ua.get=function(){return k.getUA()},I.ua.set=function(e){k.setUA(e);var t=k.getResult();for(var n in t)I.ua[n]=t[n]}}}("object"==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){t.Interop=n(22)},function(e,t,n){"use strict";var r=n(23),i=n(27);function s(){this.cache={mlB2UMap:{},mlU2BMap:{}}}e.exports=s,s.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},s.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},s.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=r.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},s.prototype.toPlanB=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Unified Plan."),e;for(var i=e.sdp,s=!1,o=0;o<n.media.length;o++){n.media[o].rtp.forEach((function(e){if("NULL"===e.codec){s=!0;var n=r.parse(t.cache.offer);e.codec=n.media[o].rtp[0].codec}}))}s&&(i=r.write(n)),this.cache[e.type]=i;var a=n.media;n.media=[];var c={},l=[];a.forEach((function(e){if(("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");if(void 0!==c[e.type]&&"inactive"!==c[e.type].direction||(c[e.type]=e),e.protocol!=c[e.type].protocol)throw new Error("Cannot convert to Plan B because m-lines have different protocols and this library does not have support for that");if(e.payloads!=c[e.type].payloads)throw new Error("Cannot convert to Plan B because m-lines have different payloads and this library does not have support for that")})),a.forEach((function(e){if("application"===e.type)return n.media.push(e),void l.push(e.mid);"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(t){"object"!=typeof c[e.type].sources&&(c[e.type].sources={}),c[e.type].sources[t]=e.sources[t],void 0!==e.msid&&(c[e.type].sources[t].msid=e.msid)})),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==c[e.type].ssrcGroups&&Array.isArray(c[e.type].ssrcGroups)||(c[e.type].ssrcGroups=[]),c[e.type].ssrcGroups=c[e.type].ssrcGroups.concat(e.ssrcGroups)),c[e.type]===e&&(e.mid=e.type,delete e.bundleOnly,delete e.msid,e.type==a[0].type?(l.unshift(e.type),n.media.unshift(e)):(l.push(e.type),n.media.push(e)))})),void 0!==n.groups&&n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=l.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var u=r.write(n);return new RTCSessionDescription({type:e.type,sdp:u})},s.prototype.toUnifiedPlan=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Plan B."),e;var s=[];n.media.forEach((function(e){s.push(e.mid)}));var o,a,c=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(c=n.groups.every((function(e){return"BUNDLE"!==e.type||i.apply(e.mids.sort(),[s.sort()])}))),!c){var l=!1;if(n.media.forEach((function(e){"inactive"!==e.direction&&(l=!0)})),l)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.")}if("answer"===e.type)o="offer";else{if("offer"!==e.type)throw new Error("Type '"+e.type+"' not supported.");o="answer"}void 0!==this.cache[o]&&(a=r.parse(this.cache[o]));var u,h,d,p,f={audio:{},video:{}},m={},g=0,y=0,v={},b={},w={},_={};if(n.media.forEach((function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"!==n.type){var r=n.sources,i=n.ssrcGroups,s=n.port;if(void 0!==n.candidates&&(u=void 0!==u?u.concat(n.candidates):n.candidates),void 0!==h&&void 0!==n.iceUfrag&&h!=n.iceUfrag)throw new Error("Only BUNDLE supported, iceUfrag must be the same for all m-lines.\n\tLast iceUfrag: "+h+"\n\tNew iceUfrag: "+n.iceUfrag);if(void 0!==n.iceUfrag&&(h=n.iceUfrag),void 0!==d&&void 0!==n.icePwd&&d!=n.icePwd)throw new Error("Only BUNDLE supported, icePwd must be the same for all m-lines.\n\tLast icePwd: "+d+"\n\tNew icePwd: "+n.icePwd);if(void 0!==n.icePwd&&(d=n.icePwd),void 0!==p&&void 0!==n.fingerprint&&(p.type!=n.fingerprint.type||p.hash!=n.fingerprint.hash))throw new Error("Only BUNDLE supported, fingerprint must be the same for all m-lines.\n\tLast fingerprint: "+JSON.stringify(p)+"\n\tNew fingerprint: "+JSON.stringify(n.fingerprint));void 0!==n.fingerprint&&(p=n.fingerprint),b[n.type]=n.payloads,w[n.type]=n.rtcpFb,_[n.type]=n.rtp;var o={};void 0!==i&&Array.isArray(i)&&i.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach((function(t){void 0===o[t]&&(o[t]=[]),o[t].push(e)}))}));var c={};if("object"==typeof r)delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid,Object.keys(r).forEach((function(i){var l;"offer"!==e.type||r[i].msid?(void 0!==o[i]&&Array.isArray(o[i])&&o[i].some((function(e){return e.ssrcs.some((function(e){if("object"==typeof c[e])return l=c[e],!0}))})),"object"==typeof l?(l.sources[i]=r[i],delete r[i].msid):(l=Object.create(n),c[i]=l,void 0!==r[i].msid&&(l.msid=r[i].msid,delete r[i].msid),l.sources={},l.sources[i]=r[i],l.ssrcGroups=o[i],void 0!==a&&void 0!==a.media&&Array.isArray(a.media)&&a.media.forEach((function(e){"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(t){t===i&&(l.mid=e.mid)}))})),void 0===l.mid&&(l.mid=[n.type,"-",i].join("")),l.candidates=u,l.iceUfrag=h,l.icePwd=d,l.fingerprint=p,l.port=s,m[l.mid]=l,v[y]=l.sources,t.cache.mlU2BMap[y]=g,void 0===t.cache.mlB2UMap[g]&&(t.cache.mlB2UMap[g]=y),y++)):f[n.type][i]=r[i]}));else{var l=n;l.candidates=u,l.iceUfrag=h,l.icePwd=d,l.fingerprint=p,l.port=s,m[l.mid]=l,t.cache.mlU2BMap[y]=g,void 0===t.cache.mlB2UMap[g]&&(t.cache.mlB2UMap[g]=y)}g++}else m[n.mid]=n})),n.media=[],s=[],"answer"===e.type)for(var S=0;S<a.media.length;S++){var I=a.media[S];delete I.msid,delete I.sources,delete I.ssrcGroups,void 0===v[S]?I.direction&&"sendrecv"!==I.direction?"sendonly"===I.direction&&(I.direction="inactive"):I.direction="recvonly":I.direction&&"sendrecv"!==I.direction?"recvonly"===I.direction&&(I.direction="sendonly"):I.direction="sendrecv",I.sources=v[S],I.candidates=u,I.iceUfrag=h,I.icePwd=d,I.fingerprint=p,I.rtp=_[I.type],I.payloads=b[I.type],I.rtcpFb=w[I.type],n.media.push(I),"string"==typeof I.mid&&s.push(I.mid)}else void 0!==a&&void 0!==a.media&&Array.isArray(a.media)&&a.media.forEach((function(e){s.push(e.mid),void 0!==m[e.mid]?n.media.push(m[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="sendonly"),e.direction&&"recvonly"!==e.direction||(e.direction="inactive"),function(e){void 0!==e.setup&&("active"===e.setup?e.setup="passive":"passive"===e.setup&&(e.setup="active"))}(e),n.media.push(e))})),Object.keys(m).forEach((function(e){if(-1===s.indexOf(e))if(s.push(e),"recvonly"===m[e].direction){var t=!1;n.media.some((function(n){if(("sendrecv"===n.direction||"sendonly"===n.direction)&&n.type===m[e].type)return Object.keys(m[e].sources).forEach((function(t){n.sources[t]=m[e].sources[t]})),t=!0,!0})),t||n.media.push(m[e])}else n.media.push(m[e])}));["audio","video"].forEach((function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(f[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var s=n.media[r];Object.keys(f[e]).forEach((function(t){s.sources&&s.sources[t]&&console.warn("Replacing an existing SSRC."),s.sources||(s.sources={}),s.sources[t]=f[e][t]}))}}})),void 0!==n.groups&&n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=s.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var k=r.write(n);return this.cache[e.type]=k,new RTCSessionDescription({type:e.type,sdp:k})}},function(e,t,n){var r=n(24);t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach((function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach((function(t){var n=e.sources[t];Object.keys(n).forEach((function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})}))})),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))}))})),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach((function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))})),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach((function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value})),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))}))})),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach((function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))})),t}},function(e,t,n){var r=n(25),i=n(26);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var s=0;s<n.length;s+=1)null!=e[s+1]&&(t[n[s]]=r(e[s+1]))}(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=n(10),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var c=s[t][a];if(c.reg.test(o))return i(c,r,o)}})),t.media=n,t};var a=function(e,t){var n=t.split("=");return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(a,{})},t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t}},function(e,t,n){var r=n(10),i=/%[sdv%]/g,s=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?r.push(n[t.name][o]):r.push(n[t.names[i]])}else r.push(n[t.name]);return s.apply(null,r)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||a,i=t.innerOrder||c,s=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?s.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){s.push(o(t,n,e))}))}))})),e.media.forEach((function(e){s.push(o("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?s.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){s.push(o(t,n,e))}))}))}))})),s.join("\r\n")+"\r\n"}},function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(1);t.default=class{constructor(e){this.isPeerCall=!0,this.participantsArray=[],this.mediaType="",this.callSession="",this.instance=e}GroupCall(e){return new Promise(async(t,n)=>{e.callType="many_to_many",e.isInitiator=1,e.isPeer=1,e.uUID&&(e.sessionUuid=e.uUID);let r={};try{if(r=await this.instance.createOptions(e,1),e=r.params,this.callSession=e.uUID,delete r.params,r&&!r.status)throw r.message}catch(e){return this.instance.onErrorHandler(),n({status:!1,error:e})}r.localVideo&&(this.instance.localVideos[e.uUID]=r.localVideo),r.receivers&&0!==r.receivers.length?(console.log("@@@ new call current participant 0"),this.instance.sessionInfo[e.uUID].participants={},r.receivers.forEach(n=>{console.log("single participant to call--\x3e",n),this.manyToManyCallSingleParticipant(n,r,e).then(n=>{console.log(n),console.log("@@@ call current participant",n),this.instance.sessionInfo[e.uUID].participants[n.participant]={isInitiator:!0,call_state:"STARTING",isPeer:1,callType:"many_to_many",peerConnection:n.webRtcPeer},r.receivers.length==Object.keys(this.instance.sessionInfo[e.uUID].participants).length&&t(e.uUID)}).catch(e=>{console.error(e)})})):n({status:!1,message:"All Users are offline!"})})}manyToManyCallSingleParticipant(e,t,n){return new Promise((i,s)=>{const o=Object.assign({},n);let a=Object.assign({},t);o.participants=a.receivers,o.to=[e],a.onicecandidate=t=>this.instance.onIceCandidate(t,o.uUID,e),a=this.instance.AddOnTrackHandler(a,o.uUID,e);const c=r.WebRtcPeerHelper.WebRtcPeerSendrecv(a,t=>{t&&(this.instance.onErrorHandler(),console.error(t),s(t)),c.generateOffer((t,n)=>{if(t)return console.error(t),void s(t);this.instance.onOfferCall(t,n,this.instance.sessionInfo[o.uUID].mediaType,o.uUID,o),i({participant:e,webRtcPeer:c})})})})}AddCandidate(e){const t=this.instance.getPeerById(e.sessionUuid,e.from);console.log("Add Ice Candidate::::",e,t),t?t.addIceCandidate(e.candidate,e=>{if(e)return i.default.OnAddCandidate(e,this.instance),console.error("Error adding candidate: "+e)}):console.error("Participant not found for Add Ice Candidate::::",e,t)}CallResponse(e){var t,n;const r=this.instance.getPeerById(e.sessionUuid,null!==(t=e.from)&&void 0!==t?t:e.referenceId);console.info("CallResponse",r,e),("accepted"==e.response||"sdp_answer"==e.sdpType&&e.sdp)&&r.processAnswer(null!==(n=e.sdpAnswer)&&void 0!==n?n:e.sdp,e=>{if(e)return i.default.SessionSDP(e,this.instance),console.error(e)})}JoinGroupCall(e,t){return console.log("@@@ new join call current participant 0"),this.instance.sessionInfo[t].participants={},e.isPeer=1,e.callType="many_to_many",e.sdp=e.sdpOffer,e.sessionUuid=e.uUID=t,e.audio=1,e.video="video"==this.instance.sessionInfo[t].mediaType?1:0,e.isReInvite=0,this.instance.AcceptCall(e)}OnExistingParticipants(e){e.referenceIds.forEach(t=>{var n,r,i;if(null!=t){let s=e.sessionUuid;(null===(i=null===(r=null===(n=this.instance.sessionInfo)||void 0===n?void 0:n[s])||void 0===r?void 0:r.participants)||void 0===i?void 0:i[t])?console.log("Call already connected with this peer",t,this.instance.sessionInfo):this.instance.Call({callType:"many_to_many",isPeer:1,isInitiator:1,to:t,localVideo:this.instance.localVideos[s],video:this.instance.videoStatus[s],audio:this.instance.audioStatus[s],sessionUuid:s,uUID:s,requestType:"to_receive_stream"})}})}OnNewParticipant(e){}OnSessionCancel(e){let t=e.referenceId;this.instance.emit("groupCall",{type:"PARTICIPANT_LEFT",message:"Participant left.",participant:t});const n=this.instance.getPeerById(e.sessionUuid,t);this.participantsArray.splice(this.participantsArray.indexOf(t),1),n&&n.dispose(),delete this.instance.sessionInfo[e.sessionUuid].participants[t]}SetParticipantVideo(e,t){console.log("No need to handle this event as it is a peer 2 peer call and we will handle on existing participant")}SetParticipantStatus(e){i.default.SetParticipantStatus(e,this.instance)}LeaveGroupCall(){let e={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.callSession,mcToken:this.instance.McToken};this.instance.SendPacket(e),this.instance.DisposeWebrtc(!1)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),s=n(4),o=n(5),a=n(6),c=n(2),l=n(3);class u extends r.EventEmitter{constructor(e){super(),this.isPeerCall=!1,this.UUIDSessions={},this.UUIDSessionTypes={},this.UUIDSessionMediaTypes={},this.participants={},this.participantVideo={},this.callSession="",this.participantsArray=[],this.mediaType="",this.videoPlaying=1,this.audioPlaying=1,this.instance={},this.mcToken=e.mcToken,this.currentUser=e.currentUser,this.instance=e,this.ws=e.ws}set McToken(e){this.mcToken=e}get McToken(){return this.mcToken}Connect(e){var t=new WebSocket(e);t.onmessage=e=>{var t=JSON.parse(e.data);switch(console.log("Received message: ",t),t.requestType){case"register":o.default.SetRegisterResponse(t,this);break;case"call_response":console.log(" CallResponse: ",t),this.CallResponse(t);break;case"incoming_call":this.callSession=t.sessionUuid,this.mediaType=t.mediaType,console.log("incoming_call case: ",e),i.default.OnIncomingGroupCall(t,this);break;case"start_communication":this.SessionStart(t);break;case"stopCommunication":console.info("Communication ended by remote peer",t);break;case"ice_candidate":this.AddCandidate(t);break;case"session_invite":break;case"session_cancel":this.OnSessionCancel(t),console.log("===onParticipantOffer== exiting session_cancel",t,(new Date).toLocaleTimeString());break;case"existing_participants":console.log("===onParticipantOffer== exiting",t,(new Date).toLocaleTimeString()),this.OnExistingParticipants(t);break;case"new_participant_arrived":console.log("===onParticipantOffer== exiting new",t,(new Date).toLocaleTimeString()),this.OnNewParticipant(t);break;case"participantLeft":console.log("===onParticipantOffer== exiting left",t,(new Date).toLocaleTimeString()),this.OnParticipantLeft(t);break;case"state_information":console.log("===onParticipantOffer== exiting left",t,(new Date).toLocaleTimeString()),i.default.SetParticipantStatus(t,this)}},t.onclose=e=>{i.default.OnDisconnection(e,this),console.log("OnClose socket==",e)},t.onopen=e=>{i.default.OnConnection(e,this),console.log("OnOpen socket==",e)},t.onerror=e=>{i.default.OnDisconnection(e,this),console.log("OnError socket==",e)},this.ws=t}SetParticipantStatus(e){i.default.SetParticipantStatus(e,this.instance)}AddCandidate(e){console.log("Add Ice Candidate::::",e,this.participants[e.referenceId]),this.participants[e.referenceId]?this.participants[e.referenceId].addIceCandidate(e.candidate,e=>{if(e)return i.default.OnAddCandidate(e,this.instance),console.error("Error adding candidate: "+e)}):console.error("Participant not found for Add Ice Candidate::::",e,this.participants[e.referenceId])}OnExistingParticipants(e){let t=e.referenceIds;t.forEach(e=>{null!=e&&this.instance.emit("groupCall",{type:"NEW_PARTICIPANT",message:"New participant arrived.",participant:e})})}OnSessionCancel(e){let t=e.referenceId;this.instance.emit("groupCall",{type:"PARTICIPANT_LEFT",message:"Participant left.",participant:t});var n=this.participants[t];this.participantsArray.splice(this.participantsArray.indexOf(t),1),n&&null!=n&&n.dispose(),delete this.participants[t],delete this.participantVideo[t]}OnNewParticipant(e){let t=e.referenceId;null!=t&&-1==this.participantsArray.indexOf(t)&&this.instance.emit("groupCall",{type:"NEW_PARTICIPANT",message:"New participant arrived.",participant:t,uuid:e.sessionUuid})}OnParticipantLeft(e){let t=e.referenceId;this.instance.emit("groupCall",{type:"PARTICIPANT_LEFT",message:"Participant left.",participant:t})}SetParticipantVideo(e,t){(0,c.SetPlaysInline)(t);let n={remoteVideo:t,onicecandidate:t=>{this.OnParticipantIceCandidate(t,e)},onerror:this.onError},r=l.WebRtcPeerHelper.WebRtcPeerRecvonly(n,t=>{if(t)return console.error(t);console.log("## Generating Offer in SEtParticipantVideo for remote video",e),r.generateOffer((t,n)=>{this.onParticipantOffer(t,n,e)})});return this.participants[e]=r,this.participantVideo[e]=t,t}ExistingParticipant(e){var t;let n=document.createElement("video");n.autoplay=!0,n.muted=!0,n.style.display="none";let r={remoteVideo:n,onicecandidate:t=>{this.OnParticipantIceCandidate(t,e)},onerror:this.onError},i=l.WebRtcPeerHelper.WebRtcPeerRecvonly(r,t=>{if(t)return console.error(t);console.log("## Generating Offer In Existing Participants remote video ",e),i.generateOffer((t,n)=>{this.onParticipantOffer(t,n,e)})});return this.participants[e]=i,this.participantVideo[e]=n,null===(t=document.getElementById("hellofyou"))||void 0===t||t.appendChild(n),n}CallResponse(e){console.info("CallResponse",this.participants[e.referenceId],e),"accepted"==e.response&&(console.log("## processing Answer for session : ",e.sessionUuid),this.participants[e.referenceId].processAnswer(e.sdpAnswer,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)}))}SessionStart(e){i.default.GroupSessionStart(e,this.instance),console.log("## processing answer Start=Commm",e.referenceId,e.referenceId,this.participants[e.referenceId]),this.participants[e.referenceId].processAnswer(e.sdpAnswer,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)})}Register(e,t){this.currentUser=e;let n=new s.default;n.requestId=(new Date).getTime().toString(),n.projectId=this.projectId,n.tenantId=this.projectId,n.referenceId=e,n.authorizationToken=t,n.SendRegisterRequest(this.ws)}GroupCall(e){return new Promise((t,n)=>{this.mediaType=e.callType,this.to=Array.isArray(e.to)?e.to:[e.to],this.currentFromUser=this.currentUser,this.localVideo=e.localVideo,this.instance.to=this.to,(0,c.SetPlaysInline)(this.localVideo),this.audioPlaying=1,this.videoPlaying="audio"!=e.callType?1:0;var r={mediaConstraints:{audio:!0,video:"audio"!=e.callType},localVideo:e.localVideo,onicecandidate:e=>{this.onIceCandidate(e,this.currentUser)},onerror:this.onError};let i=l.WebRtcPeerHelper.WebRtcPeerSendonly(r,r=>{if(r)return n({status:!1,message:r.message?r.message:r}),console.error(r);console.log("## Generating Offer to send Local video",this.currentUser),i.generateOffer((r,i)=>{this.onManyToManyOfferCall(r,i,e.callType,e.uUID),r?n(r):t(!0)})});this.participants[this.currentUser]=i})}JoinGroupCall(e,t){this.mediaType=e.callType,this.localVideo=e.localVideo,this.callSession=t,(0,c.SetPlaysInline)(this.localVideo);var n={mediaConstraints:{audio:!0,video:"audio"!=e.callType},localVideo:e.localVideo,onicecandidate:e=>{this.onIceCandidate(e,this.currentUser)},onerror:this.onError};let r=l.WebRtcPeerHelper.WebRtcPeerSendonly(n,t=>{if(t)return console.error(t);console.log("## Generating Offer in Join Group Call to send local video"),r.generateOffer((t,n)=>{this.onJoinManyToManyOfferCall(t,n,e.callType)})});this.participants[this.currentUser]=r}onManyToManyOfferCall(e,t,n,r){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the call offer ",e);this.callSession=r,this.instance.callSession=r;let s=new a.default;s.from=this.currentUser,s.to=this.to,s.requestId=r,s.sessionUuid=r,s.mcToken=this.McToken,s.sdpOffer=t,s.mediaType=n,s.callType="many_to_many",s.SendCallRequest(this.ws),console.log(" OnOfferCall :: :: ::",n)}onJoinManyToManyOfferCall(e,t,n){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the call offer ",e);let r=(new Date).getTime().toString();this.callSession;var s={from:this.currentUser,sdpOffer:t,responseCode:200,responseMessage:"accepted",requestType:"session_invite",type:"request",sessionType:"call",callType:"many_to_many",mediaType:n,requestId:r,sessionUuid:this.callSession,mcToken:this.mcToken};this.SendPacket(s)}onParticipantOffer(e,t,n){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the call offer ",e);let r=(new Date).getTime().toString();var s={from:this.currentUser,to:n,requestType:"to_receive_stream",sdpOffer:t,requestId:r,type:"request",sessionUuid:this.callSession,mcToken:this.McToken};console.log("===onParticipantOffer==",s),this.SendPacket(s)}DisposeWebrtc(e){for(var t in this.participants){let e=this.participants[t];e&&null!=e&&e.dispose()}this.participants={},this.participantVideo={},this.callSession="",this.participantsArray=[]}onError(e){i.default.OnRTCPeer(e,this)}onIceCandidate(e,t){console.log("Local candidate"+JSON.stringify(e));var n={requestType:"ice_candidate",candidate:e,referenceId:t,sessionUuid:this.callSession};this.SendPacket(n)}SendPacket(e){var t=JSON.stringify(e);console.log("Sending message: "+t),null!=this.ws?this.ws.send(t):i.default.OnAuthInitialError("",this)}OnParticipantIceCandidate(e,t){var n={requestType:"ice_candidate",candidate:e,referenceId:t,sessionUuid:this.callSession};this.SendPacket(n)}SetMicMute(){if(this.localVideo&&null!=this.localVideo){this.mediaType;this.audioPlaying=0;let e={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.callSession,mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioPlaying,videoInformation:this.videoPlaying};this.SendPacket(e),null!=this.localVideo.srcObject&&(this.localVideo.srcObject.getAudioTracks()[0].enabled=!1),"audio"==this.localVideo.localName&&(this.localVideo.audioTracks[0].enabled=!1)}}SetMicUnmute(){if(this.localVideo&&null!=this.localVideo){this.mediaType;this.audioPlaying=1;let e={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.callSession,mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioPlaying,videoInformation:this.videoPlaying};this.SendPacket(e),null!=this.localVideo.srcObject&&(this.localVideo.srcObject.getAudioTracks()[0].enabled=!0),"audio"==this.localVideo.localName&&(this.localVideo.audioTracks[0].enabled=!0)}}SetCameraOn(){if(this.localVideo&&null!=this.localVideo){this.videoPlaying=1;let e={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.callSession,mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioPlaying,videoInformation:this.videoPlaying};this.SendPacket(e),this.localVideo.srcObject.getVideoTracks()[0].enabled=!0}}SetCameraOff(){if(this.localVideo&&null!=this.localVideo){this.videoPlaying=0;let e={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.callSession,mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioPlaying,videoInformation:this.videoPlaying};this.SendPacket(e),this.localVideo.srcObject.getVideoTracks()[0].enabled=!1}}LeaveGroupCall(){let e={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.callSession,mcToken:this.McToken};this.SendPacket(e),this.DisposeWebrtc(!1)}CancelCall(){let e=this.currentFromUser,t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[e],mcToken:this.McToken};this.SendPacket(t),this.DisposeWebrtc(!1)}}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),s=n(2),o=n(3);class a extends r.EventEmitter{constructor(e){super(),this.participants={},this.videoArray=[],this.callType="video",this.projectId=e.projectId,this.projectSecret=e.secret,this.currentUser=e.currentUser,this.currentRoom=e.room,this.localVideo=e.localVideo,this.container=e.container,this.callType=e.callType,this.Authentication(e)}set McToken(e){this.mcToken=e}get McToken(){return this.mcToken}Authentication(e){this.Connect(e.media_server)}Connect(e){var t=new WebSocket(e);t.onmessage=e=>{var t=JSON.parse(e.data);switch(console.log("Received message: "+e.data),t.id){case"existingParticipants":console.log("===yes you====",t),this.OnExistingParticipant(t);break;case"newParticipantArrived":this.onNewParticipant(t);break;case"participantLeft":this.OnParticipantLeft(t);break;case"receiveVideoAnswer":this.ReceiveVideoResponse(t);break;case"ice_candidate":this.participants[t.name].addIceCandidate(t.candidate,(function(e){e&&console.error("Error adding candidate: "+e)}));break;case"ping":this.SendPacket({requestType:"pong",mcToken:this.McToken});break;default:console.error("Unrecognized message",t)}},t.onclose=e=>{i.default.OnDisconnection(e,this),console.log("OnClose socket==",e)},t.onopen=e=>{this.Register(),i.default.OnConnection(e,this),console.log("OnOpen socket==",e)},t.onerror=e=>{i.default.OnDisconnection(e,this),console.log("OnError socket==",e)},this.ws=t}OnExistingParticipant(e){let t={mandatory:{maxFrameRate:15,minFrameRate:15}};"video"!=this.callType&&(t=!1);var n={audio:!0,video:t};(0,s.SetPlaysInline)(this.localVideo);var r={localVideo:this.localVideo,mediaConstraints:n,onicecandidate:e=>{var t={id:"ice_candidate",candidate:e,name:this.currentUser};this.SendPacket(t)}};let i=o.WebRtcPeerHelper.WebRtcPeerSendonly(r,e=>{if(e)return console.error(e);i.generateOffer((e,t,n)=>{if(e)return console.error("sdp offer error");var r={id:"receiveVideoFrom",sender:this.currentUser,sdpOffer:t};this.SendPacket(r)})});this.participants[this.currentUser]=i,e.data.forEach(e=>{this.emit("groupCall",{type:"NEW_PARTICIPANT",message:"Participant List",participant:e})})}SetParticipantVideo(e,t){(0,s.SetPlaysInline)(e);var n={remoteVideo:e,onicecandidate:e=>{var n={id:"ice_candidate",candidate:e,name:t};this.SendPacket(n)}};let r=o.WebRtcPeerHelper.WebRtcPeerRecvonly(n,e=>{if(e)return console.error(e);r.generateOffer((e,n)=>{if(e)return console.error("sdp offer error");console.log("Invoking SDP offer callback function");var r={id:"receiveVideoFrom",sender:t,sdpOffer:n};this.SendPacket(r)})});this.participants[t]=r}onNewParticipant(e){this.emit("groupCall",{type:"NEW_PARTICIPANT",message:"Participant has joined",participant:e.name})}OnParticipantLeft(e){this.emit("groupCall",{type:"PARTICIPANT_LEFT",message:"Participant has left",participant:e.name});var t=this.participants[e.name];t&&null!=t&&(t.dispose(),delete this.participants[e.name])}ReceiveVideoResponse(e){let t=this.participants[e.name];console.log("===ongroupcall==recievresp==",e,"participant",this.participants),t&&null!=t&&t.processAnswer(e.sdpAnswer,(function(e){if(e)return console.error(e)}))}OnIceCandidate(e){let t=this.participants[e.name];null!=t&&t.addIceCandidate(e.candidate,(function(e){e&&console.error("Error adding candidate: "+e)}))}LeaveRoom(){for(var e in this.SendPacket({id:"leaveRoom"}),this.participants){let t=this.participants[e];t&&null!=t&&t.dispose()}this.ws.close()}Close(){}Register(){var e={id:"joinRoom",name:this.currentUser,room:this.currentRoom};this.SendPacket(e)}SendPacket(e){var t=JSON.stringify(e);console.log("Sending message: "+t),null!=this.ws?this.ws.send(t):i.default.OnAuthInitialError("",this)}SetMicMute(){let e=this.localVideo;e&&e.srcObject&&e.srcObject.getAudioTracks()[0]&&(e.srcObject.getAudioTracks()[0].enabled=!1);var t={id:"media_status",status:{type:"mic",status:0,username:this.currentUser}};this.SendPacket(t)}SetMicUnmute(){let e=this.localVideo;e&&e.srcObject&&e.srcObject.getAudioTracks()[0]&&(e.srcObject.getAudioTracks()[0].enabled=!0);var t={id:"media_status",status:{type:"mic",status:1,username:this.currentUser}};this.SendPacket(t)}SetCameraOn(){let e=this.localVideo;e&&e.srcObject&&e.srcObject.getAudioTracks()[0]&&(e.srcObject.getVideoTracks()[0].enabled=!0);var t={id:"media_status",status:{type:"camera",status:1,username:this.currentUser}};this.SendPacket(t)}SetCameraOff(){let e=this.localVideo;e&&e.srcObject&&e.srcObject.getAudioTracks()[0]&&(e.srcObject.getVideoTracks()[0].enabled=!1);var t={id:"media_status",status:{type:"camera",status:0,username:this.currentUser}};this.SendPacket(t)}GetContainer(){let e=document.createElement("section");for(var t in this.participants){let n=this.participants[t].getVideoElement(),r=this.participants[t].createVideo(n.srcObject);e.appendChild(r)}return e}}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),s=n(8),o=n(4),a=n(5),c=n(6),l=n(32),u=n(2),h=n(3);class d extends r.EventEmitter{constructor(e){super(),this.UUIDSessions={},this.UUIDSessionTypes={},this.UUIDSessionMediaTypes={},this.videoStatus=1,this.audioStatus=1,this.broadCastSession={},this.authToken=null,this.RefID=null,this.pingSessionStopped=[],this.messageCredentials=null,this.pingWorker=null,this.MclientInstance=null,this.projectId=e.projectId,this.projectSecret=e.secret,e.host?this.Connect(e.host):this.Authentication(e),e.screenShareVideo&&(this.videoElement=e.screenShareVideo)}set McToken(e){this.mcToken=e}get McToken(){return this.mcToken}Authentication(e){console.log("====DER===",e,this.projectId,this.projectSecret,this.clientToken),s.default.Authorization(e.projectId,e.secret).then(e=>{if(console.log("===Authorization-outer===",e),e&&200==e.status){let t=`${e.media_server_map.protocol}://${e.media_server_map.host}:${e.media_server_map.port}/${e.media_server_map.end_point}`;this.Connect(t),console.log("===Authorization===",e)}else i.default.OnAuthError(e.message,this)})}NewScreenImage(e){console.log("New Screen Image",e,this.videoElement),this.ScreenshareInstance||(this.ScreenshareInstance=new l.default(this,this.videoElement)),console.log("screen Instance--\x3e",this.ScreenshareInstance),this.ScreenshareInstance.NewImageReceived(e)}ScrollScreenImage(e){console.log("New Screen Image",e,this.videoElement),this.ScreenshareInstance||(this.ScreenshareInstance=new l.default(this,this.videoElement)),this.ScreenshareInstance.ScrollImage(e)}Connect(e){var t=new WebSocket(e);t.onmessage=e=>{var t=JSON.parse(e.data);switch(console.log("Received message: ",t),t.requestType){case"register":case"register_url":a.default.SetRegisterResponse(t,this),this.registerPingWorker();break;case"call_response":console.log(" CallResponse: ",t),this.CallResponse(t),i.default.OnCallResponse(t,this);break;case"incoming_call":this.callSession=t.sessionUuid,this.currentFromUser=t.from,this.UUIDSessions[t.from]=t.sessionUuid,this.UUIDSessionTypes[t.sessionUuid]=t.callType,this.UUIDSessionMediaTypes[t.from]=t.mediaType,this.mediaType=t.mediaType,console.log("incoming_call case: ",e),i.default.OnIncomingCall(t,this);break;case"start_communication":this.SessionStart(t);break;case"stopCommunication":console.info("Communication ended by remote peer"),i.default.SessionEnd(t,this),this.DisposeWebrtc(!0);break;case"ice_candidate":this.AddCandidate(t);break;case"session_invite":i.default.SessionInvite(t,this);break;case"session_cancel":case"session_break":i.default.SessionCancel(t,this);break;case"state_information":console.log("===onParticipantOffer== exiting left",t,(new Date).toLocaleTimeString()),i.default.SetCallerStatus(t,this);break;case"ping":this.SendPacket({requestType:"pong",mcToken:this.McToken});break;case"custom_rpc":case"hv_info":console.log("===custom_rpc",t,(new Date).toLocaleTimeString()),t.data&&("N_S_I"===t.data.type?this.NewScreenImage(t.data):"S_S_I"===t.data.type&&this.ScrollScreenImage(t.data),this.OnCustomRPC(t));break;case"host_info":console.log("host info==>",t),this.emit("call",{type:"HOST_INFO",message:"host availability",available:t.data.active,uuid:t.sessionUuid,data:t});break;case"session_pong":case"session_ping":200==t.responseCode?console.log("sdk session pong",t):400==t.responseCode?(console.log("SDK session ended in pong",t),this.pingSessionStopped[t.sessionUuid]=!0,this.emit("call",{type:"SESSION_SUSPENSION",message:"Show has suspended by VDOTOK",uuid:t.sessionUuid})):407==t.responseCode&&(console.log("SDK invalid authentication or invalid mcToken in pong",t),i.default.OnAuthError(t.message,this))}},t.onclose=e=>{i.default.OnDisconnection(e,this),console.log("OnClose socket==",e),this.emit("call",{type:"SOCKET_DROPPED",message:"socket is dropped",uuid:e.sessionUuid})},t.onopen=e=>{i.default.OnConnection(e,this),console.log("OnOpen socket==",e)},t.onerror=e=>{i.default.OnDisconnection(e,this),console.log("OnError socket==",e),this.emit("call",{type:"SOCKET_DROPPED",message:"socket is dropped",uuid:e.sessionUuid})},this.ws=t}OnCustomRPC(e){console.log("create connection and fire stream! with id = "+e.data.sessionUuid),i.default.OnCustomRPC(e,this)}AddCandidate(e){this.broadCastSession[e.sessionUuid].addIceCandidate(e.candidate,e=>{if(e)return i.default.OnAddCandidate(e,this),console.error("Error adding candidate: "+e)})}CallResponse(e){console.info("CallResponse",this.webRtcPeer,e),"accepted"==e.response&&this.broadCastSession[e.sessionUuid].processAnswer(e.sdpAnswer,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)})}rejoinAssociatedSession(e){console.log("i have rejoin request--\x3e",e),this.emit("call",{type:"CUSTOM_SCREEN_SHARE_REQUEST",message:"Mobile screenshare request received.",data:{uuid:e.associatedSessionUuid,type:"CUSTOM_SCREEN_SHARE_REQUEST"},uuid:e.associatedSessionUuid})}SessionStart(e){console.log("start_communication in broadcast sdk--\x3e",e.sessionUuid),e.sessionUuid.includes("-xy")?(this.messageCredentials=e,this.InitializeMessagingSdk(e)):(i.default.SessionStart(e,this),this.broadCastSession[e.sessionUuid].processAnswer(e.sdpAnswer,e=>{if(e)return i.default.SessionSDP(e,this),console.error(e)}),e.hasOwnProperty("associatedSessionUuid")&&e.associatedSessionUuid.includes("-xy")&&this.rejoinAssociatedSession(e))}subscribeChannel(e){this.MclientInstance.Subscribe(e)}InitializeMessagingSdk(e){console.log("message credentials in screenshare class--\x3e",this.messageCredentials);let t={projectId:this.messageCredentials.customScreenShare.projectId,secret:"5ff420e1fd72bca845c889bdfe01d19d",host:this.messageCredentials.customScreenShare.completeAddress};this.MclientInstance=new MVDOTOK.Client(t),console.log("** Mclient in sdk after initializing==>",this.MclientInstance),this.RefID=this.currentUser,console.log("** before registering Mclient in sdk==>",this.authToken,this.RefID),this.MclientInstance.Register(this.RefID,this.authToken),this.MclientInstance.on("connect",e=>{console.log("**res on connect sdk in vdotok sdk viewer side--\x3e",e),this.subscribeChannel({key:this.messageCredentials.customScreenShare.topicKey,channel:this.messageCredentials.customScreenShare.topicName})}),this.MclientInstance.on("subscribed",e=>{console.log("** res on subscribing channel in sdk--\x3e",e)}),this.MclientInstance.on("message",e=>{console.log("**res on message sdk viewer side",e),"S_S_I_E"===e.type&&i.default.sendScrollRpcToApp(e.content,this)}),i.default.CustomScreenshareSessionStart(e,this)}RejectCall(e){let t=this.currentFromUser,n={type:"response",from:t,requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[t],responseCode:496,responseMessage:"rejected"};this.SendPacket(n),this.DisposeWebrtc(!1)}onOfferIncomingCall(e,t,n){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the offer");let r={type:"request",requestType:"session_invite",sdpOffer:t,requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[n],responseCode:200,responseMessage:"accepted"};console.log("===OnOffering Answer",r),this.SendPacket(r)}onOfferCustomScreensharePublicUrlCall(e){console.log("this is onOfferCustomScreensharePublicUrlCall function",e);let t={type:"request",requestType:"public_url",sdpOffer:"",requestId:(new Date).getTime().toString(),sessionUuid:e,responseCode:200,responseMessage:"accepted"};console.log("===OnOffering custom screenshare Answer",t),this.SendPacket(t)}onOfferPublicUrlCall(e,t,n){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the offer");let r={type:"request",requestType:"public_url",sdpOffer:t,requestId:(new Date).getTime().toString(),sessionUuid:n,responseCode:200,responseMessage:"accepted"};console.log("===OnOffering Answer",r),this.SendPacket(r),this.broadCastSession&&this.broadCastSession[n]&&this.broadCastSession[n].peerConnection&&this.broadCastSession[n].peerConnection.addEventListener("iceconnectionstatechange",this.onIceError.bind(this,n),!1)}onIceError(e,t){let n=this.broadCastSession[e];n&&n.peerConnection&&n.peerConnection.iceConnectionState&&["closed","failed","disconnected"].includes(n.peerConnection.iceConnectionState)&&(console.log("SDK iceconnectionstatechange",n.peerConnection.iceConnectionState,t),this.emit("call",{type:"ICE_FAILED",message:"An ice candidate failed try refresh",uuid:e}))}Register(e,t){this.currentUser=e,this.authToken=t;let n=new o.default;n.requestId=(new Date).getTime().toString(),n.tenantId=this.projectId,n.projectId=this.projectId,n.referenceId=e,n.authorizationToken=t,n.SendRegisterRequest(this.ws)}RegisterPublicURL(){let e=(0,u.UuidGenerator)();this.currentUser=e;let t=new o.default;t.requestId=(new Date).getTime().toString(),t.tenantId=this.projectId,t.referenceId=e,t.requestType="register_url",t.SendRegisterRequest(this.ws)}onOfferOneToManyCall(e,t){if(e)return i.default.OnOfferIncomingCall(e,this),console.error("Error generating the call offer ",e);let n=(new Date).getTime().toString();this.UUIDSessions[this.currentUser]=n,this.UUIDSessionTypes[n]="one_to_many";let r=new c.default;r.from=this.currentUser,r.to=this.to,r.requestId=n,r.sessionUuid=n,r.mcToken=this.McToken,r.sdpOffer=t,r.callType="one_to_many",r.SendCallRequest(this.ws)}AcceptBroadcast(e){let t=this.currentFromUser;this.mediaType="video",(0,u.SetPlaysInline)(e);var n={remoteVideo:e,onicecandidate:e=>{this.onIceCandidate(e,t)},onerror:this.onError};this.webRtcPeer=h.WebRtcPeerHelper.WebRtcPeerRecvonly(n,e=>{if(e)return console.error(e);this.webRtcPeer.generateOffer((e,n)=>{this.onOfferIncomingCall(e,n,t)})})}AcceptPublicBroadcast(e,t){if(t.includes("-xy"))this.onOfferCustomScreensharePublicUrlCall(t);else{this.mediaType="video";(0,u.SetPlaysInline)(e);var n={remoteVideo:e,onicecandidate:e=>{this.onPublicIceCandidate(e,this.currentUser,t)},onerror:this.onError};let r=h.WebRtcPeerHelper.WebRtcPeerRecvonly(n,e=>{if(e)return console.error(e);r.generateOffer((e,n)=>{this.onOfferPublicUrlCall(e,n,t)})});this.broadCastSession[t]=r}}DisposeWebrtc(e){if(this.webRtcPeer){if(this.webRtcPeer.dispose(),this.webRtcPeer=null,e){var t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[this.currentFromUser],mcToken:"f3101a4f686d4dd7993ded88d9e386e5"};this.SendPacket(t)}let n=this.UUIDSessions[this.currentFromUser];delete this.UUIDSessionTypes[n],delete this.UUIDSessions[this.currentFromUser]}}onError(e){i.default.OnRTCPeer(e,this)}onPublicIceCandidate(e,t,n){console.log("Local candidate"+JSON.stringify(e));var r={id:"ice_candidate",requestType:"ice_candidate",type:"request",candidate:e,referenceId:t,sessionUuid:n};this.SendPacket(r)}onIceCandidate(e,t){console.log("Local candidate"+JSON.stringify(e));var n={id:"ice_candidate",requestType:"ice_candidate",type:"request",candidate:e,referenceId:t,sessionUuid:this.UUIDSessions[t]};this.SendPacket(n)}SendPacket(e){var t=JSON.stringify(e);console.log("Sending message: "+t),null!=this.ws?this.ws.send(t):i.default.OnAuthInitialError("",this)}EndCall(){let e=this.currentFromUser,t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[e],mcToken:this.McToken};this.SendPacket(t),this.DisposeWebrtc(!1)}CancelCall(){let e=this.currentFromUser,t={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[e],mcToken:this.McToken};this.SendPacket(t),this.DisposeWebrtc(!1)}EndBroadCasting(){this.currentFromUser;let e=Object.assign({},this.broadCastSession);for(var t in e){let n=e[t],r={type:"request",requestType:"session_cancel",requestId:(new Date).getTime().toString(),sessionUuid:t,mcToken:this.McToken};this.SendPacket(r),n.dispose(),delete this.broadCastSession[t]}}SetMicMute(){if(this.localVideo&&null!=this.localVideo){let e="video"==this.mediaType&&1==this.videoStatus?1:0;this.audioStatus=0;let t={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[this.currentFromUser],mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioStatus,videoInformation:e};this.SendPacket(t),null!=this.localVideo.srcObject&&(this.localVideo.srcObject.getAudioTracks()[0].enabled=!1),"audio"==this.localVideo.localName&&(this.localVideo.audioTracks[0].enabled=!1)}}SetMicUnmute(){if(this.localVideo&&null!=this.localVideo){let e="video"==this.mediaType&&1==this.videoStatus?1:0;this.audioStatus=1;let t={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[this.currentFromUser],mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioStatus,videoInformation:e};this.SendPacket(t),null!=this.localVideo.srcObject&&(this.localVideo.srcObject.getAudioTracks()[0].enabled=!0),"audio"==this.localVideo.localName&&(this.localVideo.audioTracks[0].enabled=!0)}}SetCameraOn(){if(this.localVideo&&null!=this.localVideo){this.videoStatus=1;let e={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[this.currentFromUser],mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioStatus,videoInformation:1};this.SendPacket(e),this.localVideo.srcObject.getVideoTracks()[0].enabled=!0}}SetCameraOff(){if(this.localVideo&&null!=this.localVideo){this.videoStatus=0;let e={requestType:"state_information",type:"request",requestId:(new Date).getTime().toString(),sessionUuid:this.UUIDSessions[this.currentFromUser],mcToken:this.McToken,referenceId:this.currentUser,audioInformation:this.audioStatus,videoInformation:0};this.SendPacket(e),this.localVideo.srcObject.getVideoTracks()[0].enabled=!1}}sendStateRPC(e,t,n=0,r="vh_info"){let i={};i.requestType=r,i.type="request",i.requestId=(new Date).getTime().toString(),-1===t?delete i.sessionUuid:i.sessionUuid=t||this.UUIDSessions[this.currentUser],i.mcToken=this.McToken,i.referenceId=this.currentUser,i.data=e,i.store=n,this.ws.send(JSON.stringify(i))}registerPingWorker(){if(this.pingWorker)return;window.URL=window.URL||window.webkitURL;const e=new Blob(["let pingInterval;\n                            onmessage = (res) => {\n                                let data = res.data;\n                                console.log('Message received from main script');\n                                const method = data.method;\n                                if (method === 'format') {\n                                    postMessage({\n                                        data: {\n                                            'res': 'I am a customized result string.',\n                                        }\n                                    });\n                                }\n                                else if (method === 'startPingInterval')\n                                {\n                                    if(!data.interval)\n                                    {\n                                        data.interval =  5000;\n                                    }\n                                    clearPingInterval();\n                                    startPingInterval(data.interval);\n                                }\n                                else if(method === 'clearPingInterval')\n                                {\n                                    clearPingInterval();\n                                }\n                                console.log('Posting message back to main script');\n                            }\n                            \n                            function startPingInterval(interval)\n                            {\n                                pingInterval = setInterval(()=>{\n                                    postMessage({\n                                            'sendPing': true\n                                    });\n                                },interval)\n                            }\n                            function  clearPingInterval()\n                            {\n                                if(pingInterval)\n                                {\n                                    clearInterval(pingInterval);\n                                }\n                            }\n                            "],{type:"application/javascript"});this.pingWorker=new Worker(URL.createObjectURL(e)),this.pingWorker&&(this.pingWorker.onmessage=e=>{e&&e.data&&e.data.sendPing&&this.sendPing()},this.pingWorker.postMessage({method:"startPingInterval",interval:5e3}))}sendPing(){try{this.sendStateRPC({},-1,0,"ping"),console.log("SDK Ping sent!")}catch(e){console.log(e)}}}t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(33);t.default=class{constructor(e=null,t){this.socketInstance=null,this.isSafari=!1,this.isIos=!1,this.videoElement=null,this.currentImage=null,this.DrawGlInstance=null,this.socketInstance=e,this.videoElement=t,this.isSafari=this.getBrowser().includes("Safari"),this.isIos=this.isIOSDevice()}getBrowser(){const e=navigator.userAgent;let t="unkown";return t=/ucbrowser/i.test(e)?"UCBrowser":t,t=/edg/i.test(e)?"Edge":t,t=/googlebot/i.test(e)?"GoogleBot":t,t=/chromium/i.test(e)?"Chromium":t,t=/firefox|fxios/i.test(e)&&!/seamonkey/i.test(e)?"Firefox":t,t=/; msie|trident/i.test(e)&&!/ucbrowser/i.test(e)?"IE":t,t=/chrome|crios/i.test(e)&&!/opr|opera|chromium|edg|ucbrowser|googlebot/i.test(e)?"Chrome":t,t=/safari/i.test(e)&&!/chromium|edg|ucbrowser|chrome|crios|opr|opera|fxios|firefox/i.test(e)?"Safari":t,t=/opr|opera/i.test(e)?"Opera":t,t}getTogeeScreenCanvas(e){let t=document.getElementById("toGee_screen_share_canvas");if(!t){t=document.createElement("canvas"),document.body.appendChild(t),t.id="toGee_screen_share_canvas",t.setAttribute("data-html2canvas-ignore",""),t.width=e.w,t.height=e.h,t.style.opacity=0,t.style.position="absolute",t.style.zIndex=-1,t.style.top="-1000em",t.style.left="-1000em";let n=t.captureStream(25);this.socketInstance.emit("call",{type:"SCREENSHARE_STREAM_RECEIVED",message:"Received Screenshare stream",stream:n})}return t}WebglScreenShareLogic(e){const t=this.getTogeeScreenCanvas(e);this.DrawGlInstance||(this.DrawGlInstance=new r(t,null)),console.log("DrawInstance.current",this.DrawGlInstance);var n=new Image;n.crossOrigin="anonymous",n.src=""+e.image.path,n.onload=()=>this.handleWebglImageLoad(n,e,t)}CanvasScreenShareLogic(e){console.log("canvasScreenShareLogic func",e);const t=this.getTogeeScreenCanvas(e),n=t.getContext("2d");let r=new Image;r.onload=()=>this.handleLoad(n,e,t,r),r.crossOrigin="anonymous",r.src=""+e.image.path}handleWebglImageLoad(e,t,n){this.DrawGlInstance.clear([]),this.DrawGlInstance.drawImage(e,t.x,t.y,t.w,t.h,0,0,n.width,n.height),console.log("drawGL",this.DrawGlInstance),this.currentImage=e}handleLoad(e,t,n,r){e.clearRect(0,0,n.width,n.height),e.drawImage(r,t.x,t.y,t.w,t.h,0,0,n.width,n.height),this.currentImage=r}isIOSDevice(){return navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)}WebglScrollLogic(e){if(!this.currentImage)return;const t=this.getTogeeScreenCanvas(e);this.DrawGlInstance&&(console.log("DrawInstance.current",this.DrawGlInstance),this.DrawGlInstance.clear([]),this.DrawGlInstance.drawImage(this.currentImage,e.x,e.y,e.w,e.h,0,0,t.width,t.height),console.log("drawGL",this.DrawGlInstance))}CanvasScrollLogic(e){if(console.log("this is scrolling normal"),!this.currentImage)return;const t=this.getTogeeScreenCanvas(e),n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.drawImage(this.currentImage,e.x,e.y,e.w,e.h,0,0,t.width,t.height)}NewImageReceived(e){console.log("data in screenshare class",e,this.isSafari,this.isIos),this.isSafari||this.isIos?this.WebglScreenShareLogic(e):this.CanvasScreenShareLogic(e)}ScrollImage(e){this.isSafari||this.isIos?this.WebglScrollLogic(e):this.CanvasScrollLogic(e)}}},function(e,t,n){!function(t){const n=Float32Array;var r=new n(16),i=new n(16),s=function(e,t){this.texCache={},e&&this.init(e,t)},o={constructor:s,canvas:null,gl:null,vertexShader:null,fragmentShader:null,program:null,positionLocation:null,positionBuffer:null,matrixLocation:null,textureMatrixLocation:null,textureLocation:null,alphaLocation:null,texCache:null,destroy:function(){this.texCache=null,this.canvas=null,this.gl=null,this.vertexShader=null,this.fragmentShader=null,this.program=null,this.positionLocation=null,this.positionBuffer=null,this.matrixLocation=null,this.textureMatrixLocation=null,this.textureLocation=null,this.alphaLocation=null},init:function(e,t){let n;t=Object.assign({alpha:!1,stencil:!0,depth:!0,antialias:!1,preserveDrawingBuffer:!1,vertexShader:"\n    attribute vec4 a_position;\n\n    uniform mat4 u_matrix;\n    uniform mat4 u_textureMatrix;\n\n    varying vec2 v_texcoord;\n\n    void main() {\n     gl_Position = u_matrix * a_position;\n     v_texcoord = (u_textureMatrix * a_position).xy;\n    }\n    ",fragmentShader:"\n    precision highp float;\n\n    varying vec2 v_texcoord;\n\n    uniform sampler2D u_texture;\n    uniform float u_alpha;\n\n    void main() {\n     vec4 color = texture2D(u_texture, v_texcoord);\n     color.a *= u_alpha;\n     gl_FragColor = color;\n    }\n    "},t),this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,delete t.vertexShader,delete t.fragmentShader;try{n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)||e.getContext("webkit-3d",t)||e.getContext("moz-webgl",t)}catch(e){throw console.error(e),e}this.canvas=e,this.gl=n,this.initContext(n)},initContext(e,t,n){t=t||this.vertexShader,n=n||this.fragmentShader,this.program=function(e,t,n,r,i){const s=h(e,t,e.VERTEX_SHADER),o=h(e,n,e.FRAGMENT_SHADER);return function(e,t,n,r,i){const s=e.createProgram();e.attachShader(s,t),e.attachShader(s,n),r&&r.forEach((function(t,n){e.bindAttribLocation(s,i?i[n]:n,t)}));e.linkProgram(s);if(!e.getProgramParameter(s,e.LINK_STATUS)){const t=e.getProgramInfoLog(s);return console.error("Error in program linking:"+t),e.deleteProgram(s),null}return s}(e,s,o,r,i)}(e,t,n);const r=this.program;this.positionLocation=e.getAttribLocation(r,"a_position"),this.matrixLocation=e.getUniformLocation(r,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(r,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(r,"u_texture"),this.alphaLocation=e.getUniformLocation(r,"u_alpha"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.bufferData(e.ARRAY_BUFFER,this.positions,e.STATIC_DRAW),e.enable(e.BLEND),e.blendFunc(770,771),e.blendEquation(e.FUNC_ADD),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)},resizeCanvas:function(e,t){const n=this.canvas;return(n.width!==e||n.height!==t)&&(n.width=e,n.height=t,!0)},createTexture:function(e){const t=e.id||e.src;let n=this.texCache[t];if(n)return n;const r=this.gl;return n=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),this.texCache[t]=n,n},clear:function(e){let t=0;void 0!==e&&(t|=this.gl.COLOR_BUFFER_BIT,this.gl.clearColor(e[0],e[1],e[2],e[3])),this.gl.clear(t)},drawImage:function(e,t,n,s,o,h,d,p,f){const m=this.createTexture(e),g=this.program,y=0===e.alpha||e.alpha?e.alpha:1,v=arguments,b=v.length,w=e.width,_=e.height;3===b?(h=t,d=n,t=0,n=0,p=s=w,f=o=_):5===b?(h=t,d=n,p=s,f=o,t=0,n=0,s=w,o=_):7===b&&(p=s,f=o);const S=this.canvas,I=this.gl;I.bindTexture(I.TEXTURE_2D,m),I.useProgram(g),I.bindBuffer(I.ARRAY_BUFFER,this.positionBuffer),I.enableVertexAttribArray(this.positionLocation),I.vertexAttribPointer(this.positionLocation,2,I.FLOAT,!1,0,0);let k=u(0,S.width,S.height,0,-1,1,r);a(k,h,d,0,k),c(k,p,f,1,k),I.uniformMatrix4fv(this.matrixLocation,!1,k);let C=l(t/w,n/_,0,i);s===w&&o===_||c(C,s/w,o/_,1,C),I.uniformMatrix4fv(this.textureMatrixLocation,!1,C),I.uniform1i(this.textureLocation,0),I.uniform1f(this.alphaLocation,y),I.drawArrays(I.TRIANGLES,0,6)}};for(let e in o)s.prototype[e]=o[e];function a(e,t,r,i,s){s=s||new n(16);var o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],d=e[6],p=e[7],f=e[8],m=e[9],g=e[10],y=e[11],v=e[12],b=e[13],w=e[14],_=e[15];return e!==s&&(s[0]=o,s[1]=a,s[2]=c,s[3]=l,s[4]=u,s[5]=h,s[6]=d,s[7]=p,s[8]=f,s[9]=m,s[10]=g,s[11]=y),s[12]=o*t+u*r+f*i+v,s[13]=a*t+h*r+m*i+b,s[14]=c*t+d*r+g*i+w,s[15]=l*t+p*r+y*i+_,s}function c(e,t,r,i,s){return(s=s||new n(16))[0]=t*e[0],s[1]=t*e[1],s[2]=t*e[2],s[3]=t*e[3],s[4]=r*e[4],s[5]=r*e[5],s[6]=r*e[6],s[7]=r*e[7],s[8]=i*e[8],s[9]=i*e[9],s[10]=i*e[10],s[11]=i*e[11],e!==s&&(s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s}function l(e,t,r,i){return(i=i||new n(16))[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e,i[13]=t,i[14]=r,i[15]=1,i}function u(e,t,r,i,s,o,a){return(a=a||new n(16))[0]=2/(t-e),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(i-r),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2/(s-o),a[11]=0,a[12]=(e+t)/(e-t),a[13]=(r+i)/(r-i),a[14]=(s+o)/(s-o),a[15]=1,a}function h(e,t,n){const r=e.createShader(n);e.shaderSource(r,t),e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS)){const n=e.getShaderInfoLog(r);return console.error("*** Error compiling shader '"+r+"':"+n+"\n"+t.split("\n").map((e,t)=>`${t+1}: ${e}`).join("\n")),e.deleteShader(r),null}return r}t&&(t.DrawImageGL=s),e.exports=s}("undefined"!=typeof window?window:"object"==typeof process&&"object"==typeof global?global:this)}]);